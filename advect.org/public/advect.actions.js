var S=Object.create;var{getPrototypeOf:Q,defineProperty:q,getOwnPropertyNames:V}=Object;var f=Object.prototype.hasOwnProperty;var H=(x,D,E)=>{E=x!=null?S(Q(x)):{};const z=D||!x||!x.__esModule?q(E,"default",{value:x,enumerable:!0}):E;for(let F of V(x))if(!f.call(z,F))q(z,F,{get:()=>x[F],enumerable:!0});return z};var v=(x,D)=>()=>(D||x((D={exports:{}}).exports,D),D.exports);var O={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},M=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class X{constructor(x,D,E,z){this.tagName=x,this.attributes=D,this.children=E,this.content=z,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let x=this.content||"";for(let D of this.children)x+=D.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${x}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(x){if(this.isRemoved)return null;if(this.attributes.id===x)return this;for(let D of this.children){const E=D.getElementById(x);if(E)return E}return null}getElementsByClass(x){if(this.isRemoved)return[];const D=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(x))D.push(this);for(let E of this.children)D.push(...E.getElementsByClass(x));return D}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(x){if(x.includes("*"))return;const D={};for(let[E,z]of Object.entries(this.attributes))if(x.includes(E))D[E]=z;this.attributes=D;for(let E of this.children)E.filterAttributes(x)}getAttributesString(){return Object.entries(this.attributes).map(([x,D])=>` ${x}="${D}"`).join("")}static create(x){const D=X.tokenize(x),E=[],z=[];let F=null,B={},P="";for(let I of D)switch(I.type){case O.TAG_OPEN:if(F){if(Object.keys(F.attributes).length===0)F.attributes=B;F.content=P.trim(),B={},P="",z.push(F)}F=new X(I.value,{},[]);break;case O.ATTRIBUTE_NAME:B[I.value]="";break;case O.ATTRIBUTE_VALUE:const U=Object.keys(B).pop();B[U]=I.value;break;case O.TAG_CLOSE:case O.SELF_CLOSING_TAG:if(!F)break;if(F.isSelfClosing=I.type===O.SELF_CLOSING_TAG,Object.keys(F.attributes).length===0)F.attributes=B;if(!F.content)F.content=P;else F.content+=" "+P;if(P="",B={},z.length>0)z[z.length-1].children.push(F);else E.push(F);F=z.pop()||null;break;case O.TEXT:if(F)P+=I.value;break}return E}static tokenize(x){const D=[];let E=0;while(E<x.length)if(x[E]==="<")if(x[E+1]==="/"){let z=E+2;while(z<x.length&&x[z]!==">")z++;D.push({type:O.TAG_CLOSE,value:x.slice(E+2,z).trim()}),E=z+1}else{let z=E+1;while(z<x.length&&x[z]!==" "&&x[z]!==">"&&x[z]!=="/")z++;const F=x.slice(E+1,z).trim();D.push({type:O.TAG_OPEN,value:x.slice(E+1,z).trim()});while(z<x.length&&x[z]!==">")if(x[z]===" "){z++;let B="";while(z<x.length&&x[z]!=="="&&x[z]!==" "&&x[z]!==">"&&x[z]!=="/")B+=x[z],z++;if(B!=="")D.push({type:O.ATTRIBUTE_NAME,value:B.trim().toLowerCase()});if(x[z]==="="){z++;const P=x[z];z++;let I="";while(z<x.length&&x[z]!==P)I+=x[z],z++;D.push({type:O.ATTRIBUTE_VALUE,value:I}),z++}}else z++;if(M.has(F.toLowerCase())&&x[z]===">")D.push({type:O.SELF_CLOSING_TAG,value:F});if(x[z]===">")z++;E=z}else{let z=E;while(z<x.length&&x[z]!=="<")z++;D.push({type:O.TEXT,value:x.slice(E,z)}),E=z}return D}}function K(x){return Object.keys(w).find((D)=>D.toLowerCase()==x.toLocaleLowerCase())!=null}function k(x,D){return import("data:text/javascript;charset=utf-8,"+D.join("\n")+encodeURIComponent(`${x}`)).then((z)=>z).catch((z)=>{return console.error(z),null})}function L(x){switch(x.data?.___type){case"table":console.table(x.data);break;case"dir":console.dir(x.data);break;case"error":console.error(x.data);break;case"warn":console.warn(x.data);break;default:case"log":console.log(x.data);break}}function Y(x){return x.replace(/<!--[\s\S]*?-->/g,"")}function Z(x){W.postMessage({...x,___type:"warn"})}var w={number:{},string:{},bigint:{},color:{}};var _=Object.getPrototypeOf(async function(){}).constructor,W=new BroadcastChannel("advect:log");W.onmessage=(x)=>L(x);var C="<div>Hello<!-- This is a comment --></div>",A=Y(C);console.log(A);var h={async prerender(x){return""},async load({urls:x}){const D=[],E=[];if(Array.isArray(x))E.push(...x);if(typeof x=="string")E.push(x);for(let z of E){const F=await fetch(z).then((B)=>B.text()).then(async(B)=>await this.build({template:B}));D.push(...F)}return D},async build({template:x}){const D=Y(x),E=X.create(String.raw`${D}`),z=[];console.log(D);for(let F of E){const B={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(F.tagName.toLowerCase()==="template"){if(!F.attributes.id){Z("advect Template must have an id that will become the tag name");continue}const I=F.attributes.id;if(I.indexOf("-")===-1){Z("advect Template tag name must contain a hyphen");continue}if(B.tagName=I,B.templateNode=F,F.attributes.root)B.root=F.attributes.root;else B.root="light";if(F.attributes.shadow)B.shadow=F.attributes.shadow;else B.shadow="closed";const U=[...F.children];while(U.length>0){const J=U.shift();if(!J)continue;if(J.tagName==="settings")J.children.forEach((G)=>{if(G.tagName=="mutation"){if(B?.mutation?.attributeFilter&&G.attributes.attributeFilter)B.mutation.attributeFilter=G.attributes.attributeFilter.split(",");if(B?.mutation?.attributes&&G.attributes.attributes)B.mutation.attributes=G.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(B?.mutation?.characterData&&G.attributes.characterData)B.mutation.characterData=G.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(B?.mutation?.childList&&G.attributes.childList)B.mutation.childList=G.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(B?.mutation?.subtree&&G.attributes.subtree)B.mutation.subtree=G.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if(G.tagName=="intersection"){if(B?.intersection&&G.attributes.margin)B.intersection.margin=parseFloat(G.attributes.margin);if(B?.intersection.threshhold&&G.attributes.threshhold)B.intersection.threshhold=parseFloat(G.attributes.threshhold);if(B?.intersection.root&&G.attributes.root)B.intersection.root=G.attributes.root}if(G.tagName=="attr"&&G.attributes.name){const R=G.attributes.name,$=G.attributes.type??"string";if(K($))B.watched_attrs[R]={type:$}}G.remove()}),J.remove();if(J.tagName==="script"){if(J.attributes.type?.toLocaleLowerCase()==="text/adv"&&J.attributes.type){const G=new URL(J.attributes.src);this.load({urls:G.toString()})}if(J.attributes.type?.toLocaleLowerCase()==="module"&&!J.attributes.src)B.module=J.text()}if(J.attributes.ref)B.refs.push(J);U.push(...J.children)}}const P=F.children.map((I)=>I.html()).join("");B.template=P,z.push(B)}return z}};export{h as Actions};
