var E=Object.create;var{getPrototypeOf:Q,defineProperty:K,getOwnPropertyNames:R}=Object;var V=Object.prototype.hasOwnProperty;var M=(z,I,J)=>{J=z!=null?E(Q(z)):{};const B=I||!z||!z.__esModule?K(J,"default",{value:z,enumerable:!0}):J;for(let F of R(z))if(!V.call(B,F))K(B,F,{get:()=>z[F],enumerable:!0});return B};var H=(z,I)=>()=>(I||z((I={exports:{}}).exports,I),I.exports);var Y={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},C=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class ${constructor(z,I,J,B){this.tagName=z,this.attributes=I,this.children=J,this.content=B,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let z=this.content||"";for(let I of this.children)z+=I.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${z}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(z){if(this.isRemoved)return null;if(this.attributes.id===z)return this;for(let I of this.children){const J=I.getElementById(z);if(J)return J}return null}getElementsByClass(z){if(this.isRemoved)return[];const I=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(z))I.push(this);for(let J of this.children)I.push(...J.getElementsByClass(z));return I}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(z){if(z.includes("*"))return;const I={};for(let[J,B]of Object.entries(this.attributes))if(z.includes(J))I[J]=B;this.attributes=I;for(let J of this.children)J.filterAttributes(z)}getAttributesString(){return Object.entries(this.attributes).map(([z,I])=>` ${z}="${I}"`).join("")}static create(z){const I=$.tokenize(z),J=[],B=[];let F=null,S={},W="";for(let X of I)switch(X.type){case Y.TAG_OPEN:if(F){if(Object.keys(F.attributes).length===0)F.attributes=S;F.content=W.trim(),S={},W="",B.push(F)}F=new $(X.value,{},[]);break;case Y.ATTRIBUTE_NAME:S[X.value]="";break;case Y.ATTRIBUTE_VALUE:const U=Object.keys(S).pop();S[U]=X.value;break;case Y.TAG_CLOSE:case Y.SELF_CLOSING_TAG:if(!F)break;if(F.isSelfClosing=X.type===Y.SELF_CLOSING_TAG,Object.keys(F.attributes).length===0)F.attributes=S;if(!F.content)F.content=W;else F.content+=" "+W;if(W="",S={},B.length>0)B[B.length-1].children.push(F);else J.push(F);F=B.pop()||null;break;case Y.TEXT:if(F)W+=X.value;break}return J}static tokenize(z){const I=[];let J=0;while(J<z.length)if(z[J]==="<")if(z[J+1]==="/"){let B=J+2;while(B<z.length&&z[B]!==">")B++;I.push({type:Y.TAG_CLOSE,value:z.slice(J+2,B).trim()}),J=B+1}else{let B=J+1;while(B<z.length&&z[B]!==" "&&z[B]!==">"&&z[B]!=="/")B++;const F=z.slice(J+1,B).trim();I.push({type:Y.TAG_OPEN,value:z.slice(J+1,B).trim()});while(B<z.length&&z[B]!==">")if(z[B]===" "){B++;let S="";while(B<z.length&&z[B]!=="="&&z[B]!==" "&&z[B]!==">"&&z[B]!=="/")S+=z[B],B++;if(S!=="")I.push({type:Y.ATTRIBUTE_NAME,value:S.trim().toLowerCase()});if(z[B]==="="){B++;const W=z[B];B++;let X="";while(B<z.length&&z[B]!==W)X+=z[B],B++;I.push({type:Y.ATTRIBUTE_VALUE,value:X}),B++}}else B++;if(C.has(F.toLowerCase())&&z[B]===">")I.push({type:Y.SELF_CLOSING_TAG,value:F});if(z[B]===">")B++;J=B}else{let B=J;while(B<z.length&&z[B]!=="<")B++;I.push({type:Y.TEXT,value:z.slice(J,B)}),J=B}return I}}function O(z){return Object.keys(f).find((I)=>I.toLowerCase()==z.toLocaleLowerCase())!=null}function y(z,I){return import("data:text/javascript;charset=utf-8,"+I.join("\n")+encodeURIComponent(`${z}`)).then((B)=>B).catch((B)=>{return console.error(B),null})}function w(z){switch(z.data?.___type){case"table":console.table(z.data);break;case"dir":console.dir(z.data);break;case"error":console.error(z.data);break;case"warn":console.warn(z.data);break;default:case"log":console.log(z.data);break}}function Z(z){q.postMessage({...z,___type:"log"})}var f={number:{},string:{},bigint:{},color:{}};var b=Object.getPrototypeOf(async function(){}).constructor,q=new BroadcastChannel("advect:log");q.onmessage=(z)=>w(z);var x={async prerender(z){return Z({renderDesc:z}),""},async load({urls:z}){Z({message:"starting my loading",urls:z});const I=[],J=[];if(Array.isArray(z))J.push(...z);if(typeof z=="string")J.push(z);for(let B of J){const F=await fetch(B).then((S)=>S.text()).then(async(S)=>await this.build({template:S}));Z({msg:"wow loading some stuff",url:B,data:F}),I.push(...F)}return Z({message:"done loading",urls:z}),I},async build({template:z}){const I=$.create(String.raw`${z}`),J=[];Z({message:"building",template:z,root_nodes:I});for(let B of I){Z({message:"Adding",root_node:B.attributes.id});const F={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(B.tagName.toLowerCase()==="template"){if(!B.attributes.id){Z("advect Template must have an id that will become the tag name");continue}const W=B.attributes.id;if(W.indexOf("-")===-1){Z("advect Template tag name must contain a hyphen");continue}if(F.tagName=W,F.templateNode=B,B.attributes.root)F.root=B.attributes.root;else F.root="light";if(B.attributes.shadow)F.shadow=B.attributes.shadow;else F.shadow="closed";const X=[...B.children];while(X.length>0){const U=X.shift();if(!U)continue;if(U.tagName==="settings")U.children.forEach((P)=>{if(P.tagName=="mutation"){if(F?.mutation?.attributeFilter&&P.attributes.attributeFilter)F.mutation.attributeFilter=P.attributes.attributeFilter.split(",");if(F?.mutation?.attributes&&P.attributes.attributes)F.mutation.attributes=P.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(F?.mutation?.characterData&&P.attributes.characterData)F.mutation.characterData=P.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(F?.mutation?.childList&&P.attributes.childList)F.mutation.childList=P.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(F?.mutation?.subtree&&P.attributes.subtree)F.mutation.subtree=P.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if(P.tagName=="intersection"){if(F?.intersection&&P.attributes.margin)F.intersection.margin=parseFloat(P.attributes.margin);if(F?.intersection.threshhold&&P.attributes.threshhold)F.intersection.threshhold=parseFloat(P.attributes.threshhold);if(F?.intersection.root&&P.attributes.root)F.intersection.root=P.attributes.root}if(P.tagName=="attr"&&P.attributes.name){const D=P.attributes.name,G=P.attributes.type??"string";if(O(G))F.watched_attrs[D]={type:G}}P.remove()}),U.remove();if(U.tagName==="script"){if(U.attributes.type.toLocaleLowerCase()==="text/adv"&&U.attributes.type){const P=new URL(U.attributes.src);this.load({urls:P.toString()})}if(U.attributes.type.toLocaleLowerCase()==="module"&&!U.attributes.src)F.module=U.text()}if(U.attributes.ref)F.refs.push(U);X.push(...U.children)}}const S=B.children.map((W)=>W.html()).join("");F.template=S,J.push(F)}return J}};onconnect=(z)=>{const I=z.ports[0];I.addEventListener("message",(J)=>{try{const{data:B}=J;if(B&&B?.action&&x[B.action])try{x[B.action](B.data).then((F)=>{I.postMessage({action:B.action,result:F,$id:B.$id})})}catch(F){console.log(F),I.postMessage({action:B.action,result:F,$id:B.$id,isError:!0})}else console.warn("Unknown action",B)}catch(B){}}),I.start()};
