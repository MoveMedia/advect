var AJ=Object.create;var{getPrototypeOf:NJ,defineProperty:KJ,getOwnPropertyNames:TJ}=Object;var fJ=Object.prototype.hasOwnProperty;var jJ=(J,Y,q)=>{q=J!=null?AJ(NJ(J)):{};const X=Y||!J||!J.__esModule?KJ(q,"default",{value:J,enumerable:!0}):q;for(let Z of TJ(J))if(!fJ.call(X,Z))KJ(X,Z,{get:()=>J[Z],enumerable:!0});return X};var kJ=(J,Y)=>()=>(Y||J((Y={exports:{}}).exports,Y),Y.exports);var WJ=kJ((o,SJ)=>{(function(J,Y){typeof o=="object"&&typeof SJ!="undefined"?Y(o):typeof define=="function"&&define.amd?define(["exports"],Y):Y((J||self).eta={})})(o,function(J){function Y(){return Y=Object.assign?Object.assign.bind():function(z){for(var G=1;G<arguments.length;G++){var K=arguments[G];for(var Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&(z[Q]=K[Q])}return z},Y.apply(this,arguments)}function q(z,G){z.prototype=Object.create(G.prototype),z.prototype.constructor=z,Z(z,G)}function X(z){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(G){return G.__proto__||Object.getPrototypeOf(G)},X(z)}function Z(z,G){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(K,Q){return K.__proto__=Q,K},Z(z,G)}function D(z,G,K){return D=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}()?Reflect.construct.bind():function(Q,U,O){var F=[null];F.push.apply(F,U);var $=new(Function.bind.apply(Q,F));return O&&Z($,O.prototype),$},D.apply(null,arguments)}function I(z){var G=typeof Map=="function"?new Map:void 0;return I=function(K){if(K===null||Function.toString.call(K).indexOf("[native code]")===-1)return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(G!==void 0){if(G.has(K))return G.get(K);G.set(K,Q)}function Q(){return D(K,arguments,X(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),Z(Q,K)},I(z)}var W=function(){function z(K){this.cache=void 0,this.cache=K}var G=z.prototype;return G.define=function(K,Q){this.cache[K]=Q},G.get=function(K){return this.cache[K]},G.remove=function(K){delete this.cache[K]},G.reset=function(){this.cache={}},G.load=function(K){this.cache=Y({},this.cache,K)},z}(),S=function(z){function G(K){var Q;return(Q=z.call(this,K)||this).name="Eta Error",Q}return q(G,z),G}(I(Error)),B=function(z){function G(K){var Q;return(Q=z.call(this,K)||this).name="EtaParser Error",Q}return q(G,z),G}(S),E=function(z){function G(K){var Q;return(Q=z.call(this,K)||this).name="EtaRuntime Error",Q}return q(G,z),G}(S),R=function(z){function G(K){var Q;return(Q=z.call(this,K)||this).name="EtaNameResolution Error",Q}return q(G,z),G}(S);function P(z,G,K){var Q=G.slice(0,K).split(/\n/),U=Q.length,O=Q[U-1].length+1;throw z+=" at line "+U+" col "+O+":\n\n  "+G.split(/\n/)[U-1]+"\n  "+Array(O).join(" ")+"^",new B(z)}function V(z,G,K,Q){var U=G.split("\n"),O=Math.max(K-3,0),F=Math.min(U.length,K+3),$=Q,k=U.slice(O,F).map(function(i,c){var C=c+O+1;return(C==K?" >> ":"    ")+C+"| "+i}).join("\n"),x=new E(($?$+":"+K+"\n":"line "+K+"\n")+k+"\n\n"+z.message);throw x.name=z.name,x}var s=function(){return Promise.resolve()}.constructor;function A(z,G){var K=this.config,Q=G&&G.async?s:Function;try{return new Q(K.varName,"options",this.compileToString.call(this,z,G))}catch(U){throw U instanceof SyntaxError?new B("Bad template syntax\n\n"+U.message+"\n"+Array(U.message.length+1).join("=")+"\n"+this.compileToString.call(this,z,G)+"\n"):U}}function L(z,G){var K=this.config,Q=G&&G.async,U=this.compileBody,O=this.parse.call(this,z),F=K.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(K.debug?', line: 1, templateStr: "'+z.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(K.debug?"try {":"")+(K.useWith?"with("+K.varName+"||{}){":"")+"\n\n"+U.call(this,O)+"\nif (__eta.layout) {\n  __eta.res = "+(Q?"await includeAsync":"include")+" (__eta.layout, {..."+K.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(K.useWith?"}":"")+(K.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(K.plugins)for(var $=0;$<K.plugins.length;$++){var k=K.plugins[$];k.processFnString&&(F=k.processFnString(F,K))}return F}function j(z){for(var G=this.config,K=0,Q=z.length,U="";K<Q;K++){var O=z[K];if(typeof O=="string")U+="__eta.res+='"+O+"'\n";else{var F=O.t,$=O.val||"";G.debug&&(U+="__eta.line="+O.lineNo+"\n"),F==="r"?(G.autoFilter&&($="__eta.f("+$+")"),U+="__eta.res+="+$+"\n"):F==="i"?(G.autoFilter&&($="__eta.f("+$+")"),G.autoEscape&&($="__eta.e("+$+")"),U+="__eta.res+="+$+"\n"):F==="e"&&(U+=$+"\n")}}return U}var VJ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function HJ(z){return VJ[z]}var XJ={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(z){var G=String(z);return/[&<>"']/.test(G)?G.replace(/[&<>"']/g,HJ):G},filterFunction:function(z){return String(z)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},v=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,g=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,p=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function m(z){return z.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function LJ(z,G){return z.slice(0,G).split("\n").length}function MJ(z){var G=this.config,K=[],Q=!1,U=0,O=G.parse;if(G.plugins)for(var F=0;F<G.plugins.length;F++){var $=G.plugins[F];$.processTemplate&&(z=$.processTemplate(z,G))}function k(w,y){w&&(w=function(b,l,n,t){var N,T;return Array.isArray(l.autoTrim)?(N=l.autoTrim[1],T=l.autoTrim[0]):N=T=l.autoTrim,(n||n===!1)&&(N=n),(t||t===!1)&&(T=t),T||N?N==="slurp"&&T==="slurp"?b.trim():(N==="_"||N==="slurp"?b=b.trimStart():N!=="-"&&N!=="nl"||(b=b.replace(/^(?:\r\n|\n|\r)/,"")),T==="_"||T==="slurp"?b=b.trimEnd():T!=="-"&&T!=="nl"||(b=b.replace(/(?:\r\n|\n|\r)$/,"")),b):b}(w,G,Q,y),w&&(w=w.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),K.push(w)))}G.rmWhitespace&&(z=z.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),v.lastIndex=0,g.lastIndex=0,p.lastIndex=0;for(var x,i=[O.exec,O.interpolate,O.raw].reduce(function(w,y){return w&&y?w+"|"+m(y):y?m(y):w},""),c=new RegExp(m(G.tags[0])+"(-|_)?\\s*("+i+")?\\s*","g"),C=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+m(G.tags[1])+")","g");x=c.exec(z);){var wJ=z.slice(U,x.index);U=x[0].length+x.index;var a=x[2]||"";k(wJ,x[1]),C.lastIndex=U;for(var M=void 0,u=!1;M=C.exec(z);){if(M[1]){var bJ=z.slice(U,M.index);c.lastIndex=U=C.lastIndex,Q=M[2],u={t:a===O.exec?"e":a===O.raw?"r":a===O.interpolate?"i":"",val:bJ};break}var d=M[0];if(d==="/*"){var zJ=z.indexOf("*/",C.lastIndex);zJ===-1&&P("unclosed comment",z,M.index),C.lastIndex=zJ}else d==="'"?(g.lastIndex=M.index,g.exec(z)?C.lastIndex=g.lastIndex:P("unclosed string",z,M.index)):d==='"'?(p.lastIndex=M.index,p.exec(z)?C.lastIndex=p.lastIndex:P("unclosed string",z,M.index)):d==="`"&&(v.lastIndex=M.index,v.exec(z)?C.lastIndex=v.lastIndex:P("unclosed string",z,M.index))}u?(G.debug&&(u.lineNo=LJ(z,x.index)),K.push(u)):P("unclosed tag",z,x.index)}if(k(z.slice(U,z.length),!1),G.plugins)for(var r=0;r<G.plugins.length;r++){var GJ=G.plugins[r];GJ.processAST&&(K=GJ.processAST(K,G))}return K}function YJ(z,G){var K=G&&G.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!z.startsWith("@")){var Q=G.filepath,U=K.get(Q);if(this.config.cache&&U)return U;var O=this.readFile(Q),F=this.compile(O,G);return this.config.cache&&K.define(Q,F),F}var $=K.get(z);if($)return $;throw new R("Failed to get template '"+z+"'")}function ZJ(z,G,K){var Q,U=Y({},K,{async:!1});return typeof z=="string"?(this.resolvePath&&this.readFile&&!z.startsWith("@")&&(U.filepath=this.resolvePath(z,U)),Q=YJ.call(this,z,U)):Q=z,Q.call(this,G,U)}function qJ(z,G,K){var Q,U=Y({},K,{async:!0});typeof z=="string"?(this.resolvePath&&this.readFile&&!z.startsWith("@")&&(U.filepath=this.resolvePath(z,U)),Q=YJ.call(this,z,U)):Q=z;var O=Q.call(this,G,U);return Promise.resolve(O)}function EJ(z,G){var K=this.compile(z,{async:!1});return ZJ.call(this,K,G)}function PJ(z,G){var K=this.compile(z,{async:!0});return qJ.call(this,K,G)}var xJ=function(){function z(K){this.config=void 0,this.RuntimeErr=V,this.compile=A,this.compileToString=L,this.compileBody=j,this.parse=MJ,this.render=ZJ,this.renderAsync=qJ,this.renderString=EJ,this.renderStringAsync=PJ,this.filepathCache={},this.templatesSync=new W({}),this.templatesAsync=new W({}),this.resolvePath=null,this.readFile=null,this.config=K?Y({},XJ,K):Y({},XJ)}var G=z.prototype;return G.configure=function(K){this.config=Y({},this.config,K)},G.withConfig=function(K){return Y({},this,{config:Y({},this.config,K)})},G.loadTemplate=function(K,Q,U){if(typeof Q=="string")(U&&U.async?this.templatesAsync:this.templatesSync).define(K,this.compile(Q,U));else{var O=this.templatesSync;(Q.constructor.name==="AsyncFunction"||U&&U.async)&&(O=this.templatesAsync),O.define(K,Q)}},z}(),CJ=function(z){function G(){return z.apply(this,arguments)||this}return q(G,z),G}(xJ);J.Eta=CJ})});var H={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},yJ=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class h{constructor(J,Y,q,X){this.tagName=J,this.attributes=Y,this.children=q,this.content=X,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let J=this.content||"";for(let Y of this.children)J+=Y.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${J}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(J){if(this.isRemoved)return null;if(this.attributes.id===J)return this;for(let Y of this.children){const q=Y.getElementById(J);if(q)return q}return null}getElementsByClass(J){if(this.isRemoved)return[];const Y=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(J))Y.push(this);for(let q of this.children)Y.push(...q.getElementsByClass(J));return Y}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(J){if(J.includes("*"))return;const Y={};for(let[q,X]of Object.entries(this.attributes))if(J.includes(q))Y[q]=X;this.attributes=Y;for(let q of this.children)q.filterAttributes(J)}getAttributesString(){return Object.entries(this.attributes).map(([J,Y])=>` ${J}="${Y}"`).join("")}static create(J){const Y=h.tokenize(J),q=[],X=[];let Z=null,D={},I="";for(let W of Y)switch(W.type){case H.TAG_OPEN:if(Z){if(Object.keys(Z.attributes).length===0)Z.attributes=D;Z.content=I.trim(),D={},I="",X.push(Z)}Z=new h(W.value,{},[]);break;case H.ATTRIBUTE_NAME:D[W.value]="";break;case H.ATTRIBUTE_VALUE:const S=Object.keys(D).pop();D[S]=W.value;break;case H.TAG_CLOSE:case H.SELF_CLOSING_TAG:if(!Z)break;if(Z.isSelfClosing=W.type===H.SELF_CLOSING_TAG,Object.keys(Z.attributes).length===0)Z.attributes=D;if(!Z.content)Z.content=I;else Z.content+=" "+I;if(I="",D={},X.length>0)X[X.length-1].children.push(Z);else q.push(Z);Z=X.pop()||null;break;case H.TEXT:if(Z)I+=W.value;break}return q}static tokenize(J){const Y=[];let q=0;while(q<J.length)if(J[q]==="<")if(J[q+1]==="/"){let X=q+2;while(X<J.length&&J[X]!==">")X++;Y.push({type:H.TAG_CLOSE,value:J.slice(q+2,X).trim()}),q=X+1}else{let X=q+1;while(X<J.length&&J[X]!==" "&&J[X]!==">"&&J[X]!=="/")X++;const Z=J.slice(q+1,X).trim();Y.push({type:H.TAG_OPEN,value:J.slice(q+1,X).trim()});while(X<J.length&&J[X]!==">")if(J[X]===" "){X++;let D="";while(X<J.length&&J[X]!=="="&&J[X]!==" "&&J[X]!==">"&&J[X]!=="/")D+=J[X],X++;if(D!=="")Y.push({type:H.ATTRIBUTE_NAME,value:D.trim().toLowerCase()});if(J[X]==="="){X++;const I=J[X];X++;let W="";while(X<J.length&&J[X]!==I)W+=J[X],X++;Y.push({type:H.ATTRIBUTE_VALUE,value:W}),X++}}else X++;if(yJ.has(Z.toLowerCase())&&J[X]===">")Y.push({type:H.SELF_CLOSING_TAG,value:Z});if(J[X]===">")X++;q=X}else{let X=q;while(X<J.length&&J[X]!=="<")X++;Y.push({type:H.TEXT,value:J.slice(q,X)}),q=X}return Y}}function QJ(J){return Object.keys(_J).find((Y)=>Y.toLowerCase()==J.toLocaleLowerCase())!=null}function UJ(J,Y){return import("data:text/javascript;charset=utf-8,"+Y.join("\n")+encodeURIComponent(`${J}`)).then((X)=>X).catch((X)=>{return console.error(X),null})}function hJ(J){switch(J.data?.___type){case"table":console.table(J.data);break;case"dir":console.dir(J.data);break;case"error":console.error(J.data);break;case"warn":console.warn(J.data);break;default:case"log":console.log(J.data);break}}function f(J){BJ.postMessage({...J,___type:"log"})}var _J={number:{},string:{},bigint:{},color:{}};var _=Object.getPrototypeOf(async function(){}).constructor,BJ=new BroadcastChannel("advect:log");BJ.onmessage=(J)=>hJ(J);var DJ={async prerender(J){return f({renderDesc:J}),""},async load({urls:J}){f({message:"starting my loading",urls:J});const Y=[],q=[];if(Array.isArray(J))q.push(...J);if(typeof J=="string")q.push(J);for(let X of q){const Z=await fetch(X).then((D)=>D.text()).then(async(D)=>await this.build({template:D}));f({msg:"wow loading some stuff",url:X,data:Z}),Y.push(...Z)}return f({message:"done loading",urls:J}),Y},async build({template:J}){const Y=h.create(String.raw`${J}`),q=[];f({message:"building",template:J,root_nodes:Y});for(let X of Y){f({message:"Adding",root_node:X.attributes.id});const Z={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(X.tagName.toLowerCase()==="template"){if(!X.attributes.id){f("advect Template must have an id that will become the tag name");continue}const I=X.attributes.id;if(I.indexOf("-")===-1){f("advect Template tag name must contain a hyphen");continue}if(Z.tagName=I,Z.templateNode=X,X.attributes.root)Z.root=X.attributes.root;else Z.root="light";if(X.attributes.shadow)Z.shadow=X.attributes.shadow;else Z.shadow="closed";const W=[...X.children];while(W.length>0){const S=W.shift();if(!S)continue;if(S.tagName==="settings")S.children.forEach((B)=>{if(B.tagName=="mutation"){if(Z?.mutation?.attributeFilter&&B.attributes.attributeFilter)Z.mutation.attributeFilter=B.attributes.attributeFilter.split(",");if(Z?.mutation?.attributes&&B.attributes.attributes)Z.mutation.attributes=B.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(Z?.mutation?.characterData&&B.attributes.characterData)Z.mutation.characterData=B.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(Z?.mutation?.childList&&B.attributes.childList)Z.mutation.childList=B.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(Z?.mutation?.subtree&&B.attributes.subtree)Z.mutation.subtree=B.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if(B.tagName=="intersection"){if(Z?.intersection&&B.attributes.margin)Z.intersection.margin=parseFloat(B.attributes.margin);if(Z?.intersection.threshhold&&B.attributes.threshhold)Z.intersection.threshhold=parseFloat(B.attributes.threshhold);if(Z?.intersection.root&&B.attributes.root)Z.intersection.root=B.attributes.root}if(B.tagName=="attr"&&B.attributes.name){const E=B.attributes.name,R=B.attributes.type??"string";if(QJ(R))Z.watched_attrs[E]={type:R}}B.remove()}),S.remove();if(S.tagName==="script"){if(S.attributes.type.toLocaleLowerCase()==="text/adv"&&S.attributes.type){const B=new URL(S.attributes.src);this.load({urls:B.toString()})}if(S.attributes.type.toLocaleLowerCase()==="module"&&!S.attributes.src)Z.module=S.text()}if(S.attributes.ref)Z.refs.push(S);W.push(...S.children)}}const D=X.children.map((I)=>I.html()).join("");Z.template=D,q.push(Z)}return q}};var FJ=jJ(WJ(),1);function IJ(J,Y){const[q,X]=Y.tags,Z=Y.parse.exec,D=B(J),I=E(D),W=R(I),S=P(W);function B(V){return V.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function E(V){return V.replace(/<if check="([^"]+)">/g,`${q}${Z} if ( \$1 ) { ${X}`).replace(/<else\/?>/g,`${q}${Z} } else { ${X}`).replace(/<\/if>/g,`${q}${Z} } ${X}`)}function R(V){return V.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(s,A,L,j){if(L&&j)return`${q}${Z} ${A}.forEach(function(${L}, ${j}){ ${X}`;else if(L)return`${q}${Z} ${A}.forEach(function(${L}){ ${X}`;else return`${q}${Z} ${A}.forEach(function(){ ${X}`}).replace(/<\/for>/g,`${q}${Z} }) ${X}`)}function P(V){return V.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(s,A,L,j){if(L&&j)return`${q}${Z} Object.keys(${A}).forEach(function(${L}) { ${X} 
                        ${q}${Z} const ${j} = ${A}[${L}] ${X}
                    `;else if(L)return`${q}${Z} Object.keys(${A}).forEach(function(${L}) { ${X}`;else return`${q}${Z} Object.keys(${A}).forEach(function() { ${X}`}).replace(/<\/of>/g,`${q}${Z} }) ${X}`)}return S}var OJ=(J)=>{let Y;const q=new Set,X=(B,E)=>{const R=typeof B==="function"?B(Y):B;if(!Object.is(R,Y)){const P=Y;Y=(E!=null?E:typeof R!=="object"||R===null)?R:Object.assign({},Y,R),q.forEach((V)=>V(Y,P))}},Z=()=>Y,W={setState:X,getState:Z,getInitialState:()=>S,subscribe:(B)=>{return q.add(B),()=>q.delete(B)}},S=Y=J(X,Z,W);return W},$J=(J)=>J?OJ(J):OJ;function cJ(J){return new Promise((Y,q)=>{if(!J.isConnected){Y(null);return}if(J.tagName.indexOf("-")==-1){Y(J);return}if(!J.matches(":defined"))customElements.whenDefined(J.tagName).then((D)=>{Y(J)}).catch((D)=>{q(D)});Y(J)})}var vJ=()=>{const J=new Map,Y=new SharedWorker(new URL("advect.sharedworker.js",import.meta.url).href,{type:"module"});return Y.onerror=(X)=>{console.warn("error",X)},Y.port.onmessage=(X)=>{const Z=J.has(X.data.$id)&&J.get(X.data.$id);if(X.data?.isError===!0&&Z)Z.reject(X);if(Z)Z.resolve(X),J.delete(X.data.$id)},{messagePromise:async(X,Z)=>{return new Promise((D,I)=>{const W=Math.random().toString(36).substr(2,9);J.set(W,{resolve:D,reject:I}),Y.port.postMessage({action:X,data:Z,$id:W})})},worker:Y,type:"shared"}},gJ=()=>{const J=new Map,Y=new Worker(new URL("advect.worker.js",import.meta.url),{type:"module"});return Y.onerror=(X)=>{console.error("error",X)},Y.onmessage=(X)=>{const Z=J.has(X.data.$id)&&J.get(X.data.$id);if(X.data?.isError===!0&&Z)Z.reject(X);if(Z)Z.resolve(X),J.delete(X.data.$id)},{messagePromise:async(X,Z)=>{return new Promise((D,I)=>{const W=Math.random().toString(36).substr(2,9);J.set(W,{resolve:D,reject:I}),Y.postMessage({action:X,data:Z,$id:W})})},worker:Y,type:"dedicated"}},pJ=()=>{return{messagePromise:async(Y,q)=>{return DJ[Y].call(q)},worker:null,type:"no-worker"}},mJ=()=>{const{messagePromise:J}=typeof SharedWorker!=="undefined"?vJ():typeof Worker!=="undefined"?gJ():pJ(),Y=async(I)=>{return J("prerender",I)},q=async(I)=>{const S=(await J("load",{urls:I})).data.result;return X(S)},X=(I,W=!0)=>{const S=[];for(let B of I){const E=B;UJ(B.module,[]).then((R)=>{const P=R?.default,V=class extends(P||JJ){static observedAttributes=Object.keys(E.watched_attrs);static settings=E};if(W)customElements.define(B.tagName,V);S.push(V)})}return S},Z=async(I)=>{const S=(await J("build",{template:I})).data.result;return X(S)},D=(I)=>{document.querySelectorAll("template[id][adv]").forEach((S)=>uJ.build(S.outerHTML));let W=[];document.querySelectorAll('script[type="text/adv"][src]').forEach((S)=>{if(S.hasAttribute("src"))W.push(S.getAttribute("src")??"")}),q(W),document.removeEventListener("DOMContentLoaded",D)};return document.addEventListener("DOMContentLoaded",D),{render:Y,build:Z,load:q}};class e extends HTMLElement{anyAttrChanged(J,Y){}attr=new Proxy({},{get:(J,Y)=>{if(this.isConnected)return this.getAttribute(Y);return null},set:(J,Y,q)=>{if(this.isConnected)return this.setAttribute(Y,q),this.anyAttrChanged(Y,q),!0;return!1}});data=new Proxy({},{get:(J,Y)=>{if(this.isConnected)return this.dataset[Y];return null},set:(J,Y,q)=>{if(this.isConnected)return this.dataset[Y]=q,this.anyAttrChanged("data-"+Y,q),!0;return!1}});#J;get internals(){return this.#J}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(J,Y,q)=>{};attributeChangedCallback(J,Y,q){this?.onAttributeChange(J,Y,q)}onConnect=()=>{};connectedCallback(){this.#J=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(J,Y,q){if(super.addEventListener(J,Y,q),J=="connect"&&this.isConnected)Y(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(J)=>{};onIntersect=(J)=>{}}class JJ extends e{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}refs=new Proxy({},{get:(J,Y)=>{const q=this.querySelector(`[ref="${Y}"]`)||this?.shadowRoot?.querySelector(`[ref="${Y}"]`);if(q)return cJ(q);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.#J(),this.#G(),this?.onConnect()}#J(){switch(this.$settings?.root){case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}#X(){this.shadowRoot?.querySelectorAll("[ref]").forEach((J)=>{this.mutationObserver?.observe(J,{attributes:!0,childList:!0,subtree:!0}),J.getAttributeNames().filter((q)=>q.startsWith("on")).forEach((q)=>{const X=J.getAttribute(q)??"";if(q.toLowerCase()==="onmutate")J.addEventListener("adv:mutation",(Z)=>{try{new _("$self","event","$this","refs","data",X)(this,Z,J,this.refs,this.data)}catch(D){console.error(D,X,this)}});else try{J[q]=(Z)=>{new _("$self","event","$this","refs","data",X)(this,Z,J,this.refs,this.data)}}catch(Z){console.error(Z,X,this)}})})}#q(){this?.querySelectorAll("[ref]").forEach((J)=>{this.mutationObserver?.observe(J,{attributes:!0,childList:!0,subtree:!0}),J.getAttributeNames().filter((q)=>q.startsWith("on")).forEach((q)=>{const X=J.getAttribute(q)??"";try{J[q]=(Z)=>{new _("$self","event","$this","refs","data",X)(this,Z,J,this.refs,this.data)}}catch(Z){console.error(Z,X,this)}})})}#z(){this.getAttributeNames().filter((J)=>J.startsWith("on")).forEach((J)=>{const Y=this.getAttribute(J)??"";if(J.toLowerCase()==="onmutate"){this.onMutation=(q)=>new _("$self","event",Y)(this,q);return}this[J]=(q)=>new _("$self","event",Y)(this,q)})}#G(){this.#z(),this.#q(),this.#X()}#Y;get mutationObserver(){return this.#Y}createMutationObserver(){if(this.$settings.mutation){if(this.#Y=new MutationObserver((J,Y)=>{this?.onMutation(J)}),this.#Y.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#Y.observe(this.shadowRoot,{...this.$settings.mutation})}}#Z;get interectObserver(){return this.#Z}createIntersectObserver(){if(this.$settings.intersection){let J=void 0;if(this.$settings?.intersection?.root)J=this.querySelector(this.$settings?.intersection?.root);this.#Z=new IntersectionObserver((Y,q)=>{this.onIntersect(Y)},{...this.$settings.intersection,root:J})}}}class RJ extends e{anyAttrChanged(J,Y){this.render()}#J=new FJ.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#X=$J((J,Y)=>({}));get store(){return this.#X}get state(){return this.#X?.getState()}connectedCallback(){this.attachShadow({mode:"open"}),this.#X.subscribe((J,Y)=>{this.render()}),this.render(),super.connectedCallback()}get eta(){return this.#J}render(){const J=IJ(this.innerHTML,this.#J.config),Y=`<div style="display:contents;" part="root">
      ${this.eta.renderString(J,{$self:this})}</div>`;if(this.shadowRoot)this.shadowRoot.innerHTML=Y}}if(!customElements.get("adv-view"))customElements.define("adv-view",RJ);window.AdvectElement=JJ;var uJ=mJ();export{cJ as refHandle,uJ as advect,RJ as AdvectView,JJ as AdvectElement,e as AdvectBase};
