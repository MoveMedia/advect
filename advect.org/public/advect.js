var yG=Object.create;var{getPrototypeOf:kG,defineProperty:QG,getOwnPropertyNames:hG}=Object;var vG=Object.prototype.hasOwnProperty;var BG=(G,J,X)=>{X=G!=null?yG(kG(G)):{};const Z=J||!G||!G.__esModule?QG(X,"default",{value:G,enumerable:!0}):X;for(let Y of hG(G))if(!vG.call(Z,Y))QG(Z,Y,{get:()=>G[Y],enumerable:!0});return Z};var IG=(G,J)=>()=>(J||G((J={exports:{}}).exports,J),J.exports);var SG=IG((ZJ,MG)=>{var dG=(G,J={})=>{const X={skipSameOrigin:!0,useBlob:!0,...J};if(!G.includes("://")||G.includes(window.location.origin))return Promise.resolve(G);return new Promise((Z,Y)=>fetch(G).then((D)=>D.text()).then((D)=>{let V=new URL(G).href.split("/");V.pop();const I=`const _importScripts = importScripts;
const _fixImports = (url) => new URL(url, '${V.join("/")+"/"}').href;
importScripts = (...urls) => _importScripts(...urls.map(_fixImports));`;let O="data:application/javascript,"+encodeURIComponent(I+D);if(X.useBlob)O=URL.createObjectURL(new Blob([`importScripts("${O}")`],{type:"application/javascript"}));Z(O)}).catch(Y))};MG.exports=dG});var HG=IG((a,EG)=>{(function(G,J){typeof a=="object"&&typeof EG!="undefined"?J(a):typeof define=="function"&&define.amd?define(["exports"],J):J((G||self).eta={})})(a,function(G){function J(){return J=Object.assign?Object.assign.bind():function(q){for(var z=1;z<arguments.length;z++){var K=arguments[z];for(var Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&(q[Q]=K[Q])}return q},J.apply(this,arguments)}function X(q,z){q.prototype=Object.create(z.prototype),q.prototype.constructor=q,Y(q,z)}function Z(q){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},Z(q)}function Y(q,z){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(K,Q){return K.__proto__=Q,K},Y(q,z)}function D(q,z,K){return D=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}()?Reflect.construct.bind():function(Q,B,M){var E=[null];E.push.apply(E,B);var S=new(Function.bind.apply(Q,E));return M&&Y(S,M.prototype),S},D.apply(null,arguments)}function V(q){var z=typeof Map=="function"?new Map:void 0;return V=function(K){if(K===null||Function.toString.call(K).indexOf("[native code]")===-1)return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(z!==void 0){if(z.has(K))return z.get(K);z.set(K,Q)}function Q(){return D(K,arguments,Z(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),Y(Q,K)},V(q)}var I=function(){function q(K){this.cache=void 0,this.cache=K}var z=q.prototype;return z.define=function(K,Q){this.cache[K]=Q},z.get=function(K){return this.cache[K]},z.remove=function(K){delete this.cache[K]},z.reset=function(){this.cache={}},z.load=function(K){this.cache=J({},this.cache,K)},q}(),O=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="Eta Error",Q}return X(z,q),z}(V(Error)),$=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaParser Error",Q}return X(z,q),z}(O),F=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaRuntime Error",Q}return X(z,q),z}(O),x=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaNameResolution Error",Q}return X(z,q),z}(O);function H(q,z,K){var Q=z.slice(0,K).split(/\n/),B=Q.length,M=Q[B-1].length+1;throw q+=" at line "+B+" col "+M+":\n\n  "+z.split(/\n/)[B-1]+"\n  "+Array(M).join(" ")+"^",new $(q)}function R(q,z,K,Q){var B=z.split("\n"),M=Math.max(K-3,0),E=Math.min(B.length,K+3),S=Q,f=B.slice(M,E).map(function(s,u){var b=u+M+1;return(b==K?" >> ":"    ")+b+"| "+s}).join("\n"),W=new F((S?S+":"+K+"\n":"line "+K+"\n")+f+"\n\n"+q.message);throw W.name=q.name,W}var _=function(){return Promise.resolve()}.constructor;function w(q,z){var K=this.config,Q=z&&z.async?_:Function;try{return new Q(K.varName,"options",this.compileToString.call(this,q,z))}catch(B){throw B instanceof SyntaxError?new $("Bad template syntax\n\n"+B.message+"\n"+Array(B.message.length+1).join("=")+"\n"+this.compileToString.call(this,q,z)+"\n"):B}}function U(q,z){var K=this.config,Q=z&&z.async,B=this.compileBody,M=this.parse.call(this,q),E=K.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(K.debug?', line: 1, templateStr: "'+q.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(K.debug?"try {":"")+(K.useWith?"with("+K.varName+"||{}){":"")+"\n\n"+B.call(this,M)+"\nif (__eta.layout) {\n  __eta.res = "+(Q?"await includeAsync":"include")+" (__eta.layout, {..."+K.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(K.useWith?"}":"")+(K.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(K.plugins)for(var S=0;S<K.plugins.length;S++){var f=K.plugins[S];f.processFnString&&(E=f.processFnString(E,K))}return E}function j(q){for(var z=this.config,K=0,Q=q.length,B="";K<Q;K++){var M=q[K];if(typeof M=="string")B+="__eta.res+='"+M+"'\n";else{var E=M.t,S=M.val||"";z.debug&&(B+="__eta.line="+M.lineNo+"\n"),E==="r"?(z.autoFilter&&(S="__eta.f("+S+")"),B+="__eta.res+="+S+"\n"):E==="i"?(z.autoFilter&&(S="__eta.f("+S+")"),z.autoEscape&&(S="__eta.e("+S+")"),B+="__eta.res+="+S+"\n"):E==="e"&&(B+=S+"\n")}}return B}var WG={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function bG(q){return WG[q]}var YG={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(q){var z=String(q);return/[&<>"']/.test(z)?z.replace(/[&<>"']/g,bG):z},filterFunction:function(q){return String(q)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},g=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,p=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,m=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function c(q){return q.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function CG(q,z){return q.slice(0,z).split("\n").length}function AG(q){var z=this.config,K=[],Q=!1,B=0,M=z.parse;if(z.plugins)for(var E=0;E<z.plugins.length;E++){var S=z.plugins[E];S.processTemplate&&(q=S.processTemplate(q,z))}function f(C,y){C&&(C=function(A,o,n,t){var T,N;return Array.isArray(o.autoTrim)?(T=o.autoTrim[1],N=o.autoTrim[0]):T=N=o.autoTrim,(n||n===!1)&&(T=n),(t||t===!1)&&(N=t),N||T?T==="slurp"&&N==="slurp"?A.trim():(T==="_"||T==="slurp"?A=A.trimStart():T!=="-"&&T!=="nl"||(A=A.replace(/^(?:\r\n|\n|\r)/,"")),N==="_"||N==="slurp"?A=A.trimEnd():N!=="-"&&N!=="nl"||(A=A.replace(/(?:\r\n|\n|\r)$/,"")),A):A}(C,z,Q,y),C&&(C=C.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),K.push(C)))}z.rmWhitespace&&(q=q.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),g.lastIndex=0,p.lastIndex=0,m.lastIndex=0;for(var W,s=[M.exec,M.interpolate,M.raw].reduce(function(C,y){return C&&y?C+"|"+c(y):y?c(y):C},""),u=new RegExp(c(z.tags[0])+"(-|_)?\\s*("+s+")?\\s*","g"),b=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+c(z.tags[1])+")","g");W=u.exec(q);){var fG=q.slice(B,W.index);B=W[0].length+W.index;var i=W[2]||"";f(fG,W[1]),b.lastIndex=B;for(var P=void 0,d=!1;P=b.exec(q);){if(P[1]){var _G=q.slice(B,P.index);u.lastIndex=B=b.lastIndex,Q=P[2],d={t:i===M.exec?"e":i===M.raw?"r":i===M.interpolate?"i":"",val:_G};break}var l=P[0];if(l==="/*"){var KG=q.indexOf("*/",b.lastIndex);KG===-1&&H("unclosed comment",q,P.index),b.lastIndex=KG}else l==="'"?(p.lastIndex=P.index,p.exec(q)?b.lastIndex=p.lastIndex:H("unclosed string",q,P.index)):l==='"'?(m.lastIndex=P.index,m.exec(q)?b.lastIndex=m.lastIndex:H("unclosed string",q,P.index)):l==="`"&&(g.lastIndex=P.index,g.exec(q)?b.lastIndex=g.lastIndex:H("unclosed string",q,P.index))}d?(z.debug&&(d.lineNo=CG(q,W.index)),K.push(d)):H("unclosed tag",q,W.index)}if(f(q.slice(B,q.length),!1),z.plugins)for(var r=0;r<z.plugins.length;r++){var DG=z.plugins[r];DG.processAST&&(K=DG.processAST(K,z))}return K}function ZG(q,z){var K=z&&z.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!q.startsWith("@")){var Q=z.filepath,B=K.get(Q);if(this.config.cache&&B)return B;var M=this.readFile(Q),E=this.compile(M,z);return this.config.cache&&K.define(Q,E),E}var S=K.get(q);if(S)return S;throw new x("Failed to get template '"+q+"'")}function qG(q,z,K){var Q,B=J({},K,{async:!1});return typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(B.filepath=this.resolvePath(q,B)),Q=ZG.call(this,q,B)):Q=q,Q.call(this,z,B)}function zG(q,z,K){var Q,B=J({},K,{async:!0});typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(B.filepath=this.resolvePath(q,B)),Q=ZG.call(this,q,B)):Q=q;var M=Q.call(this,z,B);return Promise.resolve(M)}function wG(q,z){var K=this.compile(q,{async:!1});return qG.call(this,K,z)}function TG(q,z){var K=this.compile(q,{async:!0});return zG.call(this,K,z)}var NG=function(){function q(K){this.config=void 0,this.RuntimeErr=R,this.compile=w,this.compileToString=U,this.compileBody=j,this.parse=AG,this.render=qG,this.renderAsync=zG,this.renderString=wG,this.renderStringAsync=TG,this.filepathCache={},this.templatesSync=new I({}),this.templatesAsync=new I({}),this.resolvePath=null,this.readFile=null,this.config=K?J({},YG,K):J({},YG)}var z=q.prototype;return z.configure=function(K){this.config=J({},this.config,K)},z.withConfig=function(K){return J({},this,{config:J({},this.config,K)})},z.loadTemplate=function(K,Q,B){if(typeof Q=="string")(B&&B.async?this.templatesAsync:this.templatesSync).define(K,this.compile(Q,B));else{var M=this.templatesSync;(Q.constructor.name==="AsyncFunction"||B&&B.async)&&(M=this.templatesAsync),M.define(K,Q)}},q}(),jG=function(q){function z(){return q.apply(this,arguments)||this}return X(z,q),z}(NG);G.Eta=jG})});var L={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},gG=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class h{constructor(G,J,X,Z){this.tagName=G,this.attributes=J,this.children=X,this.content=Z,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let G=this.content||"";for(let J of this.children)G+=J.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${G}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(G){if(this.isRemoved)return null;if(this.attributes.id===G)return this;for(let J of this.children){const X=J.getElementById(G);if(X)return X}return null}getElementsByClass(G){if(this.isRemoved)return[];const J=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(G))J.push(this);for(let X of this.children)J.push(...X.getElementsByClass(G));return J}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(G){if(G.includes("*"))return;const J={};for(let[X,Z]of Object.entries(this.attributes))if(G.includes(X))J[X]=Z;this.attributes=J;for(let X of this.children)X.filterAttributes(G)}getAttributesString(){return Object.entries(this.attributes).map(([G,J])=>` ${G}="${J}"`).join("")}static create(G){const J=h.tokenize(G),X=[],Z=[];let Y=null,D={},V="";for(let I of J)switch(I.type){case L.TAG_OPEN:if(Y){if(Object.keys(Y.attributes).length===0)Y.attributes=D;Y.content=V.trim(),D={},V="",Z.push(Y)}Y=new h(I.value,{},[]);break;case L.ATTRIBUTE_NAME:D[I.value]="";break;case L.ATTRIBUTE_VALUE:const O=Object.keys(D).pop();D[O]=I.value;break;case L.TAG_CLOSE:case L.SELF_CLOSING_TAG:if(!Y)break;if(Y.isSelfClosing=I.type===L.SELF_CLOSING_TAG,Object.keys(Y.attributes).length===0)Y.attributes=D;if(!Y.content)Y.content=V;else Y.content+=" "+V;if(V="",D={},Z.length>0)Z[Z.length-1].children.push(Y);else X.push(Y);Y=Z.pop()||null;break;case L.TEXT:if(Y)V+=I.value;break}return X}static tokenize(G){const J=[];let X=0;while(X<G.length)if(G[X]==="<")if(G[X+1]==="/"){let Z=X+2;while(Z<G.length&&G[Z]!==">")Z++;J.push({type:L.TAG_CLOSE,value:G.slice(X+2,Z).trim()}),X=Z+1}else{let Z=X+1;while(Z<G.length&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")Z++;const Y=G.slice(X+1,Z).trim();J.push({type:L.TAG_OPEN,value:G.slice(X+1,Z).trim()});while(Z<G.length&&G[Z]!==">")if(G[Z]===" "){Z++;let D="";while(Z<G.length&&G[Z]!=="="&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")D+=G[Z],Z++;if(D!=="")J.push({type:L.ATTRIBUTE_NAME,value:D.trim().toLowerCase()});if(G[Z]==="="){Z++;const V=G[Z];Z++;let I="";while(Z<G.length&&G[Z]!==V)I+=G[Z],Z++;J.push({type:L.ATTRIBUTE_VALUE,value:I}),Z++}}else Z++;if(gG.has(Y.toLowerCase())&&G[Z]===">")J.push({type:L.SELF_CLOSING_TAG,value:Y});if(G[Z]===">")Z++;X=Z}else{let Z=X;while(Z<G.length&&G[Z]!=="<")Z++;J.push({type:L.TEXT,value:G.slice(X,Z)}),X=Z}return J}}function $G(G){return Object.keys(pG).find((J)=>J.toLowerCase()==G.toLocaleLowerCase())!=null}function FG(G,J){return import("data:text/javascript;charset=utf-8,"+J.join("\n")+encodeURIComponent(`${G}`)).then((Z)=>Z).catch((Z)=>{return console.error(Z),null})}function mG(G){switch(G.data?.___type){case"table":console.table(G.data);break;case"dir":console.dir(G.data);break;case"error":console.error(G.data);break;case"warn":console.warn(G.data);break;default:case"log":console.log(G.data);break}}function e(G){return G.replace(/<!--[\s\S]*?-->/g,"")}function v(G){OG.postMessage({...G,___type:"warn"})}var pG={number:{},string:{},bigint:{},color:{}};var k=Object.getPrototypeOf(async function(){}).constructor,OG=new BroadcastChannel("advect:log");OG.onmessage=(G)=>mG(G);var cG="<div>Hello<!-- This is a comment --></div>",uG=e(cG);console.log(uG);var VG={async prerender(G){return""},async load({urls:G}){const J=[],X=[];if(Array.isArray(G))X.push(...G);if(typeof G=="string")X.push(G);for(let Z of X){const Y=await fetch(Z).then((D)=>D.text()).then(async(D)=>await this.build({template:D}));J.push(...Y)}return J},async build({template:G}){const J=e(G),X=h.create(String.raw`${J}`),Z=[];console.log(J);for(let Y of X){const D={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(Y.tagName.toLowerCase()==="template"){if(!Y.attributes.id){v("advect Template must have an id that will become the tag name");continue}const I=Y.attributes.id;if(I.indexOf("-")===-1){v("advect Template tag name must contain a hyphen");continue}if(D.tagName=I,D.templateNode=Y,Y.attributes.root)D.root=Y.attributes.root;else D.root="light";if(Y.attributes.shadow)D.shadow=Y.attributes.shadow;else D.shadow="closed";const O=[...Y.children];while(O.length>0){const $=O.shift();if(!$)continue;if($.tagName==="settings")$.children.forEach((F)=>{if(F.tagName=="mutation"){if(D?.mutation?.attributeFilter&&F.attributes.attributeFilter)D.mutation.attributeFilter=F.attributes.attributeFilter.split(",");if(D?.mutation?.attributes&&F.attributes.attributes)D.mutation.attributes=F.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.characterData&&F.attributes.characterData)D.mutation.characterData=F.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.childList&&F.attributes.childList)D.mutation.childList=F.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.subtree&&F.attributes.subtree)D.mutation.subtree=F.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if(F.tagName=="intersection"){if(D?.intersection&&F.attributes.margin)D.intersection.margin=parseFloat(F.attributes.margin);if(D?.intersection.threshhold&&F.attributes.threshhold)D.intersection.threshhold=parseFloat(F.attributes.threshhold);if(D?.intersection.root&&F.attributes.root)D.intersection.root=F.attributes.root}if(F.tagName=="attr"&&F.attributes.name){const x=F.attributes.name,H=F.attributes.type??"string";if($G(H))D.watched_attrs[x]={type:H}}F.remove()}),$.remove();if($.tagName==="script"){if($.attributes.type?.toLocaleLowerCase()==="text/adv"&&$.attributes.type){const F=new URL($.attributes.src);this.load({urls:F.toString()})}if($.attributes.type?.toLocaleLowerCase()==="module"&&!$.attributes.src)D.module=$.text()}if($.attributes.ref)D.refs.push($);O.push(...$.children)}}const V=Y.children.map((I)=>I.html()).join("");D.template=V,Z.push(D)}return Z}};var GG=BG(SG(),1);var UG=BG(HG(),1);function xG(G,J){const[X,Z]=J.tags,Y=J.parse.exec,D=$(G),V=F(D),I=x(V),O=H(I);function $(R){return R.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function F(R){return R.replace(/<if check="([^"]+)">/g,`${X}${Y} if ( \$1 ) { ${Z}`).replace(/<else\/?>/g,`${X}${Y} } else { ${Z}`).replace(/<\/if>/g,`${X}${Y} } ${Z}`)}function x(R){return R.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(_,w,U,j){if(U&&j)return`${X}${Y} ${w}.forEach(function(${U}, ${j}){ ${Z}`;else if(U)return`${X}${Y} ${w}.forEach(function(${U}){ ${Z}`;else return`${X}${Y} ${w}.forEach(function(){ ${Z}`}).replace(/<\/for>/g,`${X}${Y} }) ${Z}`)}function H(R){return R.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(_,w,U,j){if(U&&j)return`${X}${Y} Object.keys(${w}).forEach(function(${U}) { ${Z} 
                        ${X}${Y} const ${j} = ${w}[${U}] ${Z}
                    `;else if(U)return`${X}${Y} Object.keys(${w}).forEach(function(${U}) { ${Z}`;else return`${X}${Y} Object.keys(${w}).forEach(function() { ${Z}`}).replace(/<\/of>/g,`${X}${Y} }) ${Z}`)}return O}var RG=(G)=>{let J;const X=new Set,Z=($,F)=>{const x=typeof $==="function"?$(J):$;if(!Object.is(x,J)){const H=J;J=(F!=null?F:typeof x!=="object"||x===null)?x:Object.assign({},J,x),X.forEach((R)=>R(J,H))}},Y=()=>J,I={setState:Z,getState:Y,getInitialState:()=>O,subscribe:($)=>{return X.add($),()=>X.delete($)}},O=J=G(Z,Y,I);return I},LG=(G)=>G?RG(G):RG;function iG(G){return new Promise((J,X)=>{if(!G.isConnected){J(null);return}if(G.tagName.indexOf("-")==-1){J(G);return}if(!G.matches(":defined"))customElements.whenDefined(G.tagName).then((D)=>{J(G)}).catch((D)=>{X(D)});J(G)})}var lG=async()=>{const G=new Map,J=await GG.default(new URL("advect.sharedworker.js",import.meta.url).href),X=new SharedWorker(J,{type:"module"});return X.onerror=(Y)=>{console.warn("error",Y)},X.port.onmessage=(Y)=>{const D=G.has(Y.data.$id)&&G.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)D.resolve(Y),G.delete(Y.data.$id)},{messagePromise:async(Y,D)=>{return new Promise((V,I)=>{const O=Math.random().toString(36).substr(2,9);G.set(O,{resolve:V,reject:I}),X.port.postMessage({action:Y,data:D,$id:O})})},worker:X,type:"shared"}},oG=async()=>{const G=new Map,J=await GG.default(new URL("advect.worker.js",import.meta.url).href),X=new Worker(J,{type:"module"});return X.onerror=(Y)=>{console.error("error",Y)},X.onmessage=(Y)=>{const D=G.has(Y.data.$id)&&G.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)D.resolve(Y),G.delete(Y.data.$id)},{messagePromise:async(Y,D)=>{return new Promise((V,I)=>{const O=Math.random().toString(36).substr(2,9);G.set(O,{resolve:V,reject:I}),X.postMessage({action:Y,data:D,$id:O})})},worker:X,type:"dedicated"}},aG=()=>{const G=new BroadcastChannel("advect:noworker"),J=new BroadcastChannel("advect:noworker");G.onmessageerror=(Y)=>console.error(Y),G.onmessage=(Y)=>{const D=X.has(Y.data.$id)&&X.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)VG[Y.data.action].call(null,Y.data.data).then((V)=>{Y.data.result=V,D.resolve(Y),X.delete(Y.data.$id)})};const X=new Map;return{messagePromise:async(Y,D)=>{return new Promise((V,I)=>{const O=Math.random().toString(36).substr(2,9);X.set(O,{resolve:V,reject:I}),J.postMessage({action:Y,data:D,$id:O})})},worker:null,type:"no-worker"}},sG=async()=>{const G=new URL(import.meta.url).searchParams.get("type")?.toLocaleLowerCase();let J;switch(G){case"d":J=(await oG()).messagePromise;break;case"s":J=(await lG()).messagePromise;break;default:J=aG().messagePromise;break}const X=async(I)=>{return J("prerender",I)},Z=async(I)=>{const $=(await J("load",{urls:I})).data.result;return Y($)},Y=(I,O=!0)=>{const $=[];for(let F of I){const x=F;FG(F.module,[]).then((H)=>{const R=H?.default;console.log(H.export);const _=class extends(R||XG){static observedAttributes=Object.keys(x.watched_attrs);static settings=x};if(O)console.log(F),customElements.define(F.tagName,_);$.push(_)})}return $},D=async(I)=>{const $=(await J("build",{template:I})).data.result;return Y($)},V=(I)=>{document.querySelectorAll("template[id][adv]").forEach(($)=>D($.outerHTML));let O=[];document.querySelectorAll('script[type="text/adv"][src]').forEach(($)=>{if($.hasAttribute("src"))O.push($.getAttribute("src")??"")}),Z(O),document.removeEventListener("DOMContentLoaded",V)};if(document.readyState!=="loading")V(null);else document.addEventListener("DOMContentLoaded",V);return{render:X,build:D,load:Z}};class JG extends HTMLElement{anyAttrChanged(G,J){}attr=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.getAttribute(J);return null},set:(G,J,X)=>{if(this.isConnected)return this.setAttribute(J,X),this.anyAttrChanged(J,X),!0;return!1}});data=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.dataset[J];return null},set:(G,J,X)=>{if(this.isConnected)return this.dataset[J]=X,this.anyAttrChanged("data-"+J,X),!0;return!1}});#G;get internals(){return this.#G}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(G,J,X)=>{};attributeChangedCallback(G,J,X){this?.onAttributeChange(G,J,X)}onConnect=()=>{};connectedCallback(){this.#G=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(G,J,X){if(super.addEventListener(G,J,X),G=="connect"&&this.isConnected)J(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(G)=>{};onIntersect=(G)=>{}}class XG extends JG{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}refs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return X;return null}});fuzzyRefs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return iG(X);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.#G(),this.#z(),this?.onConnect()}#G(){switch(this.$settings?.root){case"none":break;case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}#J(){this.shadowRoot?.querySelectorAll("[ref]").forEach((G)=>{this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((X)=>X.startsWith("on")).forEach((X)=>{const Z=G.getAttribute(X)??"";if(X.toLowerCase()==="onmutate")G.addEventListener("adv:mutation",(Y)=>{try{new k("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}catch(D){console.error(D,Z,this)}});else try{G[X]=(Y)=>{new k("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}}catch(Y){console.error(Y,Z,this)}})})}#Z(){this?.querySelectorAll("[ref]").forEach((G)=>{this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((X)=>X.startsWith("on")).forEach((X)=>{const Z=G.getAttribute(X)??"";try{G[X]=(Y)=>{new k("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}}catch(Y){console.error(Y,Z,this)}})})}#q(){this.getAttributeNames().filter((G)=>G.startsWith("on")).forEach((G)=>{const J=this.getAttribute(G)??"";if(G.toLowerCase()==="onmutate"){this.onMutation=(X)=>new k("$self","event",J)(this,X);return}this[G]=(X)=>new k("$self","event",J)(this,X)})}#z(){this.#q(),this.#Z(),this.#J()}#X;get mutationObserver(){return this.#X}createMutationObserver(){if(this.$settings.mutation){if(this.#X=new MutationObserver((G,J)=>{this?.onMutation(G)}),this.#X.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#X.observe(this.shadowRoot,{...this.$settings.mutation})}}#Y;get interectObserver(){return this.#Y}createIntersectObserver(){if(this.$settings.intersection){let G=void 0;if(this.$settings?.intersection?.root)G=this.querySelector(this.$settings?.intersection?.root);this.#Y=new IntersectionObserver((J,X)=>{this.onIntersect(J)},{...this.$settings.intersection,root:G})}}}class PG extends JG{anyAttrChanged(G,J){this.render()}#G=new UG.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#J=LG((G,J)=>({}));get store(){return this.#J}get state(){return this.#J?.getState()}connectedCallback(){this.attachShadow({mode:"open"}),this.#J.subscribe((G,J)=>{this.render()}),this.render(),super.connectedCallback()}get eta(){return this.#G}render(){const G=xG(this.innerHTML,this.#G.config);let J="";try{J=this.eta.renderString(G,{$self:this})}catch(Z){v(Z)}const X=`<div style="display:contents;" part="root">${J}</div>`;if(this.shadowRoot)this.shadowRoot.innerHTML=X}}if(!customElements.get("adv-view"))customElements.define("adv-view",PG);window.AdvectElement=XG;var $J=await sG();export{iG as refHandle,$J as advect,PG as AdvectView,XG as AdvectElement,JG as AdvectBase};
