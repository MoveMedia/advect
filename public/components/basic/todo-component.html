<template id="todo-component" adv>
    <script>
        // Reference the elements in the component (any element with an id attribute)
        const { todo_view, todo_dialog, new_todo_form, todo_name_input } = refs
        // Define data for the compnent, 
        let todos = []
        // Define the "scope" of functionality for the component
        const scope = {
            toggleComplete(todoEl) {
                todos.forEach(todo => {
                    if (todo.id === todoEl.dataset.id) {
                        todo.complete = !todo.complete;
                    }
                });
                this.update();
            },
            addTodo(event) {
                const todo = {
                    id: `todo_${todos.length + 1}`,
                    title: todo_name_input.value,
                    complete: false
                }
                todos.push(todo);
                new_todo_form.reset()
                this.update();

            },
            removeTodo(todoEl) {
                todos = todos.filter(todo => todo.id !== todoEl.dataset.id);
                this.update();
            },
            update() {
                todo_view.render({ todos });
            }
        }

        // Include local scope into the advect-view
        todo_view.mergeScope(scope);
        todo_view.mergeStyles(self.shadowRoot?.adoptedStyleSheets)
        // update the view
        scope.update();
        // return the scope
        return scope;
    </script>
    <style>
        .todo-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            &[data-complete="true"]  header {
                text-decoration: line-through;
            }
        }
    </style>
    <dialog id="todo_dialog">
        <form id="new_todo_form" method="dialog" onsubmit="scope.addTodo(event)">
            <input type="text" name="todo" id="todo_name_input" placeholder="Add a todo">
            <input type="submit" value="Submit">
        </form>
    </dialog>
    <div>
        <button id="add_btn" onclick="refs.todo_dialog.showModal()">Add Todo</button>
    </div>
    <ul>
        <adv-view id="todo_view">
            {{#todos}}
            <li data-title="{{title}}" id="{{id}}" data-id="{{id}}" data-complete="{{complete}}" class="todo-item">
                <header>
                    {{title}}
                </header>
                <div>
                    <button id="complete_{{id}}" data-id="{{id}}" onclick="scope.toggleComplete(el.closest('li'))">
                        {{#complete}}
                        <span>
                            Mark incomplete
                        </span>
                        {{/complete}}
                        {{^complete}}
                        <span>
                            Mark complete
                        </span>
                        {{/complete}}
                    </button>
                    <button id="delete_{{id}}" onclick="scope.removeTodo(el.closest('li'))">
                        Delete
                    </button>
                </div>
            </li>
            {{/todos}}
            {{^todos}}
                <li>No todos yet</li>
            {{/todos}}
        </adv-view>
    </ul>
</template>