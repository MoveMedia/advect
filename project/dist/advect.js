var mG=Object.create;var{getPrototypeOf:pG,defineProperty:FG,getOwnPropertyNames:cG}=Object;var uG=Object.prototype.hasOwnProperty;var $G=(G,J,X)=>{X=G!=null?mG(pG(G)):{};const Z=J||!G||!G.__esModule?FG(X,"default",{value:G,enumerable:!0}):X;for(let Y of cG(G))if(!uG.call(Z,Y))FG(Z,Y,{get:()=>G[Y],enumerable:!0});return Z};var OG=(G,J)=>()=>(J||G((J={exports:{}}).exports,J),J.exports);var PG=OG((KJ,RG)=>{var sG=(G,J={})=>{const X={skipSameOrigin:!0,useBlob:!0,...J};if(!G.includes("://")||G.includes(window.location.origin))return Promise.resolve(G);return new Promise((Z,Y)=>fetch(G).then((D)=>D.text()).then((D)=>{let M=new URL(G).href.split("/");M.pop();const I=`const _importScripts = importScripts;
const _fixImports = (url) => new URL(url, '${M.join("/")+"/"}').href;
importScripts = (...urls) => _importScripts(...urls.map(_fixImports));`;let O="data:application/javascript,"+encodeURIComponent(I+D);if(X.useBlob)O=URL.createObjectURL(new Blob([`importScripts("${O}")`],{type:"application/javascript"}));Z(O)}).catch(Y))};RG.exports=sG});var WG=OG((a,UG)=>{(function(G,J){typeof a=="object"&&typeof UG!="undefined"?J(a):typeof define=="function"&&define.amd?define(["exports"],J):J((G||self).eta={})})(a,function(G){function J(){return J=Object.assign?Object.assign.bind():function(q){for(var z=1;z<arguments.length;z++){var K=arguments[z];for(var Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&(q[Q]=K[Q])}return q},J.apply(this,arguments)}function X(q,z){q.prototype=Object.create(z.prototype),q.prototype.constructor=q,Y(q,z)}function Z(q){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},Z(q)}function Y(q,z){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(K,Q){return K.__proto__=Q,K},Y(q,z)}function D(q,z,K){return D=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}()?Reflect.construct.bind():function(Q,B,H){var x=[null];x.push.apply(x,B);var E=new(Function.bind.apply(Q,x));return H&&Y(E,H.prototype),E},D.apply(null,arguments)}function M(q){var z=typeof Map=="function"?new Map:void 0;return M=function(K){if(K===null||Function.toString.call(K).indexOf("[native code]")===-1)return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(z!==void 0){if(z.has(K))return z.get(K);z.set(K,Q)}function Q(){return D(K,arguments,Z(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),Y(Q,K)},M(q)}var I=function(){function q(K){this.cache=void 0,this.cache=K}var z=q.prototype;return z.define=function(K,Q){this.cache[K]=Q},z.get=function(K){return this.cache[K]},z.remove=function(K){delete this.cache[K]},z.reset=function(){this.cache={}},z.load=function(K){this.cache=J({},this.cache,K)},q}(),O=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="Eta Error",Q}return X(z,q),z}(M(Error)),F=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaParser Error",Q}return X(z,q),z}(O),$=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaRuntime Error",Q}return X(z,q),z}(O),V=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaNameResolution Error",Q}return X(z,q),z}(O);function S(q,z,K){var Q=z.slice(0,K).split(/\n/),B=Q.length,H=Q[B-1].length+1;throw q+=" at line "+B+" col "+H+":\n\n  "+z.split(/\n/)[B-1]+"\n  "+Array(H).join(" ")+"^",new F(q)}function j(q,z,K,Q){var B=z.split("\n"),H=Math.max(K-3,0),x=Math.min(B.length,K+3),E=Q,_=B.slice(H,x).map(function(n,d){var b=d+H+1;return(b==K?" >> ":"    ")+b+"| "+n}).join("\n"),W=new $((E?E+":"+K+"\n":"line "+K+"\n")+_+"\n\n"+q.message);throw W.name=q.name,W}var h=function(){return Promise.resolve()}.constructor;function L(q,z){var K=this.config,Q=z&&z.async?h:Function;try{return new Q(K.varName,"options",this.compileToString.call(this,q,z))}catch(B){throw B instanceof SyntaxError?new F("Bad template syntax\n\n"+B.message+"\n"+Array(B.message.length+1).join("=")+"\n"+this.compileToString.call(this,q,z)+"\n"):B}}function i(q,z){var K=this.config,Q=z&&z.async,B=this.compileBody,H=this.parse.call(this,q),x=K.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(K.debug?', line: 1, templateStr: "'+q.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(K.debug?"try {":"")+(K.useWith?"with("+K.varName+"||{}){":"")+"\n\n"+B.call(this,H)+"\nif (__eta.layout) {\n  __eta.res = "+(Q?"await includeAsync":"include")+" (__eta.layout, {..."+K.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(K.useWith?"}":"")+(K.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(K.plugins)for(var E=0;E<K.plugins.length;E++){var _=K.plugins[E];_.processFnString&&(x=_.processFnString(x,K))}return x}function T(q){for(var z=this.config,K=0,Q=q.length,B="";K<Q;K++){var H=q[K];if(typeof H=="string")B+="__eta.res+='"+H+"'\n";else{var x=H.t,E=H.val||"";z.debug&&(B+="__eta.line="+H.lineNo+"\n"),x==="r"?(z.autoFilter&&(E="__eta.f("+E+")"),B+="__eta.res+="+E+"\n"):x==="i"?(z.autoFilter&&(E="__eta.f("+E+")"),z.autoEscape&&(E="__eta.e("+E+")"),B+="__eta.res+="+E+"\n"):x==="e"&&(B+=E+"\n")}}return B}var P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function f(q){return P[q]}var zG={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(q){var z=String(q);return/[&<>"']/.test(z)?z.replace(/[&<>"']/g,f):z},filterFunction:function(q){return String(q)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},m=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,p=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,c=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function u(q){return q.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function jG(q,z){return q.slice(0,z).split("\n").length}function fG(q){var z=this.config,K=[],Q=!1,B=0,H=z.parse;if(z.plugins)for(var x=0;x<z.plugins.length;x++){var E=z.plugins[x];E.processTemplate&&(q=E.processTemplate(q,z))}function _(C,y){C&&(C=function(A,s,e,GG){var w,N;return Array.isArray(s.autoTrim)?(w=s.autoTrim[1],N=s.autoTrim[0]):w=N=s.autoTrim,(e||e===!1)&&(w=e),(GG||GG===!1)&&(N=GG),N||w?w==="slurp"&&N==="slurp"?A.trim():(w==="_"||w==="slurp"?A=A.trimStart():w!=="-"&&w!=="nl"||(A=A.replace(/^(?:\r\n|\n|\r)/,"")),N==="_"||N==="slurp"?A=A.trimEnd():N!=="-"&&N!=="nl"||(A=A.replace(/(?:\r\n|\n|\r)$/,"")),A):A}(C,z,Q,y),C&&(C=C.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),K.push(C)))}z.rmWhitespace&&(q=q.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),m.lastIndex=0,p.lastIndex=0,c.lastIndex=0;for(var W,n=[H.exec,H.interpolate,H.raw].reduce(function(C,y){return C&&y?C+"|"+u(y):y?u(y):C},""),d=new RegExp(u(z.tags[0])+"(-|_)?\\s*("+n+")?\\s*","g"),b=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+u(z.tags[1])+")","g");W=d.exec(q);){var vG=q.slice(B,W.index);B=W[0].length+W.index;var r=W[2]||"";_(vG,W[1]),b.lastIndex=B;for(var U=void 0,l=!1;U=b.exec(q);){if(U[1]){var gG=q.slice(B,U.index);d.lastIndex=B=b.lastIndex,Q=U[2],l={t:r===H.exec?"e":r===H.raw?"r":r===H.interpolate?"i":"",val:gG};break}var o=U[0];if(o==="/*"){var BG=q.indexOf("*/",b.lastIndex);BG===-1&&S("unclosed comment",q,U.index),b.lastIndex=BG}else o==="'"?(p.lastIndex=U.index,p.exec(q)?b.lastIndex=p.lastIndex:S("unclosed string",q,U.index)):o==='"'?(c.lastIndex=U.index,c.exec(q)?b.lastIndex=c.lastIndex:S("unclosed string",q,U.index)):o==="`"&&(m.lastIndex=U.index,m.exec(q)?b.lastIndex=m.lastIndex:S("unclosed string",q,U.index))}l?(z.debug&&(l.lineNo=jG(q,W.index)),K.push(l)):S("unclosed tag",q,W.index)}if(_(q.slice(B,q.length),!1),z.plugins)for(var t=0;t<z.plugins.length;t++){var IG=z.plugins[t];IG.processAST&&(K=IG.processAST(K,z))}return K}function KG(q,z){var K=z&&z.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!q.startsWith("@")){var Q=z.filepath,B=K.get(Q);if(this.config.cache&&B)return B;var H=this.readFile(Q),x=this.compile(H,z);return this.config.cache&&K.define(Q,x),x}var E=K.get(q);if(E)return E;throw new V("Failed to get template '"+q+"'")}function DG(q,z,K){var Q,B=J({},K,{async:!1});return typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(B.filepath=this.resolvePath(q,B)),Q=KG.call(this,q,B)):Q=q,Q.call(this,z,B)}function QG(q,z,K){var Q,B=J({},K,{async:!0});typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(B.filepath=this.resolvePath(q,B)),Q=KG.call(this,q,B)):Q=q;var H=Q.call(this,z,B);return Promise.resolve(H)}function _G(q,z){var K=this.compile(q,{async:!1});return DG.call(this,K,z)}function yG(q,z){var K=this.compile(q,{async:!0});return QG.call(this,K,z)}var kG=function(){function q(K){this.config=void 0,this.RuntimeErr=j,this.compile=L,this.compileToString=i,this.compileBody=T,this.parse=fG,this.render=DG,this.renderAsync=QG,this.renderString=_G,this.renderStringAsync=yG,this.filepathCache={},this.templatesSync=new I({}),this.templatesAsync=new I({}),this.resolvePath=null,this.readFile=null,this.config=K?J({},zG,K):J({},zG)}var z=q.prototype;return z.configure=function(K){this.config=J({},this.config,K)},z.withConfig=function(K){return J({},this,{config:J({},this.config,K)})},z.loadTemplate=function(K,Q,B){if(typeof Q=="string")(B&&B.async?this.templatesAsync:this.templatesSync).define(K,this.compile(Q,B));else{var H=this.templatesSync;(Q.constructor.name==="AsyncFunction"||B&&B.async)&&(H=this.templatesAsync),H.define(K,Q)}},q}(),hG=function(q){function z(){return q.apply(this,arguments)||this}return X(z,q),z}(kG);G.Eta=hG})});var R={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},dG=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class v{constructor(G,J,X,Z){this.tagName=G,this.attributes=J,this.children=X,this.content=Z,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let G=this.content||"";for(let J of this.children)G+=J.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${G}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(G){if(this.isRemoved)return null;if(this.attributes.id===G)return this;for(let J of this.children){const X=J.getElementById(G);if(X)return X}return null}getElementsByClass(G){if(this.isRemoved)return[];const J=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(G))J.push(this);for(let X of this.children)J.push(...X.getElementsByClass(G));return J}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(G){if(G.includes("*"))return;const J={};for(let[X,Z]of Object.entries(this.attributes))if(G.includes(X))J[X]=Z;this.attributes=J;for(let X of this.children)X.filterAttributes(G)}getAttributesString(){return Object.entries(this.attributes).map(([G,J])=>` ${G}="${J}"`).join("")}static create(G){const J=v.tokenize(G),X=[],Z=[];let Y=null,D={},M="";for(let I of J)switch(I.type){case R.TAG_OPEN:if(Y){if(Object.keys(Y.attributes).length===0)Y.attributes=D;Y.content=M.trim(),D={},M="",Z.push(Y)}Y=new v(I.value,{},[]);break;case R.ATTRIBUTE_NAME:D[I.value]="";break;case R.ATTRIBUTE_VALUE:const O=Object.keys(D).pop();D[O]=I.value;break;case R.TAG_CLOSE:case R.SELF_CLOSING_TAG:if(!Y)break;if(Y.isSelfClosing=I.type===R.SELF_CLOSING_TAG,Object.keys(Y.attributes).length===0)Y.attributes=D;if(!Y.content)Y.content=M;else Y.content+=" "+M;if(M="",D={},Z.length>0)Z[Z.length-1].children.push(Y);else X.push(Y);Y=Z.pop()||null;break;case R.TEXT:if(Y)M+=I.value;break}return X}static tokenize(G){const J=[];let X=0;while(X<G.length)if(G[X]==="<")if(G[X+1]==="/"){let Z=X+2;while(Z<G.length&&G[Z]!==">")Z++;J.push({type:R.TAG_CLOSE,value:G.slice(X+2,Z).trim()}),X=Z+1}else{let Z=X+1;while(Z<G.length&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")Z++;const Y=G.slice(X+1,Z).trim();J.push({type:R.TAG_OPEN,value:G.slice(X+1,Z).trim()});while(Z<G.length&&G[Z]!==">")if(G[Z]===" "){Z++;let D="";while(Z<G.length&&G[Z]!=="="&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")D+=G[Z],Z++;if(D!=="")J.push({type:R.ATTRIBUTE_NAME,value:D.trim().toLowerCase()});if(G[Z]==="="){Z++;const M=G[Z];Z++;let I="";while(Z<G.length&&G[Z]!==M)I+=G[Z],Z++;J.push({type:R.ATTRIBUTE_VALUE,value:I}),Z++}}else Z++;if(dG.has(Y.toLowerCase())&&G[Z]===">")J.push({type:R.SELF_CLOSING_TAG,value:Y});if(G[Z]===">")Z++;X=Z}else{let Z=X;while(Z<G.length&&G[Z]!=="<")Z++;J.push({type:R.TEXT,value:G.slice(X,Z)}),X=Z}return J}}function MG(G){return Object.keys(lG).find((J)=>J.toLowerCase()==G.toLocaleLowerCase())!=null}function HG(G,J){return import("data:text/javascript;charset=utf-8,"+J.join("\n")+encodeURIComponent(`${G}`)).then((Z)=>Z).catch((Z)=>{return console.error(Z),null})}function oG(G){switch(G.data?.___type){case"table":console.table(G.data);break;case"dir":console.dir(G.data);break;case"error":console.error(G.data);break;case"warn":console.warn(G.data);break;default:case"log":console.log(G.data);break}}function xG(G){return G.replace(/<!--[\s\S]*?-->/g,"")}function VG(G){return G.toLowerCase().split("-").map((J)=>J.charAt(0).toUpperCase()+J.slice(1)).join("")}function k(G){EG.postMessage({...G,___type:"warn"})}var lG={number:{},string:{},bigint:{},color:{}};var g=Object.getPrototypeOf(async function(){}).constructor,EG=new BroadcastChannel("advect:log");EG.onmessage=(G)=>oG(G);var SG=["body","iframe","img","link","object","script","style","audio","video"];var LG={async prerender(G){return""},async load({urls:G}){const J=[],X=[];if(Array.isArray(G))X.push(...G);if(typeof G=="string")X.push(G);for(let Z of X){const Y=await fetch(Z).then((D)=>D.text()).then(async(D)=>await this.build({template:D}));J.push(...Y)}return J},async build({template:G}){const J=xG(G),X=v.create(String.raw`${J}`),Z=[];for(let Y of X){const D={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(Y.tagName.toLowerCase()==="template"){if(!Y.attributes.id){k("advect Template must have an id that will become the tag name");continue}const I=Y.attributes.id;if(I.indexOf("-")===-1){k("advect Template tag name must contain a hyphen");continue}if(D.tagName=I,D.templateNode=Y,Y.attributes.root)D.root=Y.attributes.root;else D.root="light";if(Y.attributes.shadow)D.shadow=Y.attributes.shadow;else D.shadow="closed";const O=[...Y.children];while(O.length>0){const F=O.shift();if(!F)continue;if(F.tagName==="settings")F.children.forEach(($)=>{if($.tagName=="mutation"){if(D?.mutation?.attributeFilter&&$.attributes.attributeFilter)D.mutation.attributeFilter=$.attributes.attributeFilter.split(",");if(D?.mutation?.attributes&&$.attributes.attributes)D.mutation.attributes=$.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.characterData&&$.attributes.characterData)D.mutation.characterData=$.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.childList&&$.attributes.childList)D.mutation.childList=$.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.subtree&&$.attributes.subtree)D.mutation.subtree=$.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if($.tagName=="intersection"){if(D?.intersection&&$.attributes.margin)D.intersection.margin=parseFloat($.attributes.margin);if(D?.intersection.threshhold&&$.attributes.threshhold)D.intersection.threshhold=parseFloat($.attributes.threshhold);if(D?.intersection.root&&$.attributes.root)D.intersection.root=$.attributes.root}if($.tagName=="attr"&&$.attributes.name){const V=$.attributes.name,S=$.attributes.type??"string";if(MG(S))D.watched_attrs[V]={type:S}}$.remove()}),F.remove();if(F.tagName==="script"){if(F.attributes.type?.toLocaleLowerCase()==="text/adv"&&F.attributes.type){const $=new URL(F.attributes.src);this.load({urls:$.toString()})}if(F.attributes.type?.toLocaleLowerCase()==="module"&&!F.attributes.src)D.module=F.text()}if(F.attributes.ref)D.refs.push(F);O.push(...F.children)}}const M=Y.children.map((I)=>I.html()).join("");D.template=M,Z.push(D)}return Z}};var XG=$G(PG(),1);var AG=$G(WG(),1);function JG(G,J){const[X,Z]=J.tags,Y=J.parse.exec,D=$(G),M=h(D),I=V(M),O=S(I),F=j(O);function $(L){return L.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function V(L){return L.replace(/<if check="([^"]+)">/g,`${X}${Y} if ( \$1 ) { ${Z}`).replace(/<else\/?>/g,`${X}${Y} } else { ${Z}`).replace(/<\/if>/g,`${X}${Y} } ${Z}`)}function S(L){return L.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(i,T,P,f){if(P&&f)return`${X}${Y} ${T}.forEach(function(${P}, ${f}){ ${Z}`;else if(P)return`${X}${Y} ${T}.forEach(function(${P}){ ${Z}`;else return`${X}${Y} ${T}.forEach(function(){ ${Z}`}).replace(/<\/for>/g,`${X}${Y} }) ${Z}`)}function j(L){return L.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(i,T,P,f){if(P&&f)return`${X}${Y} Object.keys(${T}).forEach(function(${P}) { ${Z} 
                        ${X}${Y} const ${f} = ${T}[${P}] ${Z}
                    `;else if(P)return`${X}${Y} Object.keys(${T}).forEach(function(${P}) { ${Z}`;else return`${X}${Y} Object.keys(${T}).forEach(function() { ${Z}`}).replace(/<\/of>/g,`${X}${Y} }) ${Z}`)}function h(L){return L.replace(/(?!{{~)(<adv-view\b[^>]*>.*?<\/adv-view>)(?<!}})/g,"{{~$1}}")}return F}var bG=(G)=>{let J;const X=new Set,Z=(F,$)=>{const V=typeof F==="function"?F(J):F;if(!Object.is(V,J)){const S=J;J=($!=null?$:typeof V!=="object"||V===null)?V:Object.assign({},J,V),X.forEach((j)=>j(J,S))}},Y=()=>J,I={setState:Z,getState:Y,getInitialState:()=>O,subscribe:(F)=>{return X.add(F),()=>X.delete(F)}},O=J=G(Z,Y,I);return I},CG=(G)=>G?bG(G):bG;function TG(G){return new Promise((J,X)=>{if(!G.isConnected){J(null);return}if(G.tagName.indexOf("-")==-1){J(G);return}if(!G.matches(":defined"))customElements.whenDefined(G.tagName).then((D)=>{J(G)}).catch((D)=>{X(D)});J(G)})}var iG=async()=>{const G=new Map,J=await XG.default(new URL("advect.sharedworker.js",import.meta.url).href),X=new SharedWorker(J,{type:"module"});return X.onerror=(Y)=>{console.warn("error",Y)},X.port.onmessage=(Y)=>{const D=G.has(Y.data.$id)&&G.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)D.resolve(Y),G.delete(Y.data.$id)},{messagePromise:async(Y,D)=>{return new Promise((M,I)=>{const O=Math.random().toString(36).substr(2,9);G.set(O,{resolve:M,reject:I}),X.port.postMessage({action:Y,data:D,$id:O})})},worker:X,type:"shared"}},nG=async()=>{const G=new Map,J=await XG.default(new URL("advect.worker.js",import.meta.url).href),X=new Worker(J,{type:"module"});return X.onerror=(Y)=>{console.error("error",Y)},X.onmessage=(Y)=>{const D=G.has(Y.data.$id)&&G.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)D.resolve(Y),G.delete(Y.data.$id)},{messagePromise:async(Y,D)=>{return new Promise((M,I)=>{const O=Math.random().toString(36).substr(2,9);G.set(O,{resolve:M,reject:I}),X.postMessage({action:Y,data:D,$id:O})})},worker:X,type:"dedicated"}},rG=()=>{const G=new BroadcastChannel("advect:noworker"),J=new BroadcastChannel("advect:noworker");G.onmessageerror=(Y)=>console.error(Y),G.onmessage=(Y)=>{const D=X.has(Y.data.$id)&&X.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)LG[Y.data.action].call(null,Y.data.data).then((M)=>{Y.data.result=M,D.resolve(Y),X.delete(Y.data.$id)})};const X=new Map;return{messagePromise:async(Y,D)=>{return new Promise((M,I)=>{const O=Math.random().toString(36).substr(2,9);X.set(O,{resolve:M,reject:I}),J.postMessage({action:Y,data:D,$id:O})})},worker:null,type:"no-worker"}},tG=async()=>{const G=new URL(import.meta.url).searchParams.get("type")?.toLocaleLowerCase();let J;switch(G){case"d":J=(await nG()).messagePromise;break;case"s":J=(await iG()).messagePromise;break;default:J=rG().messagePromise;break}const X=async(I)=>{return J("prerender",I)},Z=async(I)=>{const F=(await J("load",{urls:I})).data.result;return Y(F)},Y=(I,O=!0)=>{const F=[];for(let $ of I){const V=$;HG($.module,[]).then((S)=>{const j=VG($.tagName),h=S[j],L=class extends(h||ZG){static observedAttributes=Object.keys(V.watched_attrs);static settings=V};if(O)customElements.define($.tagName,L);F.push(L)})}return F},D=async(I)=>{const F=(await J("build",{template:I})).data.result;return Y(F)},M=(I)=>{document.querySelectorAll("template[id][adv]").forEach((F)=>D(F.outerHTML));let O=[];document.querySelectorAll('script[type="text/adv"][src]').forEach((F)=>{if(F.hasAttribute("src"))O.push(F.getAttribute("src")??"")}),Z(O),document.removeEventListener("DOMContentLoaded",M)};if(document.readyState!=="loading")M(null);else document.addEventListener("DOMContentLoaded",M);return{render:X,build:D,load:Z}};class YG extends HTMLElement{anyAttrChanged(G,J){}attr=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.getAttribute(J);return null},set:(G,J,X)=>{if(this.isConnected)return this.setAttribute(J,X),this.anyAttrChanged(J,X),!0;return!1}});data=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.dataset[J];return null},set:(G,J,X)=>{if(this.isConnected)return this.dataset[J]=X,this.anyAttrChanged("data-"+J,X),!0;return!1}});#G;get internals(){return this.#G}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(G,J,X)=>{};attributeChangedCallback(G,J,X){this?.onAttributeChange(G,J,X)}onConnect=()=>{};connectedCallback(){this.#G=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(G,J,X){if(super.addEventListener(G,J,X),G=="connect"&&this.isConnected)J(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(G)=>{};onIntersect=(G)=>{}}class ZG extends YG{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}get all_refs(){return[...this.querySelectorAll("[ref]"),...this?.shadowRoot?.querySelectorAll("[ref]")]}refs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return X;return null}});fuzzyRefs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return TG(X);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.#G(),this.#z(),this?.onConnect()}#G(){switch(this.$settings?.root){case"none":break;case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}hookRef(G){if(this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),Object.defineProperty(G,"binder",{value:this,writable:!1}),G.getAttributeNames().filter((X)=>X.startsWith("on")).forEach((X)=>{const Z=G.getAttribute(X)??"";if(X.toLowerCase()==="onmutate")G.addEventListener("adv:mutation",(Y)=>{try{new g("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}catch(D){console.error(D,Z,this)}});else try{G[X]=(Y)=>{new g("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}}catch(Y){console.error(Y,Z,this)}}),G.matches("[onload]")&&!SG.find((X)=>X===G.tagName.toLocaleLowerCase()))G.dispatchEvent(new Event("load",{bubbles:!1}))}#J(){this.shadowRoot?.querySelectorAll("[ref]").forEach((G)=>{this.hookRef(G)})}#Z(){this?.querySelectorAll("[ref]").forEach((G)=>{this.hookRef(G)})}#q(){this.getAttributeNames().filter((G)=>G.startsWith("on")).forEach((G)=>{const J=this.getAttribute(G)??"";if(G.toLowerCase()==="onmutate"){this.onMutation=(X)=>new g("$self","event",J)(this,X);return}this[G]=(X)=>new g("$self","event",J)(this,X)})}#z(){this.#q(),this.#Z(),this.#J()}#X;get mutationObserver(){return this.#X}createMutationObserver(){if(this.$settings.mutation){if(this.#X=new MutationObserver((G,J)=>{this?.onMutation(G)}),this.#X.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#X.observe(this.shadowRoot,{...this.$settings.mutation})}}#Y;get interectObserver(){return this.#Y}createIntersectObserver(){if(this.$settings.intersection){let G=void 0;if(this.$settings?.intersection?.root)G=this.querySelector(this.$settings?.intersection?.root);this.#Y=new IntersectionObserver((J,X)=>{this.onIntersect(J)},{...this.$settings.intersection,root:G})}}}class qG extends YG{anyAttrChanged(G,J){this.render()}#G=new AG.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#J=CG((G,J)=>({}));get store(){return this.#J}get state(){return this.#J?.getState()}viewTransition=!0;refs=new Proxy({},{get:(G,J)=>{const X=this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return X;return null}});fuzzyRefs=new Proxy({},{get:(G,J)=>{const X=this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return TG(X);return null}});get all_refs(){return[...this?.shadowRoot?.querySelectorAll("[ref]")]}connectedCallback(){super.connectedCallback(),this.#J.subscribe((G,J)=>{this.render()}),requestAnimationFrame(()=>{this.render()})}get eta(){return this.#G}render(){}onRender=()=>{};afterRender(){if(this.onRender)this.onRender()}}class wG extends qG{render(){const G=this.querySelector("template"),J=this.querySelector("output"),X=JG(G?.innerHTML??"",this.eta.config);let Z="";try{Z=this.eta.renderString(X,{$self:this})}catch(D){k(D)}const Y=`${Z}`;if(this.viewTransition)document.startViewTransition(()=>{if(J)J.innerHTML=Y}).finished.then(()=>{this.afterRender()});else if(J)J.innerHTML=Y,requestAnimationFrame(()=>{this.afterRender()})}}class NG extends qG{connectedCallback(){this.attachShadow({mode:"open"}),super.connectedCallback()}render(){const G=JG(this.innerHTML,this.eta.config);let J="";try{J=this.eta.renderString(G,{$self:this})}catch(Z){k(Z)}const X=`<div style="display:contents;" part="root">${J}</div>`;if(this.shadowRoot){const Z=this.shadowRoot;if(this.viewTransition)document.startViewTransition(()=>{Z.innerHTML=X}).finished.then(()=>{this.afterRender()});else Z.innerHTML=X,requestAnimationFrame(()=>{this.afterRender()})}}}if(!customElements.get("adv-view"))customElements.define("adv-view",wG);if(!customElements.get("adv-shadow-view"))customElements.define("adv-shadow-view",NG);window.AdvectElement=ZG;var $J=await tG();export{TG as refHandle,$J as advect,wG as AdvectView,NG as AdvectShadowView,ZG as AdvectElement,YG as AdvectBase};
