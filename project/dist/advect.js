var CK=Object.create;var{getPrototypeOf:fK,defineProperty:zK,getOwnPropertyNames:AK}=Object;var TK=Object.prototype.hasOwnProperty;var yK=(K,J,Y)=>{Y=K!=null?CK(fK(K)):{};const G=J||!K||!K.__esModule?zK(Y,"default",{value:K,enumerable:!0}):Y;for(let X of AK(K))if(!TK.call(G,X))zK(G,X,{get:()=>K[X],enumerable:!0});return G};var NK=(K,J)=>()=>(J||K((J={exports:{}}).exports,J),J.exports);var OK=NK((s,DK)=>{(function(K,J){typeof s=="object"&&typeof DK!="undefined"?J(s):typeof define=="function"&&define.amd?define(["exports"],J):J((K||self).eta={})})(s,function(K){function J(){return J=Object.assign?Object.assign.bind():function(Z){for(var q=1;q<arguments.length;q++){var z=arguments[q];for(var F in z)Object.prototype.hasOwnProperty.call(z,F)&&(Z[F]=z[F])}return Z},J.apply(this,arguments)}function Y(Z,q){Z.prototype=Object.create(q.prototype),Z.prototype.constructor=Z,X(Z,q)}function G(Z){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(q){return q.__proto__||Object.getPrototypeOf(q)},G(Z)}function X(Z,q){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(z,F){return z.__proto__=F,z},X(Z,q)}function O(Z,q,z){return O=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(F){return!1}}()?Reflect.construct.bind():function(F,L,R){var B=[null];B.push.apply(B,L);var x=new(Function.bind.apply(F,B));return R&&X(x,R.prototype),x},O.apply(null,arguments)}function U(Z){var q=typeof Map=="function"?new Map:void 0;return U=function(z){if(z===null||Function.toString.call(z).indexOf("[native code]")===-1)return z;if(typeof z!="function")throw new TypeError("Super expression must either be null or a function");if(q!==void 0){if(q.has(z))return q.get(z);q.set(z,F)}function F(){return O(z,arguments,G(this).constructor)}return F.prototype=Object.create(z.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),X(F,z)},U(Z)}var D=function(){function Z(z){this.cache=void 0,this.cache=z}var q=Z.prototype;return q.define=function(z,F){this.cache[z]=F},q.get=function(z){return this.cache[z]},q.remove=function(z){delete this.cache[z]},q.reset=function(){this.cache={}},q.load=function(z){this.cache=J({},this.cache,z)},Z}(),Q=function(Z){function q(z){var F;return(F=Z.call(this,z)||this).name="Eta Error",F}return Y(q,Z),q}(U(Error)),I=function(Z){function q(z){var F;return(F=Z.call(this,z)||this).name="EtaParser Error",F}return Y(q,Z),q}(Q),M=function(Z){function q(z){var F;return(F=Z.call(this,z)||this).name="EtaRuntime Error",F}return Y(q,Z),q}(Q),S=function(Z){function q(z){var F;return(F=Z.call(this,z)||this).name="EtaNameResolution Error",F}return Y(q,Z),q}(Q);function E(Z,q,z){var F=q.slice(0,z).split(/\n/),L=F.length,R=F[L-1].length+1;throw Z+=" at line "+L+" col "+R+":\n\n  "+q.split(/\n/)[L-1]+"\n  "+Array(R).join(" ")+"^",new I(Z)}function W(Z,q,z,F){var L=q.split("\n"),R=Math.max(z-3,0),B=Math.min(L.length,z+3),x=F,j=L.slice(R,B).map(function(r,u){var b=u+R+1;return(b==z?" >> ":"    ")+b+"| "+r}).join("\n"),P=new M((x?x+":"+z+"\n":"line "+z+"\n")+j+"\n\n"+Z.message);throw P.name=Z.name,P}var k=function(){return Promise.resolve()}.constructor;function f(Z,q){var z=this.config,F=q&&q.async?k:Function;try{return new F(z.varName,"options",this.compileToString.call(this,Z,q))}catch(L){throw L instanceof SyntaxError?new I("Bad template syntax\n\n"+L.message+"\n"+Array(L.message.length+1).join("=")+"\n"+this.compileToString.call(this,Z,q)+"\n"):L}}function H(Z,q){var z=this.config,F=q&&q.async,L=this.compileBody,R=this.parse.call(this,Z),B=z.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(z.debug?', line: 1, templateStr: "'+Z.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(z.debug?"try {":"")+(z.useWith?"with("+z.varName+"||{}){":"")+"\n\n"+L.call(this,R)+"\nif (__eta.layout) {\n  __eta.res = "+(F?"await includeAsync":"include")+" (__eta.layout, {..."+z.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(z.useWith?"}":"")+(z.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(z.plugins)for(var x=0;x<z.plugins.length;x++){var j=z.plugins[x];j.processFnString&&(B=j.processFnString(B,z))}return B}function N(Z){for(var q=this.config,z=0,F=Z.length,L="";z<F;z++){var R=Z[z];if(typeof R=="string")L+="__eta.res+='"+R+"'\n";else{var B=R.t,x=R.val||"";q.debug&&(L+="__eta.line="+R.lineNo+"\n"),B==="r"?(q.autoFilter&&(x="__eta.f("+x+")"),L+="__eta.res+="+x+"\n"):B==="i"?(q.autoFilter&&(x="__eta.f("+x+")"),q.autoEscape&&(x="__eta.e("+x+")"),L+="__eta.res+="+x+"\n"):B==="e"&&(L+=x+"\n")}}return L}var SK={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function MK(Z){return SK[Z]}var GK={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(Z){var q=String(Z);return/[&<>"']/.test(q)?q.replace(/[&<>"']/g,MK):q},filterFunction:function(Z){return String(Z)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},v=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,m=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,p=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function c(Z){return Z.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function WK(Z,q){return Z.slice(0,q).split("\n").length}function $K(Z){var q=this.config,z=[],F=!1,L=0,R=q.parse;if(q.plugins)for(var B=0;B<q.plugins.length;B++){var x=q.plugins[B];x.processTemplate&&(Z=x.processTemplate(Z,q))}function j(w,_){w&&(w=function(C,l,n,t){var A,T;return Array.isArray(l.autoTrim)?(A=l.autoTrim[1],T=l.autoTrim[0]):A=T=l.autoTrim,(n||n===!1)&&(A=n),(t||t===!1)&&(T=t),T||A?A==="slurp"&&T==="slurp"?C.trim():(A==="_"||A==="slurp"?C=C.trimStart():A!=="-"&&A!=="nl"||(C=C.replace(/^(?:\r\n|\n|\r)/,"")),T==="_"||T==="slurp"?C=C.trimEnd():T!=="-"&&T!=="nl"||(C=C.replace(/(?:\r\n|\n|\r)$/,"")),C):C}(w,q,F,_),w&&(w=w.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),z.push(w)))}q.rmWhitespace&&(Z=Z.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),v.lastIndex=0,m.lastIndex=0,p.lastIndex=0;for(var P,r=[R.exec,R.interpolate,R.raw].reduce(function(w,_){return w&&_?w+"|"+c(_):_?c(_):w},""),u=new RegExp(c(q.tags[0])+"(-|_)?\\s*("+r+")?\\s*","g"),b=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+c(q.tags[1])+")","g");P=u.exec(Z);){var bK=Z.slice(L,P.index);L=P[0].length+P.index;var a=P[2]||"";j(bK,P[1]),b.lastIndex=L;for(var V=void 0,o=!1;V=b.exec(Z);){if(V[1]){var wK=Z.slice(L,V.index);u.lastIndex=L=b.lastIndex,F=V[2],o={t:a===R.exec?"e":a===R.raw?"r":a===R.interpolate?"i":"",val:wK};break}var d=V[0];if(d==="/*"){var ZK=Z.indexOf("*/",b.lastIndex);ZK===-1&&E("unclosed comment",Z,V.index),b.lastIndex=ZK}else d==="'"?(m.lastIndex=V.index,m.exec(Z)?b.lastIndex=m.lastIndex:E("unclosed string",Z,V.index)):d==='"'?(p.lastIndex=V.index,p.exec(Z)?b.lastIndex=p.lastIndex:E("unclosed string",Z,V.index)):d==="`"&&(v.lastIndex=V.index,v.exec(Z)?b.lastIndex=v.lastIndex:E("unclosed string",Z,V.index))}o?(q.debug&&(o.lineNo=WK(Z,P.index)),z.push(o)):E("unclosed tag",Z,P.index)}if(j(Z.slice(L,Z.length),!1),q.plugins)for(var i=0;i<q.plugins.length;i++){var qK=q.plugins[i];qK.processAST&&(z=qK.processAST(z,q))}return z}function JK(Z,q){var z=q&&q.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!Z.startsWith("@")){var F=q.filepath,L=z.get(F);if(this.config.cache&&L)return L;var R=this.readFile(F),B=this.compile(R,q);return this.config.cache&&z.define(F,B),B}var x=z.get(Z);if(x)return x;throw new S("Failed to get template '"+Z+"'")}function XK(Z,q,z){var F,L=J({},z,{async:!1});return typeof Z=="string"?(this.resolvePath&&this.readFile&&!Z.startsWith("@")&&(L.filepath=this.resolvePath(Z,L)),F=JK.call(this,Z,L)):F=Z,F.call(this,q,L)}function YK(Z,q,z){var F,L=J({},z,{async:!0});typeof Z=="string"?(this.resolvePath&&this.readFile&&!Z.startsWith("@")&&(L.filepath=this.resolvePath(Z,L)),F=JK.call(this,Z,L)):F=Z;var R=F.call(this,q,L);return Promise.resolve(R)}function HK(Z,q){var z=this.compile(Z,{async:!1});return XK.call(this,z,q)}function VK(Z,q){var z=this.compile(Z,{async:!0});return YK.call(this,z,q)}var EK=function(){function Z(z){this.config=void 0,this.RuntimeErr=W,this.compile=f,this.compileToString=H,this.compileBody=N,this.parse=$K,this.render=XK,this.renderAsync=YK,this.renderString=HK,this.renderStringAsync=VK,this.filepathCache={},this.templatesSync=new D({}),this.templatesAsync=new D({}),this.resolvePath=null,this.readFile=null,this.config=z?J({},GK,z):J({},GK)}var q=Z.prototype;return q.configure=function(z){this.config=J({},this.config,z)},q.withConfig=function(z){return J({},this,{config:J({},this.config,z)})},q.loadTemplate=function(z,F,L){if(typeof F=="string")(L&&L.async?this.templatesAsync:this.templatesSync).define(z,this.compile(F,L));else{var R=this.templatesSync;(F.constructor.name==="AsyncFunction"||L&&L.async)&&(R=this.templatesAsync),R.define(z,F)}},Z}(),PK=function(Z){function q(){return Z.apply(this,arguments)||this}return Y(q,Z),q}(EK);K.Eta=PK})});var $={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},jK=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class h{constructor(K,J,Y,G){this.tagName=K,this.attributes=J,this.children=Y,this.content=G,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let K=this.content||"";for(let J of this.children)K+=J.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${K}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(K){if(this.isRemoved)return null;if(this.attributes.id===K)return this;for(let J of this.children){const Y=J.getElementById(K);if(Y)return Y}return null}getElementsByClass(K){if(this.isRemoved)return[];const J=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(K))J.push(this);for(let Y of this.children)J.push(...Y.getElementsByClass(K));return J}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(K){if(K.includes("*"))return;const J={};for(let[Y,G]of Object.entries(this.attributes))if(K.includes(Y))J[Y]=G;this.attributes=J;for(let Y of this.children)Y.filterAttributes(K)}getAttributesString(){return Object.entries(this.attributes).map(([K,J])=>` ${K}="${J}"`).join("")}static create(K){const J=h.tokenize(K),Y=[],G=[];let X=null,O={},U="";for(let D of J)switch(D.type){case $.TAG_OPEN:if(X){if(Object.keys(X.attributes).length===0)X.attributes=O;X.content=U.trim(),O={},U="",G.push(X)}X=new h(D.value,{},[]);break;case $.ATTRIBUTE_NAME:O[D.value]="";break;case $.ATTRIBUTE_VALUE:const Q=Object.keys(O).pop();O[Q]=D.value;break;case $.TAG_CLOSE:case $.SELF_CLOSING_TAG:if(!X)break;if(X.isSelfClosing=D.type===$.SELF_CLOSING_TAG,Object.keys(X.attributes).length===0)X.attributes=O;if(!X.content)X.content=U;else X.content+=" "+U;if(U="",O={},G.length>0)G[G.length-1].children.push(X);else Y.push(X);X=G.pop()||null;break;case $.TEXT:if(X)U+=D.value;break}return Y}static tokenize(K){const J=[];let Y=0;while(Y<K.length)if(K[Y]==="<")if(K[Y+1]==="/"){let G=Y+2;while(G<K.length&&K[G]!==">")G++;J.push({type:$.TAG_CLOSE,value:K.slice(Y+2,G).trim()}),Y=G+1}else{let G=Y+1;while(G<K.length&&K[G]!==" "&&K[G]!==">"&&K[G]!=="/")G++;const X=K.slice(Y+1,G).trim();J.push({type:$.TAG_OPEN,value:K.slice(Y+1,G).trim()});while(G<K.length&&K[G]!==">")if(K[G]===" "){G++;let O="";while(G<K.length&&K[G]!=="="&&K[G]!==" "&&K[G]!==">"&&K[G]!=="/")O+=K[G],G++;if(O!=="")J.push({type:$.ATTRIBUTE_NAME,value:O.trim().toLowerCase()});if(K[G]==="="){G++;const U=K[G];G++;let D="";while(G<K.length&&K[G]!==U)D+=K[G],G++;J.push({type:$.ATTRIBUTE_VALUE,value:D}),G++}}else G++;if(jK.has(X.toLowerCase())&&K[G]===">")J.push({type:$.SELF_CLOSING_TAG,value:X});if(K[G]===">")G++;Y=G}else{let G=Y;while(G<K.length&&K[G]!=="<")G++;J.push({type:$.TEXT,value:K.slice(Y,G)}),Y=G}return J}}function FK(K){return Object.keys(kK).find((J)=>J.toLowerCase()==K.toLocaleLowerCase())!=null}function IK(K,J){return import("data:text/javascript;charset=utf-8,"+J.join("\n")+encodeURIComponent(`${K}`)).then((G)=>G).catch((G)=>{return console.error(G),null})}var kK={number:{},string:{},bigint:{},color:{}};var g=Object.getPrototypeOf(async function(){}).constructor;function y(K){_K.postMessage(K)}var _K=new BroadcastChannel("advect:log"),LK={async prerender(K){return y({renderDesc:K}),""},async load({urls:K}){y({message:"starting my loading",urls:K});const J=[],Y=[];if(Array.isArray(K))Y.push(...K);if(typeof K=="string")Y.push(K);for(let G of Y){const X=await fetch(G).then((O)=>O.text()).then(async(O)=>await this.build({template:O}));y({msg:"wow loading some stuff",url:G,data:X}),J.push(...X)}return y({message:"done loading",urls:K}),J},async build({template:K}){const J=h.create(String.raw`${K}`),Y=[];y({message:"building",template:K,root_nodes:J});for(let G of J){y({message:"Adding",root_node:G.attributes.id});const X={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(G.tagName.toLowerCase()==="template"){if(!G.attributes.id){y("advect Template must have an id that will become the tag name");continue}const U=G.attributes.id;if(U.indexOf("-")===-1){y("advect Template tag name must contain a hyphen");continue}if(X.tagName=U,X.templateNode=G,G.attributes.root)X.root=G.attributes.root;else X.root="light";if(G.attributes.shadow)X.shadow=G.attributes.shadow;else X.shadow="closed";const D=[...G.children];while(D.length>0){const Q=D.shift();if(!Q)continue;if(Q.tagName==="settings")Q.children.forEach((I)=>{if(I.tagName=="mutation"){if(X?.mutation?.attributeFilter&&I.attributes.attributeFilter)X.mutation.attributeFilter=I.attributes.attributeFilter.split(",");if(X?.mutation?.attributes&&I.attributes.attributes)X.mutation.attributes=I.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(X?.mutation?.characterData&&I.attributes.characterData)X.mutation.characterData=I.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(X?.mutation?.childList&&I.attributes.childList)X.mutation.childList=I.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(X?.mutation?.subtree&&I.attributes.subtree)X.mutation.subtree=I.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if(I.tagName=="intersection"){if(X?.intersection&&I.attributes.margin)X.intersection.margin=parseFloat(I.attributes.margin);if(X?.intersection.threshhold&&I.attributes.threshhold)X.intersection.threshhold=parseFloat(I.attributes.threshhold);if(X?.intersection.root&&I.attributes.root)X.intersection.root=I.attributes.root}if(I.tagName=="attr"&&I.attributes.name){const M=I.attributes.name,S=I.attributes.type??"string";if(FK(S))X.watched_attrs[M]={type:S}}I.remove()}),Q.remove();if(Q.tagName==="script"){if(Q.attributes.type.toLocaleLowerCase()==="text/adv"&&Q.attributes.type){const I=new URL(Q.attributes.src);this.load({urls:I.toString()})}if(Q.attributes.type.toLocaleLowerCase()==="module"&&!Q.attributes.src)X.module=Q.text()}if(Q.attributes.ref)X.refs.push(Q);D.push(...Q.children)}}const O=G.children.map((U)=>U.html()).join("");X.template=O,Y.push(X)}return Y}};var xK=yK(OK(),1);function QK(K,J){const[Y,G]=J.tags,X=J.parse.exec,O=I(K),U=M(O),D=S(U),Q=E(D);function I(W){return W.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function M(W){return W.replace(/<if check="([^"]+)">/g,`${Y}${X} if ( \$1 ) { ${G}`).replace(/<else\/?>/g,`${Y}${X} } else { ${G}`).replace(/<\/if>/g,`${Y}${X} } ${G}`)}function S(W){return W.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(k,f,H,N){if(H&&N)return`${Y}${X} ${f}.forEach(function(${H}, ${N}){ ${G}`;else if(H)return`${Y}${X} ${f}.forEach(function(${H}){ ${G}`;else return`${Y}${X} ${f}.forEach(function(){ ${G}`}).replace(/<\/for>/g,`${Y}${X} }) ${G}`)}function E(W){return W.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(k,f,H,N){if(H&&N)return`${Y}${X} Object.keys(${f}).forEach(function(${H}) { ${G} 
                        ${Y}${X} const ${N} = ${f}[${H}] ${G}
                    `;else if(H)return`${Y}${X} Object.keys(${f}).forEach(function(${H}) { ${G}`;else return`${Y}${X} Object.keys(${f}).forEach(function() { ${G}`}).replace(/<\/of>/g,`${Y}${X} }) ${G}`)}return Q}var RK=(K)=>{let J;const Y=new Set,G=(I,M)=>{const S=typeof I==="function"?I(J):I;if(!Object.is(S,J)){const E=J;J=(M!=null?M:typeof S!=="object"||S===null)?S:Object.assign({},J,S),Y.forEach((W)=>W(J,E))}},X=()=>J,D={setState:G,getState:X,getInitialState:()=>Q,subscribe:(I)=>{return Y.add(I),()=>Y.delete(I)}},Q=J=K(G,X,D);return D},UK=(K)=>K?RK(K):RK;function pK(K){return new Promise((J,Y)=>{if(!K.isConnected){J(null),console.log(K,"is not connected to the dom and cannot be a ref");return}if(K.tagName.indexOf("-")==-1){J(K);return}if(!K.matches(":defined"))customElements.whenDefined(K.tagName).then((O)=>{J(K)}).catch((O)=>{Y(O)});J(K)})}var gK=()=>{const K=new Map,J=new SharedWorker(new URL("advect.sharedworker.js",import.meta.url).href,{type:"module"});return J.onerror=(G)=>{console.warn("error",G)},J.port.onmessage=(G)=>{const X=K.has(G.data.$id)&&K.get(G.data.$id);if(G.data?.isError===!0&&X)X.reject(G);if(X)X.resolve(G),K.delete(G.data.$id)},{messagePromise:async(G,X)=>{return new Promise((O,U)=>{const D=Math.random().toString(36).substr(2,9);K.set(D,{resolve:O,reject:U}),J.port.postMessage({action:G,data:X,$id:D})})},worker:J,type:"shared"}},hK=()=>{const K=new Map,J=new Worker(new URL("advect.worker.js",import.meta.url),{type:"module"});return J.onerror=(G)=>{console.error("error",G)},J.onmessage=(G)=>{const X=K.has(G.data.$id)&&K.get(G.data.$id);if(G.data?.isError===!0&&X)X.reject(G);if(X)X.resolve(G),K.delete(G.data.$id)},{messagePromise:async(G,X)=>{return new Promise((O,U)=>{const D=Math.random().toString(36).substr(2,9);K.set(D,{resolve:O,reject:U}),J.postMessage({action:G,data:X,$id:D})})},worker:J,type:"dedicated"}},vK=()=>{return{messagePromise:async(J,Y)=>{return LK[J].call(Y)},worker:null,type:"no-worker"}},mK=()=>{const{messagePromise:K}=typeof SharedWorker!=="undefined"?gK():typeof Worker!=="undefined"?hK():vK(),J=async(D)=>{return K("prerender",D)},Y=new BroadcastChannel("advect:log");Y.onmessage=(D)=>{console.log(D.data)};const G=async(D)=>{const I=(await K("load",{urls:D})).data.result;return console.log("got my build settings",I),X(I)},X=(D,Q=!0)=>{const I=[];for(let M of D){const S=M;IK(M.module,[]).then((E)=>{const W=E?.default;console.log(M.tagName,M);const k=class extends(W||KK){static observedAttributes=Object.keys(S.watched_attrs);static settings=S};if(Q)customElements.define(M.tagName,k);I.push(k)})}return I},O=async(D)=>{const I=(await K("build",{template:D})).data.result;return X(I)},U=(D)=>{document.querySelectorAll("template[id][adv]").forEach((I)=>cK.build(I.outerHTML));let Q=[];document.querySelectorAll('script[type="text/adv"][src]').forEach((I)=>{if(I.hasAttribute("src"))Q.push(I.getAttribute("src")??"")}),console.log("loading",Q),G(Q),document.removeEventListener("DOMContentLoaded",U)};return document.addEventListener("DOMContentLoaded",U),{render:J,build:O,load:G}};class e extends HTMLElement{anyAttrChanged(K,J){}attr=new Proxy({},{get:(K,J)=>{if(this.isConnected)return this.getAttribute(J);return null},set:(K,J,Y)=>{if(this.isConnected)return this.setAttribute(J,Y),this.anyAttrChanged(J,Y),!0;return!1}});data=new Proxy({},{get:(K,J)=>{if(this.isConnected)return this.dataset[J];return null},set:(K,J,Y)=>{if(this.isConnected)return this.dataset[J]=Y,this.anyAttrChanged("data-"+J,Y),!0;return!1}});#K;get internals(){return this.#K}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(K,J,Y)=>{};attributeChangedCallback(K,J,Y){this?.onAttributeChange(K,J,Y)}onConnect=()=>{};connectedCallback(){this.#K=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(K,J,Y){if(super.addEventListener(K,J,Y),K=="connect"&&this.isConnected)J(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(K)=>{};onIntersect=(K)=>{}}class KK extends e{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}refs=new Proxy({},{get:(K,J)=>{const Y=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(Y)return pK(Y);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.setupInitialDom(),this.hookRefs(),this?.onConnect()}setupInitialDom(){switch(this.$settings?.root){case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}hookRefsShadow(){this.shadowRoot?.querySelectorAll("[ref]").forEach((K)=>{this.mutationObserver?.observe(K,{attributes:!0,childList:!0,subtree:!0}),K.getAttributeNames().filter((Y)=>Y.startsWith("on")).forEach((Y)=>{const G=K.getAttribute(Y)??"";if(Y.toLowerCase()==="onmutate")K.addEventListener("adv:mutation",(X)=>{try{new g("$self","event","$this","refs","data",G)(this,X,K,this.refs,this.data)}catch(O){console.error(O,G,this)}});else try{K[Y]=(X)=>{new g("$self","event","$this","refs","data",G)(this,X,K,this.refs,this.data)}}catch(X){console.error(X,G,this)}})})}hookRefsLight(){this?.querySelectorAll("[ref]").forEach((K)=>{this.mutationObserver?.observe(K,{attributes:!0,childList:!0,subtree:!0}),K.getAttributeNames().filter((Y)=>Y.startsWith("on")).forEach((Y)=>{const G=K.getAttribute(Y)??"";try{K[Y]=(X)=>{new g("$self","event","$this","refs","data",G)(this,X,K,this.refs,this.data)}}catch(X){console.error(X,G,this)}})})}hookRefsSelf(){this.getAttributeNames().filter((K)=>K.startsWith("on")).forEach((K)=>{const J=this.getAttribute(K)??"";if(K.toLowerCase()==="onmutate"){this.onMutation=(Y)=>new g("$self","event",J)(this,Y);return}this[K]=(Y)=>new g("$self","event",J)(this,Y)})}hookRefs(){this.hookRefsSelf(),this.hookRefsLight(),this.hookRefsShadow()}#K;get mutationObserver(){return this.#K}createMutationObserver(){if(this.$settings.mutation){if(this.#K=new MutationObserver((K,J)=>{this?.onMutation(K)}),this.#K.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#K.observe(this.shadowRoot,{...this.$settings.mutation})}}#G;get interectObserver(){return this.#G}createIntersectObserver(){if(this.$settings.intersection){let K=void 0;if(this.$settings?.intersection?.root)K=this.querySelector(this.$settings?.intersection?.root);this.#G=new IntersectionObserver((J,Y)=>{this.onIntersect(J)},{...this.$settings.intersection,root:K})}}}class BK extends e{anyAttrChanged(K,J){this.render()}#K=new xK.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#G=UK((K,J)=>({}));get store(){return this.#G}get state(){return this.#G?.getState()}connectedCallback(){this.attachShadow({mode:"open"}),this.#G.subscribe((K,J)=>{this.render()}),this.render(),super.connectedCallback()}get eta(){return this.#K}render(){const K=QK(this.innerHTML,this.#K.config),J='<div style="display:contents;" part="root">'+this.eta.renderString(K,{self:this})+"</div>";if(this.shadowRoot)this.shadowRoot.innerHTML=J}}if(!customElements.get("adv-view"))customElements.define("adv-view",BK);window.AdvectElement=KK;var cK=mK();export{pK as refHandle,cK as advect,BK as AdvectView,KK as AdvectElement,e as AdvectBase};
