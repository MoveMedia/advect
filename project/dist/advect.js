var yG=Object.create;var{getPrototypeOf:_G,defineProperty:QG,getOwnPropertyNames:kG}=Object;var hG=Object.prototype.hasOwnProperty;var BG=(G,J,X)=>{X=G!=null?yG(_G(G)):{};const Y=J||!G||!G.__esModule?QG(X,"default",{value:G,enumerable:!0}):X;for(let Z of kG(G))if(!hG.call(Y,Z))QG(Y,Z,{get:()=>G[Z],enumerable:!0});return Y};var DG=(G,J)=>()=>(J||G((J={exports:{}}).exports,J),J.exports);var VG=DG((JJ,OG)=>{var pG=(G,J={})=>{const X={skipSameOrigin:!0,useBlob:!0,...J};if(!G.includes("://")||G.includes(window.location.origin))return Promise.resolve(G);return new Promise((Y,Z)=>fetch(G).then((B)=>B.text()).then((B)=>{let S=new URL(G).href.split("/");S.pop();const F=`const _importScripts = importScripts;
const _fixImports = (url) => new URL(url, '${S.join("/")+"/"}').href;
importScripts = (...urls) => _importScripts(...urls.map(_fixImports));`;let I="data:application/javascript,"+encodeURIComponent(F+B);if(X.useBlob)I=URL.createObjectURL(new Blob([`importScripts("${I}")`],{type:"application/javascript"}));Y(I)}).catch(Z))};OG.exports=pG});var MG=DG((o,HG)=>{(function(G,J){typeof o=="object"&&typeof HG!="undefined"?J(o):typeof define=="function"&&define.amd?define(["exports"],J):J((G||self).eta={})})(o,function(G){function J(){return J=Object.assign?Object.assign.bind():function(q){for(var z=1;z<arguments.length;z++){var K=arguments[z];for(var Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&(q[Q]=K[Q])}return q},J.apply(this,arguments)}function X(q,z){q.prototype=Object.create(z.prototype),q.prototype.constructor=q,Z(q,z)}function Y(q){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},Y(q)}function Z(q,z){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(K,Q){return K.__proto__=Q,K},Z(q,z)}function B(q,z,K){return B=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}()?Reflect.construct.bind():function(Q,D,O){var H=[null];H.push.apply(H,D);var V=new(Function.bind.apply(Q,H));return O&&Z(V,O.prototype),V},B.apply(null,arguments)}function S(q){var z=typeof Map=="function"?new Map:void 0;return S=function(K){if(K===null||Function.toString.call(K).indexOf("[native code]")===-1)return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(z!==void 0){if(z.has(K))return z.get(K);z.set(K,Q)}function Q(){return B(K,arguments,Y(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),Z(Q,K)},S(q)}var F=function(){function q(K){this.cache=void 0,this.cache=K}var z=q.prototype;return z.define=function(K,Q){this.cache[K]=Q},z.get=function(K){return this.cache[K]},z.remove=function(K){delete this.cache[K]},z.reset=function(){this.cache={}},z.load=function(K){this.cache=J({},this.cache,K)},q}(),I=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="Eta Error",Q}return X(z,q),z}(S(Error)),$=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaParser Error",Q}return X(z,q),z}(I),L=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaRuntime Error",Q}return X(z,q),z}(I),M=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaNameResolution Error",Q}return X(z,q),z}(I);function W(q,z,K){var Q=z.slice(0,K).split(/\n/),D=Q.length,O=Q[D-1].length+1;throw q+=" at line "+D+" col "+O+":\n\n  "+z.split(/\n/)[D-1]+"\n  "+Array(O).join(" ")+"^",new $(q)}function E(q,z,K,Q){var D=z.split("\n"),O=Math.max(K-3,0),H=Math.min(D.length,K+3),V=Q,y=D.slice(O,H).map(function(a,c){var b=c+O+1;return(b==K?" >> ":"    ")+b+"| "+a}).join("\n"),U=new L((V?V+":"+K+"\n":"line "+K+"\n")+y+"\n\n"+q.message);throw U.name=q.name,U}var s=function(){return Promise.resolve()}.constructor;function A(q,z){var K=this.config,Q=z&&z.async?s:Function;try{return new Q(K.varName,"options",this.compileToString.call(this,q,z))}catch(D){throw D instanceof SyntaxError?new $("Bad template syntax\n\n"+D.message+"\n"+Array(D.message.length+1).join("=")+"\n"+this.compileToString.call(this,q,z)+"\n"):D}}function P(q,z){var K=this.config,Q=z&&z.async,D=this.compileBody,O=this.parse.call(this,q),H=K.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(K.debug?', line: 1, templateStr: "'+q.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(K.debug?"try {":"")+(K.useWith?"with("+K.varName+"||{}){":"")+"\n\n"+D.call(this,O)+"\nif (__eta.layout) {\n  __eta.res = "+(Q?"await includeAsync":"include")+" (__eta.layout, {..."+K.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(K.useWith?"}":"")+(K.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(K.plugins)for(var V=0;V<K.plugins.length;V++){var y=K.plugins[V];y.processFnString&&(H=y.processFnString(H,K))}return H}function f(q){for(var z=this.config,K=0,Q=q.length,D="";K<Q;K++){var O=q[K];if(typeof O=="string")D+="__eta.res+='"+O+"'\n";else{var H=O.t,V=O.val||"";z.debug&&(D+="__eta.line="+O.lineNo+"\n"),H==="r"?(z.autoFilter&&(V="__eta.f("+V+")"),D+="__eta.res+="+V+"\n"):H==="i"?(z.autoFilter&&(V="__eta.f("+V+")"),z.autoEscape&&(V="__eta.e("+V+")"),D+="__eta.res+="+V+"\n"):H==="e"&&(D+=V+"\n")}}return D}var WG={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function UG(q){return WG[q]}var XG={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(q){var z=String(q);return/[&<>"']/.test(z)?z.replace(/[&<>"']/g,UG):z},filterFunction:function(q){return String(q)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},v=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,g=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,m=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function p(q){return q.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function bG(q,z){return q.slice(0,z).split("\n").length}function CG(q){var z=this.config,K=[],Q=!1,D=0,O=z.parse;if(z.plugins)for(var H=0;H<z.plugins.length;H++){var V=z.plugins[H];V.processTemplate&&(q=V.processTemplate(q,z))}function y(C,_){C&&(C=function(w,l,n,t){var N,T;return Array.isArray(l.autoTrim)?(N=l.autoTrim[1],T=l.autoTrim[0]):N=T=l.autoTrim,(n||n===!1)&&(N=n),(t||t===!1)&&(T=t),T||N?N==="slurp"&&T==="slurp"?w.trim():(N==="_"||N==="slurp"?w=w.trimStart():N!=="-"&&N!=="nl"||(w=w.replace(/^(?:\r\n|\n|\r)/,"")),T==="_"||T==="slurp"?w=w.trimEnd():T!=="-"&&T!=="nl"||(w=w.replace(/(?:\r\n|\n|\r)$/,"")),w):w}(C,z,Q,_),C&&(C=C.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),K.push(C)))}z.rmWhitespace&&(q=q.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),v.lastIndex=0,g.lastIndex=0,m.lastIndex=0;for(var U,a=[O.exec,O.interpolate,O.raw].reduce(function(C,_){return C&&_?C+"|"+p(_):_?p(_):C},""),c=new RegExp(p(z.tags[0])+"(-|_)?\\s*("+a+")?\\s*","g"),b=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+p(z.tags[1])+")","g");U=c.exec(q);){var jG=q.slice(D,U.index);D=U[0].length+U.index;var i=U[2]||"";y(jG,U[1]),b.lastIndex=D;for(var R=void 0,u=!1;R=b.exec(q);){if(R[1]){var fG=q.slice(D,R.index);c.lastIndex=D=b.lastIndex,Q=R[2],u={t:i===O.exec?"e":i===O.raw?"r":i===O.interpolate?"i":"",val:fG};break}var d=R[0];if(d==="/*"){var zG=q.indexOf("*/",b.lastIndex);zG===-1&&W("unclosed comment",q,R.index),b.lastIndex=zG}else d==="'"?(g.lastIndex=R.index,g.exec(q)?b.lastIndex=g.lastIndex:W("unclosed string",q,R.index)):d==='"'?(m.lastIndex=R.index,m.exec(q)?b.lastIndex=m.lastIndex:W("unclosed string",q,R.index)):d==="`"&&(v.lastIndex=R.index,v.exec(q)?b.lastIndex=v.lastIndex:W("unclosed string",q,R.index))}u?(z.debug&&(u.lineNo=bG(q,U.index)),K.push(u)):W("unclosed tag",q,U.index)}if(y(q.slice(D,q.length),!1),z.plugins)for(var r=0;r<z.plugins.length;r++){var KG=z.plugins[r];KG.processAST&&(K=KG.processAST(K,z))}return K}function YG(q,z){var K=z&&z.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!q.startsWith("@")){var Q=z.filepath,D=K.get(Q);if(this.config.cache&&D)return D;var O=this.readFile(Q),H=this.compile(O,z);return this.config.cache&&K.define(Q,H),H}var V=K.get(q);if(V)return V;throw new M("Failed to get template '"+q+"'")}function ZG(q,z,K){var Q,D=J({},K,{async:!1});return typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(D.filepath=this.resolvePath(q,D)),Q=YG.call(this,q,D)):Q=q,Q.call(this,z,D)}function qG(q,z,K){var Q,D=J({},K,{async:!0});typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(D.filepath=this.resolvePath(q,D)),Q=YG.call(this,q,D)):Q=q;var O=Q.call(this,z,D);return Promise.resolve(O)}function wG(q,z){var K=this.compile(q,{async:!1});return ZG.call(this,K,z)}function AG(q,z){var K=this.compile(q,{async:!0});return qG.call(this,K,z)}var NG=function(){function q(K){this.config=void 0,this.RuntimeErr=E,this.compile=A,this.compileToString=P,this.compileBody=f,this.parse=CG,this.render=ZG,this.renderAsync=qG,this.renderString=wG,this.renderStringAsync=AG,this.filepathCache={},this.templatesSync=new F({}),this.templatesAsync=new F({}),this.resolvePath=null,this.readFile=null,this.config=K?J({},XG,K):J({},XG)}var z=q.prototype;return z.configure=function(K){this.config=J({},this.config,K)},z.withConfig=function(K){return J({},this,{config:J({},this.config,K)})},z.loadTemplate=function(K,Q,D){if(typeof Q=="string")(D&&D.async?this.templatesAsync:this.templatesSync).define(K,this.compile(Q,D));else{var O=this.templatesSync;(Q.constructor.name==="AsyncFunction"||D&&D.async)&&(O=this.templatesAsync),O.define(K,Q)}},q}(),TG=function(q){function z(){return q.apply(this,arguments)||this}return X(z,q),z}(NG);G.Eta=TG})});var x={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},vG=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class h{constructor(G,J,X,Y){this.tagName=G,this.attributes=J,this.children=X,this.content=Y,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let G=this.content||"";for(let J of this.children)G+=J.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${G}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(G){if(this.isRemoved)return null;if(this.attributes.id===G)return this;for(let J of this.children){const X=J.getElementById(G);if(X)return X}return null}getElementsByClass(G){if(this.isRemoved)return[];const J=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(G))J.push(this);for(let X of this.children)J.push(...X.getElementsByClass(G));return J}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(G){if(G.includes("*"))return;const J={};for(let[X,Y]of Object.entries(this.attributes))if(G.includes(X))J[X]=Y;this.attributes=J;for(let X of this.children)X.filterAttributes(G)}getAttributesString(){return Object.entries(this.attributes).map(([G,J])=>` ${G}="${J}"`).join("")}static create(G){const J=h.tokenize(G),X=[],Y=[];let Z=null,B={},S="";for(let F of J)switch(F.type){case x.TAG_OPEN:if(Z){if(Object.keys(Z.attributes).length===0)Z.attributes=B;Z.content=S.trim(),B={},S="",Y.push(Z)}Z=new h(F.value,{},[]);break;case x.ATTRIBUTE_NAME:B[F.value]="";break;case x.ATTRIBUTE_VALUE:const I=Object.keys(B).pop();B[I]=F.value;break;case x.TAG_CLOSE:case x.SELF_CLOSING_TAG:if(!Z)break;if(Z.isSelfClosing=F.type===x.SELF_CLOSING_TAG,Object.keys(Z.attributes).length===0)Z.attributes=B;if(!Z.content)Z.content=S;else Z.content+=" "+S;if(S="",B={},Y.length>0)Y[Y.length-1].children.push(Z);else X.push(Z);Z=Y.pop()||null;break;case x.TEXT:if(Z)S+=F.value;break}return X}static tokenize(G){const J=[];let X=0;while(X<G.length)if(G[X]==="<")if(G[X+1]==="/"){let Y=X+2;while(Y<G.length&&G[Y]!==">")Y++;J.push({type:x.TAG_CLOSE,value:G.slice(X+2,Y).trim()}),X=Y+1}else{let Y=X+1;while(Y<G.length&&G[Y]!==" "&&G[Y]!==">"&&G[Y]!=="/")Y++;const Z=G.slice(X+1,Y).trim();J.push({type:x.TAG_OPEN,value:G.slice(X+1,Y).trim()});while(Y<G.length&&G[Y]!==">")if(G[Y]===" "){Y++;let B="";while(Y<G.length&&G[Y]!=="="&&G[Y]!==" "&&G[Y]!==">"&&G[Y]!=="/")B+=G[Y],Y++;if(B!=="")J.push({type:x.ATTRIBUTE_NAME,value:B.trim().toLowerCase()});if(G[Y]==="="){Y++;const S=G[Y];Y++;let F="";while(Y<G.length&&G[Y]!==S)F+=G[Y],Y++;J.push({type:x.ATTRIBUTE_VALUE,value:F}),Y++}}else Y++;if(vG.has(Z.toLowerCase())&&G[Y]===">")J.push({type:x.SELF_CLOSING_TAG,value:Z});if(G[Y]===">")Y++;X=Y}else{let Y=X;while(Y<G.length&&G[Y]!=="<")Y++;J.push({type:x.TEXT,value:G.slice(X,Y)}),X=Y}return J}}function IG(G){return Object.keys(gG).find((J)=>J.toLowerCase()==G.toLocaleLowerCase())!=null}function $G(G,J){return import("data:text/javascript;charset=utf-8,"+J.join("\n")+encodeURIComponent(`${G}`)).then((Y)=>Y).catch((Y)=>{return console.error(Y),null})}function mG(G){switch(G.data?.___type){case"table":console.table(G.data);break;case"dir":console.dir(G.data);break;case"error":console.error(G.data);break;case"warn":console.warn(G.data);break;default:case"log":console.log(G.data);break}}function j(G){SG.postMessage({...G,___type:"log"})}var gG={number:{},string:{},bigint:{},color:{}};var k=Object.getPrototypeOf(async function(){}).constructor,SG=new BroadcastChannel("advect:log");SG.onmessage=(G)=>mG(G);var FG={async prerender(G){return j({renderDesc:G}),""},async load({urls:G}){j({message:"starting my loading",urls:G});const J=[],X=[];if(Array.isArray(G))X.push(...G);if(typeof G=="string")X.push(G);for(let Y of X){const Z=await fetch(Y).then((B)=>B.text()).then(async(B)=>await this.build({template:B}));j({msg:"wow loading some stuff",url:Y,data:Z}),J.push(...Z)}return j({message:"done loading",urls:G}),J},async build({template:G}){const J=h.create(String.raw`${G}`),X=[];j({message:"building",template:G,root_nodes:J});for(let Y of J){j({message:"Adding",root_node:Y.attributes.id});const Z={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(Y.tagName.toLowerCase()==="template"){if(!Y.attributes.id){j("advect Template must have an id that will become the tag name");continue}const S=Y.attributes.id;if(S.indexOf("-")===-1){j("advect Template tag name must contain a hyphen");continue}if(Z.tagName=S,Z.templateNode=Y,Y.attributes.root)Z.root=Y.attributes.root;else Z.root="light";if(Y.attributes.shadow)Z.shadow=Y.attributes.shadow;else Z.shadow="closed";const F=[...Y.children];while(F.length>0){const I=F.shift();if(!I)continue;if(I.tagName==="settings")I.children.forEach(($)=>{if($.tagName=="mutation"){if(Z?.mutation?.attributeFilter&&$.attributes.attributeFilter)Z.mutation.attributeFilter=$.attributes.attributeFilter.split(",");if(Z?.mutation?.attributes&&$.attributes.attributes)Z.mutation.attributes=$.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(Z?.mutation?.characterData&&$.attributes.characterData)Z.mutation.characterData=$.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(Z?.mutation?.childList&&$.attributes.childList)Z.mutation.childList=$.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(Z?.mutation?.subtree&&$.attributes.subtree)Z.mutation.subtree=$.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if($.tagName=="intersection"){if(Z?.intersection&&$.attributes.margin)Z.intersection.margin=parseFloat($.attributes.margin);if(Z?.intersection.threshhold&&$.attributes.threshhold)Z.intersection.threshhold=parseFloat($.attributes.threshhold);if(Z?.intersection.root&&$.attributes.root)Z.intersection.root=$.attributes.root}if($.tagName=="attr"&&$.attributes.name){const L=$.attributes.name,M=$.attributes.type??"string";if(IG(M))Z.watched_attrs[L]={type:M}}$.remove()}),I.remove();if(I.tagName==="script"){if(I.attributes.type.toLocaleLowerCase()==="text/adv"&&I.attributes.type){const $=new URL(I.attributes.src);this.load({urls:$.toString()})}if(I.attributes.type.toLocaleLowerCase()==="module"&&!I.attributes.src)Z.module=I.text()}if(I.attributes.ref)Z.refs.push(I);F.push(...I.children)}}const B=Y.children.map((S)=>S.html()).join("");Z.template=B,X.push(Z)}return X}};var e=BG(VG(),1);var RG=BG(MG(),1);function EG(G,J){const[X,Y]=J.tags,Z=J.parse.exec,B=$(G),S=L(B),F=M(S),I=W(F);function $(E){return E.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function L(E){return E.replace(/<if check="([^"]+)">/g,`${X}${Z} if ( \$1 ) { ${Y}`).replace(/<else\/?>/g,`${X}${Z} } else { ${Y}`).replace(/<\/if>/g,`${X}${Z} } ${Y}`)}function M(E){return E.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(s,A,P,f){if(P&&f)return`${X}${Z} ${A}.forEach(function(${P}, ${f}){ ${Y}`;else if(P)return`${X}${Z} ${A}.forEach(function(${P}){ ${Y}`;else return`${X}${Z} ${A}.forEach(function(){ ${Y}`}).replace(/<\/for>/g,`${X}${Z} }) ${Y}`)}function W(E){return E.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(s,A,P,f){if(P&&f)return`${X}${Z} Object.keys(${A}).forEach(function(${P}) { ${Y} 
                        ${X}${Z} const ${f} = ${A}[${P}] ${Y}
                    `;else if(P)return`${X}${Z} Object.keys(${A}).forEach(function(${P}) { ${Y}`;else return`${X}${Z} Object.keys(${A}).forEach(function() { ${Y}`}).replace(/<\/of>/g,`${X}${Z} }) ${Y}`)}return I}var xG=(G)=>{let J;const X=new Set,Y=($,L)=>{const M=typeof $==="function"?$(J):$;if(!Object.is(M,J)){const W=J;J=(L!=null?L:typeof M!=="object"||M===null)?M:Object.assign({},J,M),X.forEach((E)=>E(J,W))}},Z=()=>J,F={setState:Y,getState:Z,getInitialState:()=>I,subscribe:($)=>{return X.add($),()=>X.delete($)}},I=J=G(Y,Z,F);return F},PG=(G)=>G?xG(G):xG;function oG(G){return new Promise((J,X)=>{if(!G.isConnected){J(null);return}if(G.tagName.indexOf("-")==-1){J(G);return}if(!G.matches(":defined"))customElements.whenDefined(G.tagName).then((B)=>{J(G)}).catch((B)=>{X(B)});J(G)})}var cG=async()=>{const G=new Map,J=await e.default(new URL("advect.sharedworker.js",import.meta.url).href),X=new SharedWorker(J,{type:"module"});return X.onerror=(Z)=>{console.warn("error",Z)},X.port.onmessage=(Z)=>{const B=G.has(Z.data.$id)&&G.get(Z.data.$id);if(Z.data?.isError===!0&&B)B.reject(Z);if(B)B.resolve(Z),G.delete(Z.data.$id)},{messagePromise:async(Z,B)=>{return new Promise((S,F)=>{const I=Math.random().toString(36).substr(2,9);G.set(I,{resolve:S,reject:F}),X.port.postMessage({action:Z,data:B,$id:I})})},worker:X,type:"shared"}},uG=async()=>{const G=new Map,J=await e.default(new URL("advect.sharedworker.js",import.meta.url).href),X=new Worker(J,{type:"module"});return X.onerror=(Z)=>{console.error("error",Z)},X.onmessage=(Z)=>{const B=G.has(Z.data.$id)&&G.get(Z.data.$id);if(Z.data?.isError===!0&&B)B.reject(Z);if(B)B.resolve(Z),G.delete(Z.data.$id)},{messagePromise:async(Z,B)=>{return new Promise((S,F)=>{const I=Math.random().toString(36).substr(2,9);G.set(I,{resolve:S,reject:F}),X.postMessage({action:Z,data:B,$id:I})})},worker:X,type:"dedicated"}},dG=()=>{return{messagePromise:async(J,X)=>{return FG[J].call(X)},worker:null,type:"no-worker"}},lG=async()=>{const{messagePromise:G}=typeof SharedWorker!=="undefined"?await cG():typeof Worker!=="undefined"?await uG():dG(),J=async(S)=>{return G("prerender",S)},X=async(S)=>{const I=(await G("load",{urls:S})).data.result;return Y(I)},Y=(S,F=!0)=>{const I=[];for(let $ of S){const L=$;$G($.module,[]).then((M)=>{const W=M?.default,E=class extends(W||JG){static observedAttributes=Object.keys(L.watched_attrs);static settings=L};if(F)customElements.define($.tagName,E);I.push(E)})}return I},Z=async(S)=>{const I=(await G("build",{template:S})).data.result;return Y(I)},B=(S)=>{document.querySelectorAll("template[id][adv]").forEach((I)=>sG.build(I.outerHTML));let F=[];document.querySelectorAll('script[type="text/adv"][src]').forEach((I)=>{if(I.hasAttribute("src"))F.push(I.getAttribute("src")??"")}),X(F),document.removeEventListener("DOMContentLoaded",B)};return document.addEventListener("DOMContentLoaded",B),{render:J,build:Z,load:X}};class GG extends HTMLElement{anyAttrChanged(G,J){}attr=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.getAttribute(J);return null},set:(G,J,X)=>{if(this.isConnected)return this.setAttribute(J,X),this.anyAttrChanged(J,X),!0;return!1}});data=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.dataset[J];return null},set:(G,J,X)=>{if(this.isConnected)return this.dataset[J]=X,this.anyAttrChanged("data-"+J,X),!0;return!1}});#G;get internals(){return this.#G}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(G,J,X)=>{};attributeChangedCallback(G,J,X){this?.onAttributeChange(G,J,X)}onConnect=()=>{};connectedCallback(){this.#G=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(G,J,X){if(super.addEventListener(G,J,X),G=="connect"&&this.isConnected)J(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(G)=>{};onIntersect=(G)=>{}}class JG extends GG{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}refs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return oG(X);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.#G(),this.#z(),this?.onConnect()}#G(){switch(this.$settings?.root){case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}#J(){this.shadowRoot?.querySelectorAll("[ref]").forEach((G)=>{this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((X)=>X.startsWith("on")).forEach((X)=>{const Y=G.getAttribute(X)??"";if(X.toLowerCase()==="onmutate")G.addEventListener("adv:mutation",(Z)=>{try{new k("$self","event","$this","refs","data",Y)(this,Z,G,this.refs,this.data)}catch(B){console.error(B,Y,this)}});else try{G[X]=(Z)=>{new k("$self","event","$this","refs","data",Y)(this,Z,G,this.refs,this.data)}}catch(Z){console.error(Z,Y,this)}})})}#Z(){this?.querySelectorAll("[ref]").forEach((G)=>{this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((X)=>X.startsWith("on")).forEach((X)=>{const Y=G.getAttribute(X)??"";try{G[X]=(Z)=>{new k("$self","event","$this","refs","data",Y)(this,Z,G,this.refs,this.data)}}catch(Z){console.error(Z,Y,this)}})})}#q(){this.getAttributeNames().filter((G)=>G.startsWith("on")).forEach((G)=>{const J=this.getAttribute(G)??"";if(G.toLowerCase()==="onmutate"){this.onMutation=(X)=>new k("$self","event",J)(this,X);return}this[G]=(X)=>new k("$self","event",J)(this,X)})}#z(){this.#q(),this.#Z(),this.#J()}#X;get mutationObserver(){return this.#X}createMutationObserver(){if(this.$settings.mutation){if(this.#X=new MutationObserver((G,J)=>{this?.onMutation(G)}),this.#X.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#X.observe(this.shadowRoot,{...this.$settings.mutation})}}#Y;get interectObserver(){return this.#Y}createIntersectObserver(){if(this.$settings.intersection){let G=void 0;if(this.$settings?.intersection?.root)G=this.querySelector(this.$settings?.intersection?.root);this.#Y=new IntersectionObserver((J,X)=>{this.onIntersect(J)},{...this.$settings.intersection,root:G})}}}class LG extends GG{anyAttrChanged(G,J){this.render()}#G=new RG.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#J=PG((G,J)=>({}));get store(){return this.#J}get state(){return this.#J?.getState()}connectedCallback(){this.attachShadow({mode:"open"}),this.#J.subscribe((G,J)=>{this.render()}),this.render(),super.connectedCallback()}get eta(){return this.#G}render(){const G=EG(this.innerHTML,this.#G.config);let J="";try{J=this.eta.renderString(G,{$self:this})}catch(Y){}const X=`<div style="display:contents;" part="root">${J}</div>`;if(this.shadowRoot)this.shadowRoot.innerHTML=X}}if(!customElements.get("adv-view"))customElements.define("adv-view",LG);window.AdvectElement=JG;var sG=await lG();export{oG as refHandle,sG as advect,LG as AdvectView,JG as AdvectElement,GG as AdvectBase};
