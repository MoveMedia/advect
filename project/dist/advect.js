var _G=Object.create;var{getPrototypeOf:kG,defineProperty:BG,getOwnPropertyNames:hG}=Object;var vG=Object.prototype.hasOwnProperty;var DG=(G,X,Y)=>{Y=G!=null?_G(kG(G)):{};const Z=X||!G||!G.__esModule?BG(Y,"default",{value:G,enumerable:!0}):Y;for(let J of hG(G))if(!vG.call(Z,J))BG(Z,J,{get:()=>G[J],enumerable:!0});return Z};var IG=(G,X)=>()=>(X||G((X={exports:{}}).exports,X),X.exports);var HG=IG((JJ,VG)=>{var cG=(G,X={})=>{const Y={skipSameOrigin:!0,useBlob:!0,...X};if(!G.includes("://")||G.includes(window.location.origin))return Promise.resolve(G);return new Promise((Z,J)=>fetch(G).then((B)=>B.text()).then((B)=>{let F=new URL(G).href.split("/");F.pop();const $=`const _importScripts = importScripts;
const _fixImports = (url) => new URL(url, '${F.join("/")+"/"}').href;
importScripts = (...urls) => _importScripts(...urls.map(_fixImports));`;let S="data:application/javascript,"+encodeURIComponent($+B);if(Y.useBlob)S=URL.createObjectURL(new Blob([`importScripts("${S}")`],{type:"application/javascript"}));Z(S)}).catch(J))};VG.exports=cG});var EG=IG((s,MG)=>{(function(G,X){typeof s=="object"&&typeof MG!="undefined"?X(s):typeof define=="function"&&define.amd?define(["exports"],X):X((G||self).eta={})})(s,function(G){function X(){return X=Object.assign?Object.assign.bind():function(q){for(var z=1;z<arguments.length;z++){var K=arguments[z];for(var Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&(q[Q]=K[Q])}return q},X.apply(this,arguments)}function Y(q,z){q.prototype=Object.create(z.prototype),q.prototype.constructor=q,J(q,z)}function Z(q){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},Z(q)}function J(q,z){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(K,Q){return K.__proto__=Q,K},J(q,z)}function B(q,z,K){return B=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}()?Reflect.construct.bind():function(Q,I,O){var H=[null];H.push.apply(H,I);var V=new(Function.bind.apply(Q,H));return O&&J(V,O.prototype),V},B.apply(null,arguments)}function F(q){var z=typeof Map=="function"?new Map:void 0;return F=function(K){if(K===null||Function.toString.call(K).indexOf("[native code]")===-1)return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(z!==void 0){if(z.has(K))return z.get(K);z.set(K,Q)}function Q(){return B(K,arguments,Z(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),J(Q,K)},F(q)}var $=function(){function q(K){this.cache=void 0,this.cache=K}var z=q.prototype;return z.define=function(K,Q){this.cache[K]=Q},z.get=function(K){return this.cache[K]},z.remove=function(K){delete this.cache[K]},z.reset=function(){this.cache={}},z.load=function(K){this.cache=X({},this.cache,K)},q}(),S=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="Eta Error",Q}return Y(z,q),z}(F(Error)),D=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaParser Error",Q}return Y(z,q),z}(S),R=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaRuntime Error",Q}return Y(z,q),z}(S),M=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaNameResolution Error",Q}return Y(z,q),z}(S);function P(q,z,K){var Q=z.slice(0,K).split(/\n/),I=Q.length,O=Q[I-1].length+1;throw q+=" at line "+I+" col "+O+":\n\n  "+z.split(/\n/)[I-1]+"\n  "+Array(O).join(" ")+"^",new D(q)}function E(q,z,K,Q){var I=z.split("\n"),O=Math.max(K-3,0),H=Math.min(I.length,K+3),V=Q,y=I.slice(O,H).map(function(a,u){var b=u+O+1;return(b==K?" >> ":"    ")+b+"| "+a}).join("\n"),W=new R((V?V+":"+K+"\n":"line "+K+"\n")+y+"\n\n"+q.message);throw W.name=q.name,W}var _=function(){return Promise.resolve()}.constructor;function A(q,z){var K=this.config,Q=z&&z.async?_:Function;try{return new Q(K.varName,"options",this.compileToString.call(this,q,z))}catch(I){throw I instanceof SyntaxError?new D("Bad template syntax\n\n"+I.message+"\n"+Array(I.message.length+1).join("=")+"\n"+this.compileToString.call(this,q,z)+"\n"):I}}function L(q,z){var K=this.config,Q=z&&z.async,I=this.compileBody,O=this.parse.call(this,q),H=K.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(K.debug?', line: 1, templateStr: "'+q.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(K.debug?"try {":"")+(K.useWith?"with("+K.varName+"||{}){":"")+"\n\n"+I.call(this,O)+"\nif (__eta.layout) {\n  __eta.res = "+(Q?"await includeAsync":"include")+" (__eta.layout, {..."+K.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(K.useWith?"}":"")+(K.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(K.plugins)for(var V=0;V<K.plugins.length;V++){var y=K.plugins[V];y.processFnString&&(H=y.processFnString(H,K))}return H}function j(q){for(var z=this.config,K=0,Q=q.length,I="";K<Q;K++){var O=q[K];if(typeof O=="string")I+="__eta.res+='"+O+"'\n";else{var H=O.t,V=O.val||"";z.debug&&(I+="__eta.line="+O.lineNo+"\n"),H==="r"?(z.autoFilter&&(V="__eta.f("+V+")"),I+="__eta.res+="+V+"\n"):H==="i"?(z.autoFilter&&(V="__eta.f("+V+")"),z.autoEscape&&(V="__eta.e("+V+")"),I+="__eta.res+="+V+"\n"):H==="e"&&(I+=V+"\n")}}return I}var WG={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function bG(q){return WG[q]}var YG={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(q){var z=String(q);return/[&<>"']/.test(z)?z.replace(/[&<>"']/g,bG):z},filterFunction:function(q){return String(q)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},g=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,m=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,p=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function c(q){return q.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function CG(q,z){return q.slice(0,z).split("\n").length}function wG(q){var z=this.config,K=[],Q=!1,I=0,O=z.parse;if(z.plugins)for(var H=0;H<z.plugins.length;H++){var V=z.plugins[H];V.processTemplate&&(q=V.processTemplate(q,z))}function y(C,k){C&&(C=function(w,o,n,t){var N,T;return Array.isArray(o.autoTrim)?(N=o.autoTrim[1],T=o.autoTrim[0]):N=T=o.autoTrim,(n||n===!1)&&(N=n),(t||t===!1)&&(T=t),T||N?N==="slurp"&&T==="slurp"?w.trim():(N==="_"||N==="slurp"?w=w.trimStart():N!=="-"&&N!=="nl"||(w=w.replace(/^(?:\r\n|\n|\r)/,"")),T==="_"||T==="slurp"?w=w.trimEnd():T!=="-"&&T!=="nl"||(w=w.replace(/(?:\r\n|\n|\r)$/,"")),w):w}(C,z,Q,k),C&&(C=C.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),K.push(C)))}z.rmWhitespace&&(q=q.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),g.lastIndex=0,m.lastIndex=0,p.lastIndex=0;for(var W,a=[O.exec,O.interpolate,O.raw].reduce(function(C,k){return C&&k?C+"|"+c(k):k?c(k):C},""),u=new RegExp(c(z.tags[0])+"(-|_)?\\s*("+a+")?\\s*","g"),b=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+c(z.tags[1])+")","g");W=u.exec(q);){var jG=q.slice(I,W.index);I=W[0].length+W.index;var i=W[2]||"";y(jG,W[1]),b.lastIndex=I;for(var U=void 0,d=!1;U=b.exec(q);){if(U[1]){var yG=q.slice(I,U.index);u.lastIndex=I=b.lastIndex,Q=U[2],d={t:i===O.exec?"e":i===O.raw?"r":i===O.interpolate?"i":"",val:yG};break}var l=U[0];if(l==="/*"){var KG=q.indexOf("*/",b.lastIndex);KG===-1&&P("unclosed comment",q,U.index),b.lastIndex=KG}else l==="'"?(m.lastIndex=U.index,m.exec(q)?b.lastIndex=m.lastIndex:P("unclosed string",q,U.index)):l==='"'?(p.lastIndex=U.index,p.exec(q)?b.lastIndex=p.lastIndex:P("unclosed string",q,U.index)):l==="`"&&(g.lastIndex=U.index,g.exec(q)?b.lastIndex=g.lastIndex:P("unclosed string",q,U.index))}d?(z.debug&&(d.lineNo=CG(q,W.index)),K.push(d)):P("unclosed tag",q,W.index)}if(y(q.slice(I,q.length),!1),z.plugins)for(var r=0;r<z.plugins.length;r++){var QG=z.plugins[r];QG.processAST&&(K=QG.processAST(K,z))}return K}function ZG(q,z){var K=z&&z.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!q.startsWith("@")){var Q=z.filepath,I=K.get(Q);if(this.config.cache&&I)return I;var O=this.readFile(Q),H=this.compile(O,z);return this.config.cache&&K.define(Q,H),H}var V=K.get(q);if(V)return V;throw new M("Failed to get template '"+q+"'")}function qG(q,z,K){var Q,I=X({},K,{async:!1});return typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(I.filepath=this.resolvePath(q,I)),Q=ZG.call(this,q,I)):Q=q,Q.call(this,z,I)}function zG(q,z,K){var Q,I=X({},K,{async:!0});typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(I.filepath=this.resolvePath(q,I)),Q=ZG.call(this,q,I)):Q=q;var O=Q.call(this,z,I);return Promise.resolve(O)}function AG(q,z){var K=this.compile(q,{async:!1});return qG.call(this,K,z)}function NG(q,z){var K=this.compile(q,{async:!0});return zG.call(this,K,z)}var TG=function(){function q(K){this.config=void 0,this.RuntimeErr=E,this.compile=A,this.compileToString=L,this.compileBody=j,this.parse=wG,this.render=qG,this.renderAsync=zG,this.renderString=AG,this.renderStringAsync=NG,this.filepathCache={},this.templatesSync=new $({}),this.templatesAsync=new $({}),this.resolvePath=null,this.readFile=null,this.config=K?X({},YG,K):X({},YG)}var z=q.prototype;return z.configure=function(K){this.config=X({},this.config,K)},z.withConfig=function(K){return X({},this,{config:X({},this.config,K)})},z.loadTemplate=function(K,Q,I){if(typeof Q=="string")(I&&I.async?this.templatesAsync:this.templatesSync).define(K,this.compile(Q,I));else{var O=this.templatesSync;(Q.constructor.name==="AsyncFunction"||I&&I.async)&&(O=this.templatesAsync),O.define(K,Q)}},q}(),fG=function(q){function z(){return q.apply(this,arguments)||this}return Y(z,q),z}(TG);G.Eta=fG})});var x={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},gG=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class v{constructor(G,X,Y,Z){this.tagName=G,this.attributes=X,this.children=Y,this.content=Z,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let G=this.content||"";for(let X of this.children)G+=X.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${G}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(G){if(this.isRemoved)return null;if(this.attributes.id===G)return this;for(let X of this.children){const Y=X.getElementById(G);if(Y)return Y}return null}getElementsByClass(G){if(this.isRemoved)return[];const X=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(G))X.push(this);for(let Y of this.children)X.push(...Y.getElementsByClass(G));return X}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(G){if(G.includes("*"))return;const X={};for(let[Y,Z]of Object.entries(this.attributes))if(G.includes(Y))X[Y]=Z;this.attributes=X;for(let Y of this.children)Y.filterAttributes(G)}getAttributesString(){return Object.entries(this.attributes).map(([G,X])=>` ${G}="${X}"`).join("")}static create(G){const X=v.tokenize(G),Y=[],Z=[];let J=null,B={},F="";for(let $ of X)switch($.type){case x.TAG_OPEN:if(J){if(Object.keys(J.attributes).length===0)J.attributes=B;J.content=F.trim(),B={},F="",Z.push(J)}J=new v($.value,{},[]);break;case x.ATTRIBUTE_NAME:B[$.value]="";break;case x.ATTRIBUTE_VALUE:const S=Object.keys(B).pop();B[S]=$.value;break;case x.TAG_CLOSE:case x.SELF_CLOSING_TAG:if(!J)break;if(J.isSelfClosing=$.type===x.SELF_CLOSING_TAG,Object.keys(J.attributes).length===0)J.attributes=B;if(!J.content)J.content=F;else J.content+=" "+F;if(F="",B={},Z.length>0)Z[Z.length-1].children.push(J);else Y.push(J);J=Z.pop()||null;break;case x.TEXT:if(J)F+=$.value;break}return Y}static tokenize(G){const X=[];let Y=0;while(Y<G.length)if(G[Y]==="<")if(G[Y+1]==="/"){let Z=Y+2;while(Z<G.length&&G[Z]!==">")Z++;X.push({type:x.TAG_CLOSE,value:G.slice(Y+2,Z).trim()}),Y=Z+1}else{let Z=Y+1;while(Z<G.length&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")Z++;const J=G.slice(Y+1,Z).trim();X.push({type:x.TAG_OPEN,value:G.slice(Y+1,Z).trim()});while(Z<G.length&&G[Z]!==">")if(G[Z]===" "){Z++;let B="";while(Z<G.length&&G[Z]!=="="&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")B+=G[Z],Z++;if(B!=="")X.push({type:x.ATTRIBUTE_NAME,value:B.trim().toLowerCase()});if(G[Z]==="="){Z++;const F=G[Z];Z++;let $="";while(Z<G.length&&G[Z]!==F)$+=G[Z],Z++;X.push({type:x.ATTRIBUTE_VALUE,value:$}),Z++}}else Z++;if(gG.has(J.toLowerCase())&&G[Z]===">")X.push({type:x.SELF_CLOSING_TAG,value:J});if(G[Z]===">")Z++;Y=Z}else{let Z=Y;while(Z<G.length&&G[Z]!=="<")Z++;X.push({type:x.TEXT,value:G.slice(Y,Z)}),Y=Z}return X}}function SG(G){return Object.keys(mG).find((X)=>X.toLowerCase()==G.toLocaleLowerCase())!=null}function $G(G,X){return import("data:text/javascript;charset=utf-8,"+X.join("\n")+encodeURIComponent(`${G}`)).then((Z)=>Z).catch((Z)=>{return console.error(Z),null})}function pG(G){switch(G.data?.___type){case"table":console.table(G.data);break;case"dir":console.dir(G.data);break;case"error":console.error(G.data);break;case"warn":console.warn(G.data);break;default:case"log":console.log(G.data);break}}function f(G){e.postMessage({...G,___type:"log"})}function FG(G){e.postMessage({...G,___type:"warn"})}var mG={number:{},string:{},bigint:{},color:{}};var h=Object.getPrototypeOf(async function(){}).constructor,e=new BroadcastChannel("advect:log");e.onmessage=(G)=>pG(G);var OG={async prerender(G){return f({renderDesc:G}),""},async load({urls:G}){f({message:"starting my loading",urls:G});const X=[],Y=[];if(Array.isArray(G))Y.push(...G);if(typeof G=="string")Y.push(G);for(let Z of Y){const J=await fetch(Z).then((B)=>B.text()).then(async(B)=>await this.build({template:B}));f({msg:"wow loading some stuff",url:Z,data:J}),X.push(...J)}return f({message:"done loading",urls:G}),X},async build({template:G}){const X=v.create(String.raw`${G}`),Y=[];f({message:"building",template:G,root_nodes:X});for(let Z of X){f({message:"Adding",root_node:Z.attributes.id});const J={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(Z.tagName.toLowerCase()==="template"){if(!Z.attributes.id){f("advect Template must have an id that will become the tag name");continue}const F=Z.attributes.id;if(F.indexOf("-")===-1){f("advect Template tag name must contain a hyphen");continue}if(J.tagName=F,J.templateNode=Z,Z.attributes.root)J.root=Z.attributes.root;else J.root="light";if(Z.attributes.shadow)J.shadow=Z.attributes.shadow;else J.shadow="closed";const $=[...Z.children];while($.length>0){const S=$.shift();if(!S)continue;if(S.tagName==="settings")S.children.forEach((D)=>{if(D.tagName=="mutation"){if(J?.mutation?.attributeFilter&&D.attributes.attributeFilter)J.mutation.attributeFilter=D.attributes.attributeFilter.split(",");if(J?.mutation?.attributes&&D.attributes.attributes)J.mutation.attributes=D.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(J?.mutation?.characterData&&D.attributes.characterData)J.mutation.characterData=D.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(J?.mutation?.childList&&D.attributes.childList)J.mutation.childList=D.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(J?.mutation?.subtree&&D.attributes.subtree)J.mutation.subtree=D.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if(D.tagName=="intersection"){if(J?.intersection&&D.attributes.margin)J.intersection.margin=parseFloat(D.attributes.margin);if(J?.intersection.threshhold&&D.attributes.threshhold)J.intersection.threshhold=parseFloat(D.attributes.threshhold);if(J?.intersection.root&&D.attributes.root)J.intersection.root=D.attributes.root}if(D.tagName=="attr"&&D.attributes.name){const R=D.attributes.name,M=D.attributes.type??"string";if(SG(M))J.watched_attrs[R]={type:M}}D.remove()}),S.remove();if(S.tagName==="script"){if(S.attributes.type.toLocaleLowerCase()==="text/adv"&&S.attributes.type){const D=new URL(S.attributes.src);this.load({urls:D.toString()})}if(S.attributes.type.toLocaleLowerCase()==="module"&&!S.attributes.src)J.module=S.text()}if(S.attributes.ref)J.refs.push(S);$.push(...S.children)}}const B=Z.children.map((F)=>F.html()).join("");J.template=B,Y.push(J)}return Y}};var GG=DG(HG(),1);var UG=DG(EG(),1);function xG(G,X){const[Y,Z]=X.tags,J=X.parse.exec,B=D(G),F=R(B),$=M(F),S=P($);function D(E){return E.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function R(E){return E.replace(/<if check="([^"]+)">/g,`${Y}${J} if ( \$1 ) { ${Z}`).replace(/<else\/?>/g,`${Y}${J} } else { ${Z}`).replace(/<\/if>/g,`${Y}${J} } ${Z}`)}function M(E){return E.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(_,A,L,j){if(L&&j)return`${Y}${J} ${A}.forEach(function(${L}, ${j}){ ${Z}`;else if(L)return`${Y}${J} ${A}.forEach(function(${L}){ ${Z}`;else return`${Y}${J} ${A}.forEach(function(){ ${Z}`}).replace(/<\/for>/g,`${Y}${J} }) ${Z}`)}function P(E){return E.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(_,A,L,j){if(L&&j)return`${Y}${J} Object.keys(${A}).forEach(function(${L}) { ${Z} 
                        ${Y}${J} const ${j} = ${A}[${L}] ${Z}
                    `;else if(L)return`${Y}${J} Object.keys(${A}).forEach(function(${L}) { ${Z}`;else return`${Y}${J} Object.keys(${A}).forEach(function() { ${Z}`}).replace(/<\/of>/g,`${Y}${J} }) ${Z}`)}return S}var RG=(G)=>{let X;const Y=new Set,Z=(D,R)=>{const M=typeof D==="function"?D(X):D;if(!Object.is(M,X)){const P=X;X=(R!=null?R:typeof M!=="object"||M===null)?M:Object.assign({},X,M),Y.forEach((E)=>E(X,P))}},J=()=>X,$={setState:Z,getState:J,getInitialState:()=>S,subscribe:(D)=>{return Y.add(D),()=>Y.delete(D)}},S=X=G(Z,J,$);return $},LG=(G)=>G?RG(G):RG;function sG(G){return new Promise((X,Y)=>{if(!G.isConnected){X(null);return}if(G.tagName.indexOf("-")==-1){X(G);return}if(!G.matches(":defined"))customElements.whenDefined(G.tagName).then((B)=>{X(G)}).catch((B)=>{Y(B)});X(G)})}var uG=async()=>{const G=new Map,X=await GG.default(new URL("advect.sharedworker.js",import.meta.url).href),Y=new SharedWorker(X,{type:"module"});return Y.onerror=(J)=>{console.warn("error",J)},Y.port.onmessage=(J)=>{const B=G.has(J.data.$id)&&G.get(J.data.$id);if(J.data?.isError===!0&&B)B.reject(J);if(B)B.resolve(J),G.delete(J.data.$id)},{messagePromise:async(J,B)=>{return new Promise((F,$)=>{const S=Math.random().toString(36).substr(2,9);G.set(S,{resolve:F,reject:$}),Y.port.postMessage({action:J,data:B,$id:S})})},worker:Y,type:"shared"}},dG=async()=>{const G=new Map,X=await GG.default(new URL("advect.worker.js",import.meta.url).href),Y=new Worker(X,{type:"module"});return Y.onerror=(J)=>{console.error("error",J)},Y.onmessage=(J)=>{const B=G.has(J.data.$id)&&G.get(J.data.$id);if(J.data?.isError===!0&&B)B.reject(J);if(B)B.resolve(J),G.delete(J.data.$id)},{messagePromise:async(J,B)=>{return new Promise((F,$)=>{const S=Math.random().toString(36).substr(2,9);G.set(S,{resolve:F,reject:$}),Y.postMessage({action:J,data:B,$id:S})})},worker:Y,type:"dedicated"}},lG=()=>{const G=new BroadcastChannel("advect:noworker"),X=new BroadcastChannel("advect:noworker");G.onmessageerror=(J)=>console.error(J),G.onmessage=(J)=>{const B=Y.has(J.data.$id)&&Y.get(J.data.$id);if(J.data?.isError===!0&&B)B.reject(J);if(B)OG[J.data.action].call(null,J.data.data).then((F)=>{J.data.result=F,B.resolve(J),Y.delete(J.data.$id)})};const Y=new Map;return{messagePromise:async(J,B)=>{return new Promise((F,$)=>{const S=Math.random().toString(36).substr(2,9);Y.set(S,{resolve:F,reject:$}),X.postMessage({action:J,data:B,$id:S})})},worker:null,type:"no-worker"}},oG=async()=>{const G=new URL(import.meta.url).searchParams.get("type")?.toLocaleLowerCase();let X;switch(G){case"d":X=(await dG()).messagePromise;break;case"s":X=(await uG()).messagePromise;break;default:X=lG().messagePromise;break}const Y=async($)=>{return X("prerender",$)},Z=async($)=>{const D=(await X("load",{urls:$})).data.result;return J(D)},J=($,S=!0)=>{const D=[];for(let R of $){const M=R;$G(R.module,[]).then((P)=>{const E=P?.default,_=class extends(E||XG){static observedAttributes=Object.keys(M.watched_attrs);static settings=M};if(S)customElements.define(R.tagName,_);D.push(_)})}return D},B=async($)=>{const D=(await X("build",{template:$})).data.result;return J(D)},F=($)=>{document.querySelectorAll("template[id][adv]").forEach((D)=>B(D.outerHTML));let S=[];document.querySelectorAll('script[type="text/adv"][src]').forEach((D)=>{if(D.hasAttribute("src"))S.push(D.getAttribute("src")??"")}),Z(S),document.removeEventListener("DOMContentLoaded",F)};if(document.readyState!=="loading")F(null);else document.addEventListener("DOMContentLoaded",F);return{render:Y,build:B,load:Z}};class JG extends HTMLElement{anyAttrChanged(G,X){}attr=new Proxy({},{get:(G,X)=>{if(this.isConnected)return this.getAttribute(X);return null},set:(G,X,Y)=>{if(this.isConnected)return this.setAttribute(X,Y),this.anyAttrChanged(X,Y),!0;return!1}});data=new Proxy({},{get:(G,X)=>{if(this.isConnected)return this.dataset[X];return null},set:(G,X,Y)=>{if(this.isConnected)return this.dataset[X]=Y,this.anyAttrChanged("data-"+X,Y),!0;return!1}});#G;get internals(){return this.#G}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(G,X,Y)=>{};attributeChangedCallback(G,X,Y){this?.onAttributeChange(G,X,Y)}onConnect=()=>{};connectedCallback(){this.#G=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(G,X,Y){if(super.addEventListener(G,X,Y),G=="connect"&&this.isConnected)X(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(G)=>{};onIntersect=(G)=>{}}class XG extends JG{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}refs=new Proxy({},{get:(G,X)=>{const Y=this.querySelector(`[ref="${X}"]`)||this?.shadowRoot?.querySelector(`[ref="${X}"]`);if(Y)return sG(Y);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.#G(),this.#z(),this?.onConnect()}#G(){switch(this.$settings?.root){case"none":break;case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}#J(){this.shadowRoot?.querySelectorAll("[ref]").forEach((G)=>{this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((Y)=>Y.startsWith("on")).forEach((Y)=>{const Z=G.getAttribute(Y)??"";if(Y.toLowerCase()==="onmutate")G.addEventListener("adv:mutation",(J)=>{try{new h("$self","event","$this","refs","data",Z)(this,J,G,this.refs,this.data)}catch(B){console.error(B,Z,this)}});else try{G[Y]=(J)=>{new h("$self","event","$this","refs","data",Z)(this,J,G,this.refs,this.data)}}catch(J){console.error(J,Z,this)}})})}#Z(){this?.querySelectorAll("[ref]").forEach((G)=>{this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((Y)=>Y.startsWith("on")).forEach((Y)=>{const Z=G.getAttribute(Y)??"";try{G[Y]=(J)=>{new h("$self","event","$this","refs","data",Z)(this,J,G,this.refs,this.data)}}catch(J){console.error(J,Z,this)}})})}#q(){this.getAttributeNames().filter((G)=>G.startsWith("on")).forEach((G)=>{const X=this.getAttribute(G)??"";if(G.toLowerCase()==="onmutate"){this.onMutation=(Y)=>new h("$self","event",X)(this,Y);return}this[G]=(Y)=>new h("$self","event",X)(this,Y)})}#z(){this.#q(),this.#Z(),this.#J()}#X;get mutationObserver(){return this.#X}createMutationObserver(){if(this.$settings.mutation){if(this.#X=new MutationObserver((G,X)=>{this?.onMutation(G)}),this.#X.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#X.observe(this.shadowRoot,{...this.$settings.mutation})}}#Y;get interectObserver(){return this.#Y}createIntersectObserver(){if(this.$settings.intersection){let G=void 0;if(this.$settings?.intersection?.root)G=this.querySelector(this.$settings?.intersection?.root);this.#Y=new IntersectionObserver((X,Y)=>{this.onIntersect(X)},{...this.$settings.intersection,root:G})}}}class PG extends JG{anyAttrChanged(G,X){this.render()}#G=new UG.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#J=LG((G,X)=>({}));get store(){return this.#J}get state(){return this.#J?.getState()}connectedCallback(){this.attachShadow({mode:"open"}),this.#J.subscribe((G,X)=>{this.render()}),this.render(),super.connectedCallback()}get eta(){return this.#G}render(){const G=xG(this.innerHTML,this.#G.config);let X="";try{X=this.eta.renderString(G,{$self:this})}catch(Z){FG(Z)}const Y=`<div style="display:contents;" part="root">${X}</div>`;if(this.shadowRoot)this.shadowRoot.innerHTML=Y}}if(!customElements.get("adv-view"))customElements.define("adv-view",PG);window.AdvectElement=XG;var BJ=await oG();export{sG as refHandle,BJ as advect,PG as AdvectView,XG as AdvectElement,JG as AdvectBase};
