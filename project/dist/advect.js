var kG=Object.create;var{getPrototypeOf:hG,defineProperty:BG,getOwnPropertyNames:gG}=Object;var pG=Object.prototype.hasOwnProperty;var IG=(G,J,X)=>{X=G!=null?kG(hG(G)):{};const Z=J||!G||!G.__esModule?BG(X,"default",{value:G,enumerable:!0}):X;for(let Y of gG(G))if(!pG.call(Z,Y))BG(Z,Y,{get:()=>G[Y],enumerable:!0});return Z};var FG=(G,J)=>()=>(J||G((J={exports:{}}).exports,J),J.exports);var SG=FG((YJ,xG)=>{var dG=(G,J={})=>{const X={skipSameOrigin:!0,useBlob:!0,...J};if(!G.includes("://")||G.includes(window.location.origin))return Promise.resolve(G);return new Promise((Z,Y)=>fetch(G).then((D)=>D.text()).then((D)=>{let V=new URL(G).href.split("/");V.pop();const I=`const _importScripts = importScripts;
const _fixImports = (url) => new URL(url, '${V.join("/")+"/"}').href;
importScripts = (...urls) => _importScripts(...urls.map(_fixImports));`;let O="data:application/javascript,"+encodeURIComponent(I+D);if(X.useBlob)O=URL.createObjectURL(new Blob([`importScripts("${O}")`],{type:"application/javascript"}));Z(O)}).catch(Y))};xG.exports=dG});var RG=FG((s,LG)=>{(function(G,J){typeof s=="object"&&typeof LG!="undefined"?J(s):typeof define=="function"&&define.amd?define(["exports"],J):J((G||self).eta={})})(s,function(G){function J(){return J=Object.assign?Object.assign.bind():function(q){for(var z=1;z<arguments.length;z++){var K=arguments[z];for(var Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&(q[Q]=K[Q])}return q},J.apply(this,arguments)}function X(q,z){q.prototype=Object.create(z.prototype),q.prototype.constructor=q,Y(q,z)}function Z(q){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},Z(q)}function Y(q,z){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(K,Q){return K.__proto__=Q,K},Y(q,z)}function D(q,z,K){return D=function(){if(typeof Reflect=="undefined"||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}()?Reflect.construct.bind():function(Q,B,M){var E=[null];E.push.apply(E,B);var H=new(Function.bind.apply(Q,E));return M&&Y(H,M.prototype),H},D.apply(null,arguments)}function V(q){var z=typeof Map=="function"?new Map:void 0;return V=function(K){if(K===null||Function.toString.call(K).indexOf("[native code]")===-1)return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(z!==void 0){if(z.has(K))return z.get(K);z.set(K,Q)}function Q(){return D(K,arguments,Z(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),Y(Q,K)},V(q)}var I=function(){function q(K){this.cache=void 0,this.cache=K}var z=q.prototype;return z.define=function(K,Q){this.cache[K]=Q},z.get=function(K){return this.cache[K]},z.remove=function(K){delete this.cache[K]},z.reset=function(){this.cache={}},z.load=function(K){this.cache=J({},this.cache,K)},q}(),O=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="Eta Error",Q}return X(z,q),z}(V(Error)),F=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaParser Error",Q}return X(z,q),z}(O),$=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaRuntime Error",Q}return X(z,q),z}(O),x=function(q){function z(K){var Q;return(Q=q.call(this,K)||this).name="EtaNameResolution Error",Q}return X(z,q),z}(O);function S(q,z,K){var Q=z.slice(0,K).split(/\n/),B=Q.length,M=Q[B-1].length+1;throw q+=" at line "+B+" col "+M+":\n\n  "+z.split(/\n/)[B-1]+"\n  "+Array(M).join(" ")+"^",new F(q)}function j(q,z,K,Q){var B=z.split("\n"),M=Math.max(K-3,0),E=Math.min(B.length,K+3),H=Q,_=B.slice(M,E).map(function(r,d){var b=d+M+1;return(b==K?" >> ":"    ")+b+"| "+r}).join("\n"),W=new $((H?H+":"+K+"\n":"line "+K+"\n")+_+"\n\n"+q.message);throw W.name=q.name,W}var v=function(){return Promise.resolve()}.constructor;function L(q,z){var K=this.config,Q=z&&z.async?v:Function;try{return new Q(K.varName,"options",this.compileToString.call(this,q,z))}catch(B){throw B instanceof SyntaxError?new F("Bad template syntax\n\n"+B.message+"\n"+Array(B.message.length+1).join("=")+"\n"+this.compileToString.call(this,q,z)+"\n"):B}}function i(q,z){var K=this.config,Q=z&&z.async,B=this.compileBody,M=this.parse.call(this,q),E=K.functionHeader+'\nlet include = (template, data) => this.render(template, data, options);\nlet includeAsync = (template, data) => this.renderAsync(template, data, options);\n\nlet __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction'+(K.debug?', line: 1, templateStr: "'+q.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':"")+"};\n\nfunction layout(path, data) {\n  __eta.layout = path;\n  __eta.layoutData = data;\n}"+(K.debug?"try {":"")+(K.useWith?"with("+K.varName+"||{}){":"")+"\n\n"+B.call(this,M)+"\nif (__eta.layout) {\n  __eta.res = "+(Q?"await includeAsync":"include")+" (__eta.layout, {..."+K.varName+", body: __eta.res, ...__eta.layoutData});\n}\n"+(K.useWith?"}":"")+(K.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":"")+"\nreturn __eta.res;\n";if(K.plugins)for(var H=0;H<K.plugins.length;H++){var _=K.plugins[H];_.processFnString&&(E=_.processFnString(E,K))}return E}function w(q){for(var z=this.config,K=0,Q=q.length,B="";K<Q;K++){var M=q[K];if(typeof M=="string")B+="__eta.res+='"+M+"'\n";else{var E=M.t,H=M.val||"";z.debug&&(B+="__eta.line="+M.lineNo+"\n"),E==="r"?(z.autoFilter&&(H="__eta.f("+H+")"),B+="__eta.res+="+H+"\n"):E==="i"?(z.autoFilter&&(H="__eta.f("+H+")"),z.autoEscape&&(H="__eta.e("+H+")"),B+="__eta.res+="+H+"\n"):E==="e"&&(B+=H+"\n")}}return B}var P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function f(q){return P[q]}var ZG={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:function(q){var z=String(q);return/[&<>"']/.test(z)?z.replace(/[&<>"']/g,f):z},filterFunction:function(q){return String(q)},functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},p=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,m=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,c=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function u(q){return q.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function wG(q,z){return q.slice(0,z).split("\n").length}function TG(q){var z=this.config,K=[],Q=!1,B=0,M=z.parse;if(z.plugins)for(var E=0;E<z.plugins.length;E++){var H=z.plugins[E];H.processTemplate&&(q=H.processTemplate(q,z))}function _(A,y){A&&(A=function(C,a,e,GG){var T,N;return Array.isArray(a.autoTrim)?(T=a.autoTrim[1],N=a.autoTrim[0]):T=N=a.autoTrim,(e||e===!1)&&(T=e),(GG||GG===!1)&&(N=GG),N||T?T==="slurp"&&N==="slurp"?C.trim():(T==="_"||T==="slurp"?C=C.trimStart():T!=="-"&&T!=="nl"||(C=C.replace(/^(?:\r\n|\n|\r)/,"")),N==="_"||N==="slurp"?C=C.trimEnd():N!=="-"&&N!=="nl"||(C=C.replace(/(?:\r\n|\n|\r)$/,"")),C):C}(A,z,Q,y),A&&(A=A.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),K.push(A)))}z.rmWhitespace&&(q=q.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),p.lastIndex=0,m.lastIndex=0,c.lastIndex=0;for(var W,r=[M.exec,M.interpolate,M.raw].reduce(function(A,y){return A&&y?A+"|"+u(y):y?u(y):A},""),d=new RegExp(u(z.tags[0])+"(-|_)?\\s*("+r+")?\\s*","g"),b=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+u(z.tags[1])+")","g");W=d.exec(q);){var yG=q.slice(B,W.index);B=W[0].length+W.index;var n=W[2]||"";_(yG,W[1]),b.lastIndex=B;for(var U=void 0,l=!1;U=b.exec(q);){if(U[1]){var vG=q.slice(B,U.index);d.lastIndex=B=b.lastIndex,Q=U[2],l={t:n===M.exec?"e":n===M.raw?"r":n===M.interpolate?"i":"",val:vG};break}var o=U[0];if(o==="/*"){var DG=q.indexOf("*/",b.lastIndex);DG===-1&&S("unclosed comment",q,U.index),b.lastIndex=DG}else o==="'"?(m.lastIndex=U.index,m.exec(q)?b.lastIndex=m.lastIndex:S("unclosed string",q,U.index)):o==='"'?(c.lastIndex=U.index,c.exec(q)?b.lastIndex=c.lastIndex:S("unclosed string",q,U.index)):o==="`"&&(p.lastIndex=U.index,p.exec(q)?b.lastIndex=p.lastIndex:S("unclosed string",q,U.index))}l?(z.debug&&(l.lineNo=wG(q,W.index)),K.push(l)):S("unclosed tag",q,W.index)}if(_(q.slice(B,q.length),!1),z.plugins)for(var t=0;t<z.plugins.length;t++){var QG=z.plugins[t];QG.processAST&&(K=QG.processAST(K,z))}return K}function qG(q,z){var K=z&&z.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!q.startsWith("@")){var Q=z.filepath,B=K.get(Q);if(this.config.cache&&B)return B;var M=this.readFile(Q),E=this.compile(M,z);return this.config.cache&&K.define(Q,E),E}var H=K.get(q);if(H)return H;throw new x("Failed to get template '"+q+"'")}function zG(q,z,K){var Q,B=J({},K,{async:!1});return typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(B.filepath=this.resolvePath(q,B)),Q=qG.call(this,q,B)):Q=q,Q.call(this,z,B)}function KG(q,z,K){var Q,B=J({},K,{async:!0});typeof q=="string"?(this.resolvePath&&this.readFile&&!q.startsWith("@")&&(B.filepath=this.resolvePath(q,B)),Q=qG.call(this,q,B)):Q=q;var M=Q.call(this,z,B);return Promise.resolve(M)}function NG(q,z){var K=this.compile(q,{async:!1});return zG.call(this,K,z)}function jG(q,z){var K=this.compile(q,{async:!0});return KG.call(this,K,z)}var fG=function(){function q(K){this.config=void 0,this.RuntimeErr=j,this.compile=L,this.compileToString=i,this.compileBody=w,this.parse=TG,this.render=zG,this.renderAsync=KG,this.renderString=NG,this.renderStringAsync=jG,this.filepathCache={},this.templatesSync=new I({}),this.templatesAsync=new I({}),this.resolvePath=null,this.readFile=null,this.config=K?J({},ZG,K):J({},ZG)}var z=q.prototype;return z.configure=function(K){this.config=J({},this.config,K)},z.withConfig=function(K){return J({},this,{config:J({},this.config,K)})},z.loadTemplate=function(K,Q,B){if(typeof Q=="string")(B&&B.async?this.templatesAsync:this.templatesSync).define(K,this.compile(Q,B));else{var M=this.templatesSync;(Q.constructor.name==="AsyncFunction"||B&&B.async)&&(M=this.templatesAsync),M.define(K,Q)}},q}(),_G=function(q){function z(){return q.apply(this,arguments)||this}return X(z,q),z}(fG);G.Eta=_G})});var R={TEXT:0,TAG_OPEN:1,TAG_CLOSE:2,ATTRIBUTE_NAME:3,ATTRIBUTE_VALUE:4,SELF_CLOSING_TAG:5},mG=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr","att","attr","mutation","intersection"]);class k{constructor(G,J,X,Z){this.tagName=G,this.attributes=J,this.children=X,this.content=Z,this.isRemoved=!1,this.isSelfClosing=!1}html(){if(this.isRemoved)return"";let G=this.content||"";for(let J of this.children)G+=J.html();if(this.isSelfClosing)return`<${this.tagName}${this.getAttributesString()} />`;return`<${this.tagName}${this.getAttributesString()}>${G}</${this.tagName}>`}text(){return this.isRemoved?"":this.content||""}getElementById(G){if(this.isRemoved)return null;if(this.attributes.id===G)return this;for(let J of this.children){const X=J.getElementById(G);if(X)return X}return null}getElementsByClass(G){if(this.isRemoved)return[];const J=[];if(this.attributes.class&&this.attributes.class.split(" ").includes(G))J.push(this);for(let X of this.children)J.push(...X.getElementsByClass(G));return J}remove(){this.isRemoved=!0}unRemove(){this.isRemoved=!1}hidden(){this.attributes.style="display: none;"}show(){if(this.attributes.style)delete this.attributes.style}filterAttributes(G){if(G.includes("*"))return;const J={};for(let[X,Z]of Object.entries(this.attributes))if(G.includes(X))J[X]=Z;this.attributes=J;for(let X of this.children)X.filterAttributes(G)}getAttributesString(){return Object.entries(this.attributes).map(([G,J])=>` ${G}="${J}"`).join("")}static create(G){const J=k.tokenize(G),X=[],Z=[];let Y=null,D={},V="";for(let I of J)switch(I.type){case R.TAG_OPEN:if(Y){if(Object.keys(Y.attributes).length===0)Y.attributes=D;Y.content=V.trim(),D={},V="",Z.push(Y)}Y=new k(I.value,{},[]);break;case R.ATTRIBUTE_NAME:D[I.value]="";break;case R.ATTRIBUTE_VALUE:const O=Object.keys(D).pop();D[O]=I.value;break;case R.TAG_CLOSE:case R.SELF_CLOSING_TAG:if(!Y)break;if(Y.isSelfClosing=I.type===R.SELF_CLOSING_TAG,Object.keys(Y.attributes).length===0)Y.attributes=D;if(!Y.content)Y.content=V;else Y.content+=" "+V;if(V="",D={},Z.length>0)Z[Z.length-1].children.push(Y);else X.push(Y);Y=Z.pop()||null;break;case R.TEXT:if(Y)V+=I.value;break}return X}static tokenize(G){const J=[];let X=0;while(X<G.length)if(G[X]==="<")if(G[X+1]==="/"){let Z=X+2;while(Z<G.length&&G[Z]!==">")Z++;J.push({type:R.TAG_CLOSE,value:G.slice(X+2,Z).trim()}),X=Z+1}else{let Z=X+1;while(Z<G.length&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")Z++;const Y=G.slice(X+1,Z).trim();J.push({type:R.TAG_OPEN,value:G.slice(X+1,Z).trim()});while(Z<G.length&&G[Z]!==">")if(G[Z]===" "){Z++;let D="";while(Z<G.length&&G[Z]!=="="&&G[Z]!==" "&&G[Z]!==">"&&G[Z]!=="/")D+=G[Z],Z++;if(D!=="")J.push({type:R.ATTRIBUTE_NAME,value:D.trim().toLowerCase()});if(G[Z]==="="){Z++;const V=G[Z];Z++;let I="";while(Z<G.length&&G[Z]!==V)I+=G[Z],Z++;J.push({type:R.ATTRIBUTE_VALUE,value:I}),Z++}}else Z++;if(mG.has(Y.toLowerCase())&&G[Z]===">")J.push({type:R.SELF_CLOSING_TAG,value:Y});if(G[Z]===">")Z++;X=Z}else{let Z=X;while(Z<G.length&&G[Z]!=="<")Z++;J.push({type:R.TEXT,value:G.slice(X,Z)}),X=Z}return J}}function $G(G){return Object.keys(cG).find((J)=>J.toLowerCase()==G.toLocaleLowerCase())!=null}function OG(G,J){return import("data:text/javascript;charset=utf-8,"+J.join("\n")+encodeURIComponent(`${G}`)).then((Z)=>Z).catch((Z)=>{return console.error(Z),null})}function uG(G){switch(G.data?.___type){case"table":console.table(G.data);break;case"dir":console.dir(G.data);break;case"error":console.error(G.data);break;case"warn":console.warn(G.data);break;default:case"log":console.log(G.data);break}}function MG(G){return G.replace(/<!--[\s\S]*?-->/g,"")}function HG(G){return G.toLowerCase().split("-").map((J)=>J.charAt(0).toUpperCase()+J.slice(1)).join("")}function g(G){VG.postMessage({...G,___type:"warn"})}var cG={number:{},string:{},bigint:{},color:{}};var h=Object.getPrototypeOf(async function(){}).constructor,VG=new BroadcastChannel("advect:log");VG.onmessage=(G)=>uG(G);var EG={async prerender(G){return""},async load({urls:G}){const J=[],X=[];if(Array.isArray(G))X.push(...G);if(typeof G=="string")X.push(G);for(let Z of X){const Y=await fetch(Z).then((D)=>D.text()).then(async(D)=>await this.build({template:D}));J.push(...Y)}return J},async build({template:G}){const J=MG(G),X=k.create(String.raw`${J}`),Z=[];for(let Y of X){const D={tagName:"",module:"",template:"",templateNode:null,refs:[],root:"light",shadow:"closed",watched_attrs:{},mutation:{attributeFilter:[],attributes:!0,characterData:!1,childList:!0,subtree:!0},intersection:{margin:0.5,threshhold:1},logs:[]};if(Y.tagName.toLowerCase()==="template"){if(!Y.attributes.id){g("advect Template must have an id that will become the tag name");continue}const I=Y.attributes.id;if(I.indexOf("-")===-1){g("advect Template tag name must contain a hyphen");continue}if(D.tagName=I,D.templateNode=Y,Y.attributes.root)D.root=Y.attributes.root;else D.root="light";if(Y.attributes.shadow)D.shadow=Y.attributes.shadow;else D.shadow="closed";const O=[...Y.children];while(O.length>0){const F=O.shift();if(!F)continue;if(F.tagName==="settings")F.children.forEach(($)=>{if($.tagName=="mutation"){if(D?.mutation?.attributeFilter&&$.attributes.attributeFilter)D.mutation.attributeFilter=$.attributes.attributeFilter.split(",");if(D?.mutation?.attributes&&$.attributes.attributes)D.mutation.attributes=$.attributes.attributes.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.characterData&&$.attributes.characterData)D.mutation.characterData=$.attributes.characterData.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.childList&&$.attributes.childList)D.mutation.childList=$.attributes.childList.toLocaleLowerCase().indexOf("true")!=-1;if(D?.mutation?.subtree&&$.attributes.subtree)D.mutation.subtree=$.attributes.subtree.toLocaleLowerCase().indexOf("true")!=-1}if($.tagName=="intersection"){if(D?.intersection&&$.attributes.margin)D.intersection.margin=parseFloat($.attributes.margin);if(D?.intersection.threshhold&&$.attributes.threshhold)D.intersection.threshhold=parseFloat($.attributes.threshhold);if(D?.intersection.root&&$.attributes.root)D.intersection.root=$.attributes.root}if($.tagName=="attr"&&$.attributes.name){const x=$.attributes.name,S=$.attributes.type??"string";if($G(S))D.watched_attrs[x]={type:S}}$.remove()}),F.remove();if(F.tagName==="script"){if(F.attributes.type?.toLocaleLowerCase()==="text/adv"&&F.attributes.type){const $=new URL(F.attributes.src);this.load({urls:$.toString()})}if(F.attributes.type?.toLocaleLowerCase()==="module"&&!F.attributes.src)D.module=F.text()}if(F.attributes.ref)D.refs.push(F);O.push(...F.children)}}const V=Y.children.map((I)=>I.html()).join("");D.template=V,Z.push(D)}return Z}};var JG=IG(SG(),1);var bG=IG(RG(),1);function PG(G,J){const[X,Z]=J.tags,Y=J.parse.exec,D=$(G),V=v(D),I=x(V),O=S(I),F=j(O);function $(L){return L.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function x(L){return L.replace(/<if check="([^"]+)">/g,`${X}${Y} if ( \$1 ) { ${Z}`).replace(/<else\/?>/g,`${X}${Y} } else { ${Z}`).replace(/<\/if>/g,`${X}${Y} } ${Z}`)}function S(L){return L.replace(/<for data="([^"]+)"(?: name="([^"]+)")?(?: index="([^"]+)")?>/g,function(i,w,P,f){if(P&&f)return`${X}${Y} ${w}.forEach(function(${P}, ${f}){ ${Z}`;else if(P)return`${X}${Y} ${w}.forEach(function(${P}){ ${Z}`;else return`${X}${Y} ${w}.forEach(function(){ ${Z}`}).replace(/<\/for>/g,`${X}${Y} }) ${Z}`)}function j(L){return L.replace(/<of data="([^"]+)"(?: name="([^"]+)")?(?: value="([^"]+)")?>/g,function(i,w,P,f){if(P&&f)return`${X}${Y} Object.keys(${w}).forEach(function(${P}) { ${Z} 
                        ${X}${Y} const ${f} = ${w}[${P}] ${Z}
                    `;else if(P)return`${X}${Y} Object.keys(${w}).forEach(function(${P}) { ${Z}`;else return`${X}${Y} Object.keys(${w}).forEach(function() { ${Z}`}).replace(/<\/of>/g,`${X}${Y} }) ${Z}`)}function v(L){return L.replace(/(?!{{~)(<adv-view\b[^>]*>.*?<\/adv-view>)(?<!}})/g,"{{~$1}}")}return F}var UG=(G)=>{let J;const X=new Set,Z=(F,$)=>{const x=typeof F==="function"?F(J):F;if(!Object.is(x,J)){const S=J;J=($!=null?$:typeof x!=="object"||x===null)?x:Object.assign({},J,x),X.forEach((j)=>j(J,S))}},Y=()=>J,I={setState:Z,getState:Y,getInitialState:()=>O,subscribe:(F)=>{return X.add(F),()=>X.delete(F)}},O=J=G(Z,Y,I);return I},WG=(G)=>G?UG(G):UG;function AG(G){return new Promise((J,X)=>{if(!G.isConnected){J(null);return}if(G.tagName.indexOf("-")==-1){J(G);return}if(!G.matches(":defined"))customElements.whenDefined(G.tagName).then((D)=>{J(G)}).catch((D)=>{X(D)});J(G)})}var lG=async()=>{const G=new Map,J=await JG.default(new URL("advect.sharedworker.js",import.meta.url).href),X=new SharedWorker(J,{type:"module"});return X.onerror=(Y)=>{console.warn("error",Y)},X.port.onmessage=(Y)=>{const D=G.has(Y.data.$id)&&G.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)D.resolve(Y),G.delete(Y.data.$id)},{messagePromise:async(Y,D)=>{return new Promise((V,I)=>{const O=Math.random().toString(36).substr(2,9);G.set(O,{resolve:V,reject:I}),X.port.postMessage({action:Y,data:D,$id:O})})},worker:X,type:"shared"}},oG=async()=>{const G=new Map,J=await JG.default(new URL("advect.worker.js",import.meta.url).href),X=new Worker(J,{type:"module"});return X.onerror=(Y)=>{console.error("error",Y)},X.onmessage=(Y)=>{const D=G.has(Y.data.$id)&&G.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)D.resolve(Y),G.delete(Y.data.$id)},{messagePromise:async(Y,D)=>{return new Promise((V,I)=>{const O=Math.random().toString(36).substr(2,9);G.set(O,{resolve:V,reject:I}),X.postMessage({action:Y,data:D,$id:O})})},worker:X,type:"dedicated"}},aG=()=>{const G=new BroadcastChannel("advect:noworker"),J=new BroadcastChannel("advect:noworker");G.onmessageerror=(Y)=>console.error(Y),G.onmessage=(Y)=>{const D=X.has(Y.data.$id)&&X.get(Y.data.$id);if(Y.data?.isError===!0&&D)D.reject(Y);if(D)EG[Y.data.action].call(null,Y.data.data).then((V)=>{Y.data.result=V,D.resolve(Y),X.delete(Y.data.$id)})};const X=new Map;return{messagePromise:async(Y,D)=>{return new Promise((V,I)=>{const O=Math.random().toString(36).substr(2,9);X.set(O,{resolve:V,reject:I}),J.postMessage({action:Y,data:D,$id:O})})},worker:null,type:"no-worker"}},sG=async()=>{const G=new URL(import.meta.url).searchParams.get("type")?.toLocaleLowerCase();let J;switch(G){case"d":J=(await oG()).messagePromise;break;case"s":J=(await lG()).messagePromise;break;default:J=aG().messagePromise;break}const X=async(I)=>{return J("prerender",I)},Z=async(I)=>{const F=(await J("load",{urls:I})).data.result;return Y(F)},Y=(I,O=!0)=>{const F=[];for(let $ of I){const x=$;OG($.module,[]).then((S)=>{const j=HG($.tagName),v=S[j],L=class extends(v||YG){static observedAttributes=Object.keys(x.watched_attrs);static settings=x};if(O)customElements.define($.tagName,L);F.push(L)})}return F},D=async(I)=>{const F=(await J("build",{template:I})).data.result;return Y(F)},V=(I)=>{document.querySelectorAll("template[id][adv]").forEach((F)=>D(F.outerHTML));let O=[];document.querySelectorAll('script[type="text/adv"][src]').forEach((F)=>{if(F.hasAttribute("src"))O.push(F.getAttribute("src")??"")}),Z(O),document.removeEventListener("DOMContentLoaded",V)};if(document.readyState!=="loading")V(null);else document.addEventListener("DOMContentLoaded",V);return{render:X,build:D,load:Z}};class XG extends HTMLElement{anyAttrChanged(G,J){}attr=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.getAttribute(J);return null},set:(G,J,X)=>{if(this.isConnected)return this.setAttribute(J,X),this.anyAttrChanged(J,X),!0;return!1}});data=new Proxy({},{get:(G,J)=>{if(this.isConnected)return this.dataset[J];return null},set:(G,J,X)=>{if(this.isConnected)return this.dataset[J]=X,this.anyAttrChanged("data-"+J,X),!0;return!1}});#G;get internals(){return this.#G}constructor(){super()}onAdopt=()=>{};adoptedCallback(){this?.onAdopt()}onAttributeChange=(G,J,X)=>{};attributeChangedCallback(G,J,X){this?.onAttributeChange(G,J,X)}onConnect=()=>{};connectedCallback(){this.#G=this.attachInternals(),this.dispatchEvent(new CustomEvent("connect"))}addEventListener(G,J,X){if(super.addEventListener(G,J,X),G=="connect"&&this.isConnected)J(new Event("connect",{}))}onDisconnect=()=>{};disconnectedCallback(){this?.onDisconnect()}onMutation=(G)=>{};onIntersect=(G)=>{}}class YG extends XG{get html(){return this.$settings.template}get refs_list(){return this.$settings.refs}get all_refs(){return[...this.querySelectorAll("[ref]"),...this?.shadowRoot?.querySelectorAll("[ref]")]}refs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return X;return null}});fuzzyRefs=new Proxy({},{get:(G,J)=>{const X=this.querySelector(`[ref="${J}"]`)||this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return AG(X);return null}});get $settings(){return this.constructor.settings}constructor(){super()}connectedCallback(){super.connectedCallback(),this.#G(),this.#K(),this?.onConnect()}#G(){switch(this.$settings?.root){case"none":break;case"shadow":if(this.attachShadow({mode:this.$settings.shadow}),this.shadowRoot)this.shadowRoot.innerHTML='<div style="display:contents;" part="root">'+this.html+"</div>";break;default:case"light":this.innerHTML=this.html;break}}#J(G){this.mutationObserver?.observe(G,{attributes:!0,childList:!0,subtree:!0}),G.getAttributeNames().filter((X)=>X.startsWith("on")).forEach((X)=>{const Z=G.getAttribute(X)??"";if(X.toLowerCase()==="onmutate")G.addEventListener("adv:mutation",(Y)=>{try{new h("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}catch(D){console.error(D,Z,this)}});else try{G[X]=(Y)=>{new h("$self","event","$this","refs","data",Z)(this,Y,G,this.refs,this.data)}}catch(Y){console.error(Y,Z,this)}})}#Z(){this.shadowRoot?.querySelectorAll("[ref]").forEach((G)=>{this.#J(G)})}#q(){this?.querySelectorAll("[ref]").forEach((G)=>{this.#J(G)})}#z(){this.getAttributeNames().filter((G)=>G.startsWith("on")).forEach((G)=>{const J=this.getAttribute(G)??"";if(G.toLowerCase()==="onmutate"){this.onMutation=(X)=>new h("$self","event",J)(this,X);return}this[G]=(X)=>new h("$self","event",J)(this,X)})}#K(){this.#z(),this.#q(),this.#Z()}#X;get mutationObserver(){return this.#X}createMutationObserver(){if(this.$settings.mutation){if(this.#X=new MutationObserver((G,J)=>{this?.onMutation(G)}),this.#X.observe(this,{...this.$settings.mutation}),this.shadowRoot)this.#X.observe(this.shadowRoot,{...this.$settings.mutation})}}#Y;get interectObserver(){return this.#Y}createIntersectObserver(){if(this.$settings.intersection){let G=void 0;if(this.$settings?.intersection?.root)G=this.querySelector(this.$settings?.intersection?.root);this.#Y=new IntersectionObserver((J,X)=>{this.onIntersect(J)},{...this.$settings.intersection,root:G})}}}class CG extends XG{anyAttrChanged(G,J){this.render()}#G=new bG.Eta({useWith:!0,tags:["{{","}}"],parse:{exec:">",interpolate:"",raw:"~"}});#J=WG((G,J)=>({}));get store(){return this.#J}get state(){return this.#J?.getState()}viewTransition=!0;refs=new Proxy({},{get:(G,J)=>{const X=this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return X;return null}});fuzzyRefs=new Proxy({},{get:(G,J)=>{const X=this?.shadowRoot?.querySelector(`[ref="${J}"]`);if(X)return AG(X);return null}});get all_refs(){return[...this?.shadowRoot?.querySelectorAll("[ref]")]}connectedCallback(){this.attachShadow({mode:"open"}),this.#J.subscribe((G,J)=>{this.render()}),this.render(),super.connectedCallback()}get eta(){return this.#G}render(){const G=PG(this.innerHTML,this.#G.config);let J="";try{J=this.eta.renderString(G,{$self:this})}catch(Z){g(Z)}const X=`<div style="display:contents;" part="root">${J}</div>`;if(this.shadowRoot){const Z=this.shadowRoot;if(this.viewTransition)document.startViewTransition(()=>{Z.innerHTML=X}).finished.then(()=>{this.afterRender()});else Z.innerHTML=X,requestAnimationFrame(()=>{this.afterRender()})}}onRender=()=>{};afterRender(){if(this.onRender)this.onRender()}}if(!customElements.get("adv-view"))customElements.define("adv-view",CG);window.AdvectElement=YG;var IJ=await sG();export{AG as refHandle,IJ as advect,CG as AdvectView,YG as AdvectElement,XG as AdvectBase};
